var SecondScreenUtils=SecondScreenUtils||{};var _taq=_taq||{};(function(){var a=function(b){this.serverUrl=b;this.server=false;this.serverFrame=false;this._id=0;this.callbacks=[];this.queue=[];this.init()};a.prototype={constructor:a,init:function(){if(this.server||this.serverFrame){return}this.serverFrame=window.document.createElement("iframe");this.serverFrame.style.position="absolute";this.serverFrame.setAttribute("aria-hidden",true);this.serverFrame.style.left=this.serverFrame.style.top="-999px";var b=this;if(window.addEventListener){window.addEventListener("message",function(c){b.onMessage(c)},false)}else{window.attachEvent("onmessage",function(c){b.onMessage(c)})}window.document.body.appendChild(this.serverFrame);this.serverFrame.src=this.serverUrl},onMessage:function(c){var b;try{b=JSON.parse(c.data)}catch(c){return}if(b.ready===true){this.server=this.serverFrame.contentWindow;this.processQueue();return}else{if(b.type==="get"){if(typeof this.callbacks[b._xds]!=="undefined"){this.callbacks[b._xds](b.val,b)}}else{if(b.type==="allget"){if(typeof this.callbacks[b._xds]!=="undefined"){this.callbacks[b._xds](b.dict,b)}}else{if(b.type==="prefixget"){if(typeof this.callbacks[b._xds]!=="undefined"){this.callbacks[b._xds](b.dict,b)}}else{if(b.type==="set"){if(typeof this.callbacks[b._xds]!=="undefined"){this.callbacks[b._xds](b)}}else{if(b.type==="del"){if(typeof this.callbacks[b._xds]!=="undefined"){this.callbacks[b._xds](b)}}}}}}}},processQueue:function(){if(!this.queue){return}if(!this.server){this.init();return}while(this.queue.length>0){this.server.postMessage(JSON.stringify(this.queue.shift()),"*")}},post:function(b,c){this._id++;b._xds=this._id;if(typeof c!=="undefined"&&c!==null&&c!==false){this.callbacks[this._id]=c}if(this.server){this.server.postMessage(JSON.stringify(b),"*")}else{this.queue.push(b);this.init()}},getSSAllItems:function(b){this.post({type:"allget",store:"ss"},b)},getSSPrefixItems:function(b,c){this.post({type:"prefixget",prefix:b,store:"ss"},c)},getSSItem:function(b,c){this.post({type:"get",key:b,store:"ss"},c)},setSSItem:function(b,c,d){this.post({type:"set",key:b,val:c,store:"ss"},d)},removeSSItem:function(b,c){this.post({type:"del",key:b,store:"ss"},c)},getLSAllItems:function(b){this.post({type:"allget",store:"ls"},b)},getLSPrefixItems:function(b,c){this.post({type:"prefixget",prefix:b,store:"ls"},c)},getLSItem:function(b,c){this.post({type:"get",key:b,store:"ls"},c)},setLSItem:function(b,c,d){this.post({type:"set",key:b,val:c,store:"ls"},d)},removeLSItem:function(b,c){this.post({type:"del",key:b,store:"ls"},c)}};SecondScreenUtils.xds=a;_taq.libs=_taq.libs||{};_taq.libs.xds=a})();var swfobject=function(){var G="undefined",u="object",V="Shockwave Flash",Z="ShockwaveFlash.ShockwaveFlash",t="application/x-shockwave-flash",U="SWFObjectExprInst",A="onreadystatechange",R=window,m=document,w=navigator,W=false,X=[j],r=[],Q=[],L=[],o,T,H,E,M=false,a=false,q,J,p=true,P=function(){var ad=typeof m.getElementById!=G&&typeof m.getElementsByTagName!=G&&typeof m.createElement!=G,ak=w.userAgent.toLowerCase(),ab=w.platform.toLowerCase(),ah=ab?/win/.test(ab):/win/.test(ak),af=ab?/mac/.test(ab):/mac/.test(ak),ai=/webkit/.test(ak)?parseFloat(ak.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,aa=!+"\v1",aj=[0,0,0],ae=null;if(typeof w.plugins!=G&&typeof w.plugins[V]==u){ae=w.plugins[V].description;if(ae&&!(typeof w.mimeTypes!=G&&w.mimeTypes[t]&&!w.mimeTypes[t].enabledPlugin)){W=true;aa=false;ae=ae.replace(/^.*\s+(\S+\s+\S+$)/,"$1");aj[0]=parseInt(ae.replace(/^(.*)\..*$/,"$1"),10);aj[1]=parseInt(ae.replace(/^.*\.(.*)\s.*$/,"$1"),10);aj[2]=/[a-zA-Z]/.test(ae)?parseInt(ae.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}}else{if(typeof R.ActiveXObject!=G){try{var ag=new ActiveXObject(Z);if(ag){ae=ag.GetVariable("$version");if(ae){aa=true;ae=ae.split(" ")[1].split(",");aj=[parseInt(ae[0],10),parseInt(ae[1],10),parseInt(ae[2],10)]}}}catch(ac){}}}return{w3:ad,pv:aj,wk:ai,ie:aa,win:ah,mac:af}}(),n=function(){if(!P.w3){return}if((typeof m.readyState!=G&&m.readyState=="complete")||(typeof m.readyState==G&&(m.getElementsByTagName("body")[0]||m.body))){g()}if(!M){if(typeof m.addEventListener!=G){m.addEventListener("DOMContentLoaded",g,false)}if(P.ie&&P.win){m.attachEvent(A,function(){if(m.readyState=="complete"){m.detachEvent(A,arguments.callee);g()}});if(R==top){(function(){if(M){return}try{m.documentElement.doScroll("left")}catch(aa){setTimeout(arguments.callee,0);return}g()})()}}if(P.wk){(function(){if(M){return}if(!/loaded|complete/.test(m.readyState)){setTimeout(arguments.callee,0);return}g()})()}v(g)}}();function g(){if(M){return}try{var ac=m.getElementsByTagName("body")[0].appendChild(F("span"));ac.parentNode.removeChild(ac)}catch(ad){return}M=true;var aa=X.length;for(var ab=0;ab<aa;ab++){X[ab]()}}function N(aa){if(M){aa()}else{X[X.length]=aa}}function v(ab){if(typeof R.addEventListener!=G){R.addEventListener("load",ab,false)}else{if(typeof m.addEventListener!=G){m.addEventListener("load",ab,false)}else{if(typeof R.attachEvent!=G){k(R,"onload",ab)}else{if(typeof R.onload=="function"){var aa=R.onload;R.onload=function(){aa();ab()}}else{R.onload=ab}}}}}function j(){if(false){Y()}else{K()}}function Y(){var aa=m.getElementsByTagName("body")[0];var ad=F(u);ad.setAttribute("type",t);var ac=aa.appendChild(ad);if(ac){var ab=0;(function(){if(typeof ac.GetVariable!=G){var ae=ac.GetVariable("$version");if(ae){ae=ae.split(" ")[1].split(",");P.pv=[parseInt(ae[0],10),parseInt(ae[1],10),parseInt(ae[2],10)]}}else{if(ab<10){ab++;setTimeout(arguments.callee,10);return}}aa.removeChild(ad);ac=null;K()})()}else{K()}}function K(){var aj=r.length;if(aj>0){for(var ai=0;ai<aj;ai++){var ab=r[ai].id;var ae=r[ai].callbackFn;var ad={success:false,id:ab};if(P.pv[0]>0){var ah=c(ab);if(ah){if(I(r[ai].swfVersion)&&!(P.wk&&P.wk<312)){z(ab,true);if(ae){ad.success=true;ad.ref=C(ab);ae(ad)}}else{if(r[ai].expressInstall&&D()){var al={};al.data=r[ai].expressInstall;al.width=ah.getAttribute("width")||"0";al.height=ah.getAttribute("height")||"0";if(ah.getAttribute("class")){al.styleclass=ah.getAttribute("class")}if(ah.getAttribute("align")){al.align=ah.getAttribute("align")}var ak={};var aa=ah.getElementsByTagName("param");var af=aa.length;for(var ag=0;ag<af;ag++){if(aa[ag].getAttribute("name").toLowerCase()!="movie"){ak[aa[ag].getAttribute("name")]=aa[ag].getAttribute("value")}}S(al,ak,ab,ae)}else{s(ah);if(ae){ae(ad)}}}}}else{z(ab,true);if(ae){var ac=C(ab);if(ac&&typeof ac.SetVariable!=G){ad.success=true;ad.ref=ac}ae(ad)}}}}}function C(ad){var aa=null;var ab=c(ad);if(ab&&ab.nodeName=="OBJECT"){if(typeof ab.SetVariable!=G){aa=ab}else{var ac=ab.getElementsByTagName(u)[0];if(ac){aa=ac}}}return aa}function D(){return !a&&I("6.0.65")&&(P.win||P.mac)&&!(P.wk&&P.wk<312)}function S(ad,ae,aa,ac){a=true;H=ac||null;E={success:false,id:aa};var ah=c(aa);if(ah){if(ah.nodeName=="OBJECT"){o=h(ah);T=null}else{o=ah;T=aa}ad.id=U;if(typeof ad.width==G||(!/%$/.test(ad.width)&&parseInt(ad.width,10)<310)){ad.width="310"}if(typeof ad.height==G||(!/%$/.test(ad.height)&&parseInt(ad.height,10)<137)){ad.height="137"}m.title=m.title.slice(0,47)+" - Flash Player Installation";var ag=P.ie&&P.win?"ActiveX":"PlugIn",af="MMredirectURL="+R.location.toString().replace(/&/g,"%26")+"&MMplayerType="+ag+"&MMdoctitle="+m.title;if(typeof ae.flashvars!=G){ae.flashvars+="&"+af}else{ae.flashvars=af}if(P.ie&&P.win&&ah.readyState!=4){var ab=F("div");aa+="SWFObjectNew";ab.setAttribute("id",aa);ah.parentNode.insertBefore(ab,ah);ah.style.display="none";(function(){if(ah.readyState==4){ah.parentNode.removeChild(ah)}else{setTimeout(arguments.callee,10)}})()}x(ad,ae,aa)}}function s(ab){if(P.ie&&P.win&&ab.readyState!=4){var aa=F("div");ab.parentNode.insertBefore(aa,ab);aa.parentNode.replaceChild(h(ab),aa);ab.style.display="none";(function(){if(ab.readyState==4){ab.parentNode.removeChild(ab)}else{setTimeout(arguments.callee,10)}})()}else{ab.parentNode.replaceChild(h(ab),ab)}}function h(af){var ae=F("div");if(P.win&&P.ie){ae.innerHTML=af.innerHTML}else{var ab=af.getElementsByTagName(u)[0];if(ab){var ag=ab.childNodes;if(ag){var aa=ag.length;for(var ad=0;ad<aa;ad++){if(!(ag[ad].nodeType==1&&ag[ad].nodeName=="PARAM")&&!(ag[ad].nodeType==8)){ae.appendChild(ag[ad].cloneNode(true))}}}}}return ae}function x(al,aj,ab){var aa,ad=c(ab);if(P.wk&&P.wk<312){return aa}if(ad){if(typeof al.id==G){al.id=ab}if(P.ie&&P.win){var ak="";for(var ah in al){if(al[ah]!=Object.prototype[ah]){if(ah.toLowerCase()=="data"){aj.movie=al[ah]}else{if(ah.toLowerCase()=="styleclass"){ak+=' class="'+al[ah]+'"'}else{if(ah.toLowerCase()!="classid"){ak+=" "+ah+'="'+al[ah]+'"'}}}}}var ai="";for(var ag in aj){if(aj[ag]!=Object.prototype[ag]){ai+='<param name="'+ag+'" value="'+aj[ag]+'" />'}}ad.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+ak+">"+ai+"</object>";Q[Q.length]=al.id;aa=c(al.id)}else{var ac=F(u);ac.setAttribute("type",t);for(var af in al){if(al[af]!=Object.prototype[af]){if(af.toLowerCase()=="styleclass"){ac.setAttribute("class",al[af])}else{if(af.toLowerCase()!="classid"){ac.setAttribute(af,al[af])}}}}for(var ae in aj){if(aj[ae]!=Object.prototype[ae]&&ae.toLowerCase()!="movie"){f(ac,ae,aj[ae])}}ad.parentNode.replaceChild(ac,ad);aa=ac}}return aa}function f(ac,aa,ab){var ad=F("param");ad.setAttribute("name",aa);ad.setAttribute("value",ab);ac.appendChild(ad)}function B(ab){var aa=c(ab);if(aa&&aa.nodeName=="OBJECT"){if(P.ie&&P.win){aa.style.display="none";(function(){if(aa.readyState==4){b(ab)}else{setTimeout(arguments.callee,10)}})()}else{aa.parentNode.removeChild(aa)}}}function b(ac){var ab=c(ac);if(ab){for(var aa in ab){if(typeof ab[aa]=="function"){ab[aa]=null}}ab.parentNode.removeChild(ab)}}function c(ac){var aa=null;try{aa=m.getElementById(ac)}catch(ab){}return aa}function F(aa){return m.createElement(aa)}function k(ac,aa,ab){ac.attachEvent(aa,ab);L[L.length]=[ac,aa,ab]}function I(ac){var ab=P.pv,aa=ac.split(".");aa[0]=parseInt(aa[0],10);aa[1]=parseInt(aa[1],10)||0;aa[2]=parseInt(aa[2],10)||0;return(ab[0]>aa[0]||(ab[0]==aa[0]&&ab[1]>aa[1])||(ab[0]==aa[0]&&ab[1]==aa[1]&&ab[2]>=aa[2]))?true:false}function y(af,ab,ag,ae){if(P.ie&&P.mac){return}var ad=m.getElementsByTagName("head")[0];if(!ad){return}var aa=(ag&&typeof ag=="string")?ag:"screen";if(ae){q=null;J=null}if(!q||J!=aa){var ac=F("style");ac.setAttribute("type","text/css");ac.setAttribute("media",aa);q=ad.appendChild(ac);if(P.ie&&P.win&&typeof m.styleSheets!=G&&m.styleSheets.length>0){q=m.styleSheets[m.styleSheets.length-1]}J=aa}if(P.ie&&P.win){if(q&&typeof q.addRule==u){q.addRule(af,ab)}}else{if(q&&typeof m.createTextNode!=G){q.appendChild(m.createTextNode(af+" {"+ab+"}"))}}}function z(ac,aa){if(!p){return}var ab=aa?"visible":"hidden";if(M&&c(ac)){c(ac).style.visibility=ab}else{y("#"+ac,"visibility:"+ab)}}function O(ab){var ac=/[\\\"<>\.;]/;var aa=ac.exec(ab)!=null;return aa&&typeof encodeURIComponent!=G?encodeURIComponent(ab):ab}var d=function(){if(P.ie&&P.win){window.attachEvent("onunload",function(){var af=L.length;for(var ae=0;ae<af;ae++){L[ae][0].detachEvent(L[ae][1],L[ae][2])}var ac=Q.length;for(var ad=0;ad<ac;ad++){B(Q[ad])}for(var ab in P){P[ab]=null}P=null;for(var aa in swfobject){swfobject[aa]=null}swfobject=null})}}();return{registerObject:function(ae,aa,ad,ac){if(P.w3&&ae&&aa){var ab={};ab.id=ae;ab.swfVersion=aa;ab.expressInstall=ad;ab.callbackFn=ac;r[r.length]=ab;z(ae,false)}else{if(ac){ac({success:false,id:ae})}}},getObjectById:function(aa){if(P.w3){return C(aa)}},embedSWF:function(ae,ak,ah,aj,ab,ad,ac,ag,ai,af){var aa={success:false,id:ak};if(P.w3&&!(P.wk&&P.wk<312)&&ae&&ak&&ah&&aj&&ab){z(ak,false);N(function(){ah+="";aj+="";var am={};if(ai&&typeof ai===u){for(var ao in ai){am[ao]=ai[ao]}}am.data=ae;am.width=ah;am.height=aj;var ap={};if(ag&&typeof ag===u){for(var an in ag){ap[an]=ag[an]}}if(ac&&typeof ac===u){for(var al in ac){if(typeof ap.flashvars!=G){ap.flashvars+="&"+al+"="+ac[al]}else{ap.flashvars=al+"="+ac[al]}}}if(I(ab)){var aq=x(am,ap,ak);if(am.id==ak){z(ak,true)}aa.success=true;aa.ref=aq}else{if(ad&&D()){am.data=ad;S(am,ap,ak,af);return}else{z(ak,true)}}if(af){af(aa)}})}else{if(af){af(aa)}}},switchOffAutoHideShow:function(){p=false},ua:P,getFlashPlayerVersion:function(){return{major:P.pv[0],minor:P.pv[1],release:P.pv[2]}},hasFlashPlayerVersion:I,createSWF:function(ac,ab,aa){if(P.w3){return x(ac,ab,aa)}else{return undefined}},showExpressInstall:function(ac,ad,aa,ab){if(P.w3&&D()){S(ac,ad,aa,ab)}},removeSWF:function(aa){if(P.w3){B(aa)}},createCSS:function(ad,ac,ab,aa){if(P.w3){y(ad,ac,ab,aa)}},addDomLoadEvent:N,addLoadEvent:v,getQueryParamValue:function(ad){var ac=m.location.search||m.location.hash;if(ac){if(/\?/.test(ac)){ac=ac.split("?")[1]}if(ad==null){return O(ac)}var ab=ac.split("&");for(var aa=0;aa<ab.length;aa++){if(ab[aa].substring(0,ab[aa].indexOf("="))==ad){return O(ab[aa].substring((ab[aa].indexOf("=")+1)))}}}return""},expressInstallCallback:function(){if(a){var aa=c(U);if(aa&&o){aa.parentNode.replaceChild(o,aa);if(T){z(T,true);if(P.ie&&P.win){o.style.display="block"}}if(H){H(E)}}a=false}}}}();(function(){if(window.WEB_SOCKET_FORCE_FLASH){}else{if(window.WebSocket){return}else{if(window.MozWebSocket){window.WebSocket=MozWebSocket;return}}}var a;if(window.WEB_SOCKET_LOGGER){a=WEB_SOCKET_LOGGER}else{if(window.console&&window.console.log&&window.console.error){a=window.console}else{a={log:function(){},error:function(){}}}}if(swfobject.getFlashPlayerVersion().major<10){a.error("Flash Player >= 10.0.0 is required.");return}if(location.protocol=="file:"){a.error("WARNING: web-socket-js doesn't work in file:///... URL unless you set Flash Security Settings properly. Open the page via Web server i.e. http://...")}window.WebSocket=function(d,f,c,h,g){var b=this;b.__id=WebSocket.__nextId++;WebSocket.__instances[b.__id]=b;b.readyState=WebSocket.CONNECTING;b.bufferedAmount=0;b.__events={};if(!f){f=[]}else{if(typeof f=="string"){f=[f]}}b.__createTask=setTimeout(function(){WebSocket.__addTask(function(){b.__createTask=null;WebSocket.__flash.create(b.__id,d,f,c||null,h||0,g||null)})},0)};WebSocket.prototype.send=function(c){if(this.readyState==WebSocket.CONNECTING){throw"INVALID_STATE_ERR: Web Socket connection has not been established"}var b=WebSocket.__flash.send(this.__id,encodeURIComponent(c));if(b<0){return true}else{this.bufferedAmount+=b;return false}};WebSocket.prototype.close=function(){if(this.__createTask){clearTimeout(this.__createTask);this.__createTask=null;this.readyState=WebSocket.CLOSED;return}if(this.readyState==WebSocket.CLOSED||this.readyState==WebSocket.CLOSING){return}this.readyState=WebSocket.CLOSING;WebSocket.__flash.close(this.__id)};WebSocket.prototype.addEventListener=function(c,d,b){if(!(c in this.__events)){this.__events[c]=[]}this.__events[c].push(d)};WebSocket.prototype.removeEventListener=function(f,g,b){if(!(f in this.__events)){return}var d=this.__events[f];for(var c=d.length-1;c>=0;--c){if(d[c]===g){d.splice(c,1);break}}};WebSocket.prototype.dispatchEvent=function(f){var c=this.__events[f.type]||[];for(var b=0;b<c.length;++b){c[b](f)}var d=this["on"+f.type];if(d){d.apply(this,[f])}};WebSocket.prototype.__handleEvent=function(d){if("readyState" in d){this.readyState=d.readyState}if("protocol" in d){this.protocol=d.protocol}var b;if(d.type=="open"||d.type=="error"){b=this.__createSimpleEvent(d.type)}else{if(d.type=="close"){b=this.__createSimpleEvent("close");b.wasClean=d.wasClean?true:false;b.code=d.code;b.reason=d.reason}else{if(d.type=="message"){var c=decodeURIComponent(d.message);b=this.__createMessageEvent("message",c)}else{throw"unknown event type: "+d.type}}}this.dispatchEvent(b)};WebSocket.prototype.__createSimpleEvent=function(b){if(document.createEvent&&window.Event){var c=document.createEvent("Event");c.initEvent(b,false,false);return c}else{return{type:b,bubbles:false,cancelable:false}}};WebSocket.prototype.__createMessageEvent=function(b,d){if(document.createEvent&&window.MessageEvent&&!window.opera){var c=document.createEvent("MessageEvent");c.initMessageEvent("message",false,false,d,null,null,window,null);return c}else{return{type:b,data:d,bubbles:false,cancelable:false}}};WebSocket.CONNECTING=0;WebSocket.OPEN=1;WebSocket.CLOSING=2;WebSocket.CLOSED=3;WebSocket.__isFlashImplementation=true;WebSocket.__initialized=false;WebSocket.__flash=null;WebSocket.__instances={};WebSocket.__tasks=[];WebSocket.__nextId=0;WebSocket.loadFlashPolicyFile=function(b){WebSocket.__addTask(function(){WebSocket.__flash.loadManualPolicyFile(b)})};WebSocket.__initialize=function(){if(WebSocket.__initialized){return}WebSocket.__initialized=true;if(WebSocket.__swfLocation){window.WEB_SOCKET_SWF_LOCATION=WebSocket.__swfLocation}if(!window.WEB_SOCKET_SWF_LOCATION){a.error("[WebSocket] set WEB_SOCKET_SWF_LOCATION to location of WebSocketMain.swf");return}if(!window.WEB_SOCKET_SUPPRESS_CROSS_DOMAIN_SWF_ERROR&&!WEB_SOCKET_SWF_LOCATION.match(/(^|\/)WebSocketMainInsecure\.swf(\?.*)?$/)&&WEB_SOCKET_SWF_LOCATION.match(/^\w+:\/\/([^\/]+)/)){var d=RegExp.$1;if(location.host!=d){a.error("[WebSocket] You must host HTML and WebSocketMain.swf in the same host ('"+location.host+"' != '"+d+"'). See also 'How to host HTML file and SWF file in different domains' section in README.md. If you use WebSocketMainInsecure.swf, you can suppress this message by WEB_SOCKET_SUPPRESS_CROSS_DOMAIN_SWF_ERROR = true;")}}var b=document.createElement("div");b.id="webSocketContainer";b.style.position="absolute";if(WebSocket.__isFlashLite()){b.style.left="0px";b.style.top="0px"}else{b.style.left="-100px";b.style.top="-100px"}var c=document.createElement("div");c.id="webSocketFlash";b.appendChild(c);document.body.appendChild(b);swfobject.embedSWF(WEB_SOCKET_SWF_LOCATION,"webSocketFlash","1","1","10.0.0",null,null,{hasPriority:true,swliveconnect:true,allowScriptAccess:"always"},null,function(f){if(!f.success){a.error("[WebSocket] swfobject.embedSWF failed")}})};WebSocket.__onFlashInitialized=function(){setTimeout(function(){WebSocket.__flash=document.getElementById("webSocketFlash");WebSocket.__flash.setCallerUrl(location.href);WebSocket.__flash.setDebug(!!window.WEB_SOCKET_DEBUG);for(var b=0;b<WebSocket.__tasks.length;++b){WebSocket.__tasks[b]()}WebSocket.__tasks=[]},0)};WebSocket.__onFlashEvent=function(){setTimeout(function(){try{var c=WebSocket.__flash.receiveEvents();for(var b=0;b<c.length;++b){WebSocket.__instances[c[b].webSocketId].__handleEvent(c[b])}}catch(d){a.error(d)}},0);return true};WebSocket.__log=function(b){a.log(decodeURIComponent(b))};WebSocket.__error=function(b){a.error(decodeURIComponent(b))};WebSocket.__addTask=function(b){if(WebSocket.__flash){b()}else{WebSocket.__tasks.push(b)}};WebSocket.__isFlashLite=function(){if(!window.navigator||!window.navigator.mimeTypes){return false}var b=window.navigator.mimeTypes["application/x-shockwave-flash"];if(!b||!b.enabledPlugin||!b.enabledPlugin.filename){return false}return b.enabledPlugin.filename.match(/flashlite/i)?true:false};if(!window.WEB_SOCKET_DISABLE_AUTO_INITIALIZATION){swfobject.addDomLoadEvent(function(){setTimeout(function(){WebSocket.__initialize()},0)})}})();(function(w){var h=w.MutationObserver||w.WebKitMutationObserver||w.MozMutationObserver;if(typeof h!="function"&&typeof h!="object"){return}var a="matchesSelector";if("webkitMatchesSelector" in Element.prototype){a="webkitMatchesSelector"}else{if("mozMatchesSelector" in Element.prototype){a="mozMatchesSelector"}}var r="__mutation_summary_node_map_id__";var o=1;function v(F){if(!F[r]){F[r]=o++;return true}return false}function s(){this.map_={}}s.prototype={set:function(F,G){v(F);this.map_[F[r]]={k:F,v:G}},get:function(G){if(v(G)){return}var F=this.map_[G[r]];if(F){return F.v}},has:function(F){return !v(F)&&F[r] in this.map_},delete_:function(F){if(v(F)){return}delete this.map_[F[r]]},keys:function(){var F=[];for(var G in this.map_){F.push(this.map_[G].k)}return F}};function m(G,F){return Object.prototype.hasOwnProperty.call(G,F)}var g=0;var n=1;var D=2;var p=3;var t=4;var k=5;function y(F){return F==n||F==p}var z=Array.prototype.forEach.call.bind(Array.prototype.forEach);function c(F,H,G){this.rootNode=F;this.elementFilter=H;this.calcReordered=G}c.prototype={getChange:function(F){var G=this.changeMap.get(F);if(!G){G={target:F};this.changeMap.set(F,G)}if(F.nodeType==Node.ELEMENT_NODE){G.matchCaseInsensitive=F instanceof HTMLElement&&F.ownerDocument instanceof HTMLDocument}return G},getParentChange:function(F){var G=this.getChange(F);if(!G.childList){G.childList=true;G.oldParentNode=null}return G},handleChildList:function(F){this.childListChanges=true;z(F.removedNodes,function(G){var H=this.getParentChange(G);if(H.added||H.oldParentNode){H.added=false}else{H.oldParentNode=F.target}},this);z(F.addedNodes,function(G){var H=this.getParentChange(G);H.added=true},this)},handleAttributes:function(G){this.attributesChanges=true;var H=this.getChange(G.target);if(!H.attributes){H.attributes=true;H.attributeOldValues={}}var F=H.attributeOldValues;if(!m(F,G.attributeName)){F[G.attributeName]=G.oldValue}},handleCharacterData:function(F){this.characterDataChanges=true;var G=this.getChange(F.target);if(G.characterData){return}G.characterData=true;G.characterDataOldValue=F.oldValue},processMutations:function(G){this.mutations=G;this.changeMap=new s;this.mutations.forEach(function(P){switch(P.type){case"childList":this.handleChildList(P);break;case"attributes":this.handleAttributes(P);break;case"characterData":this.handleCharacterData(P);break}},this);var J=this.entered=[];var N=this.exited=[];var L=this.stayedIn=new s;if(!this.childListChanges&&!this.attributesChanges){return}var I=this.matchabilityChange.bind(this);var H=this.reachabilityChange.bind(this);var M=this.wasReordered.bind(this);var K=new s;var O=this;function F(S,Q){if(K.has(S)){return}K.set(S,true);var U=O.changeMap.get(S);var R=Q;if((U&&U.childList)||R==undefined){R=H(S)}if(R==g){return}I(S);if(R==n){J.push(S)}else{if(R==p){N.push(S)}else{if(R==D){var P=D;if(U&&U.childList){if(U.oldParentNode!==S.parentNode){P=t}else{if(O.calcReordered&&M(S)){P=k}}}L.set(S,P)}}}if(R==D){return}for(var T=S.firstChild;T;T=T.nextSibling){F(T,R)}}this.changeMap.keys().forEach(function(P){F(P)})},getChanged:function(G){var F=this.matchabilityChange.bind(this);this.entered.forEach(function(H){var I=F(H);if(I==n||I==D){G.added.push(H)}});this.stayedIn.keys().forEach(function(I){var J=F(I);if(J==n){G.added.push(I)}else{if(J==p){G.removed.push(I)}else{if(J==D&&(G.reparented||G.reordered)){var H=this.stayedIn.get(I);if(G.reparented&&H==t){G.reparented.push(I)}else{if(G.reordered&&H==k){G.reordered.push(I)}}}}}},this);this.exited.forEach(function(H){var I=F(H);if(I==p||I==D){G.removed.push(H)}})},getOldParentNode:function(G){var H=this.changeMap.get(G);if(H&&H.childList){return H.oldParentNode?H.oldParentNode:null}var F=this.reachabilityChange(G);if(F==g||F==n){throw Error("getOldParentNode requested on invalid node.")}return G.parentNode},getOldPreviousSibling:function(F){var G=this.childlistChanges.get(F.parentNode);if(!G||!this.wasReordered(F)){throw Error("getOldPreviousSibling requested on invalid node.")}return G.oldPreviousSibling.get(F)},getOldAttribute:function(G,F){var H=this.changeMap.get(G);if(!H||!H.attributes){throw Error("getOldAttribute requested on invalid node.")}if(H.matchCaseInsensitive){F=F.toLowerCase()}if(!m(H.attributeOldValues,F)){throw Error("getOldAttribute requested for unchanged attribute name.")}return H.attributeOldValues[F]},getAttributesChanged:function(L){if(!this.attributesChanges){return{}}var G;var I;if(L){G={};I={};L.forEach(function(P){G[P]=true;var Q=P.toLowerCase();if(P!=Q){I[Q]=P}})}var O={};var F=this.changeMap.keys();for(var K=0;K<F.length;K++){var H=F[K];var M=this.changeMap.get(H);if(!M.attributes){continue}if(D!=this.reachabilityChange(H)||D!=this.matchabilityChange(H)){continue}var J=H;var N=M.attributeOldValues;Object.keys(N).forEach(function(Q){var P=Q;if(M.matchCaseInsensitive&&I&&I[Q]){P=I[Q]}if(G&&!G[P]){return}if(J.getAttribute(Q)==N[Q]){return}if(!O[P]){O[P]=[]}O[P].push(J)})}return O},getOldCharacterData:function(F){var G=this.changeMap.get(F);if(!G||!G.characterData){throw Error("getOldCharacterData requested on invalid node.")}return G.characterDataOldValue},getCharacterDataChanged:function(){if(!this.characterDataChanges){return[]}var G=this.changeMap.keys();var F=[];for(var H=0;H<G.length;H++){var I=G[H];if(D!=this.reachabilityChange(I)||D!=this.matchabilityChange(I)){continue}var J=this.changeMap.get(I);if(!J.characterData||I.textContent==J.characterDataOldValue){continue}F.push(I)}return F},reachabilityChange:function(I){this.reachableCache=this.reachableCache||new s;this.wasReachableCache=this.wasReachableCache||new s;var G=this.rootNode;var H=this.changeMap;var M=this.reachableCache;var J=this.wasReachableCache;function F(N){var O=H.get(N);if(O&&O.childList){if(O.oldParentNode){return O.oldParentNode}if(O.added){return null}}return N.parentNode}function L(N){if(N===G){return true}if(!N){return false}var O=M.get(N);if(O===undefined){O=L(N.parentNode);M.set(N,O)}return O}function K(N){if(N===G){return true}if(!N){return false}var O=J.get(N);if(O===undefined){O=K(F(N));J.set(N,O)}return O}if(L(I)){return K(I)?D:n}else{return K(I)?p:g}},checkWasMatching:function(I,G,N){var R=this.changeMap.get(I);if(!R||!R.attributeOldValues){return N}var K=G.tagName;if(R.matchCaseInsensitive&&K!="*"&&m(G,"caseInsensitiveTagName")){K=G.caseInsensitiveTagName}if(K!="*"&&K!=I.tagName){return false}var F=R.attributeOldValues;var H=G.qualifiers.some(function(S){if(S.klass){return m(F,"class")}else{if(S.id){return m(F,"id")}else{return R.matchCaseInsensitive&&m(S,"caseInsensitiveAttrName")?m(F,S.caseInsensitiveAttrName):m(F,S.attrName)}}});if(!H){return N}for(var M=0;M<G.qualifiers.length;M++){var P=G.qualifiers[M];var Q;if(P.klass){Q="class"}else{if(P.id){Q="id"}else{if(R.matchCaseInsensitive&&m(P,"caseInsensitiveAttrName")){Q=P.caseInsensitiveAttrName}else{Q=P.attrName}}}var L=P.klass?true:P.contains;var J=m(F,Q)?F[Q]:I.getAttribute(Q);if(J==null){return false}if(P.hasOwnProperty("attrValue")){if(!L&&P.attrValue!==J){return false}var O=J.split(" ").some(function(S){return S==P.attrValue});if(!O){return false}}}return true},matchabilityChange:function(K){if(this.filterCharacterData){switch(K.nodeType){case Node.COMMENT_NODE:case Node.TEXT_NODE:return D;default:return g}}if(!this.elementFilter){return D}if(K.nodeType!==Node.ELEMENT_NODE){return g}var I=K;function J(N){if(!this.matchCache){this.matchCache={}}if(!this.matchCache[N.selectorString]){this.matchCache[N.selectorString]=new s}var M=this.matchCache[N.selectorString];var L=M.get(I);if(L!==undefined){return L}var O=I[a](N.selectorString);var P=this.checkWasMatching(I,N,O);if(O){L=P?D:n}else{L=P?p:g}M.set(I,L);return L}var G=this.elementFilter.map(J,this);var F=g;var H=0;while(F!=D&&H<G.length){switch(G[H]){case D:F=D;break;case n:if(F==p){F=D}else{F=n}break;case p:if(F==n){F=D}else{F=p}break}H++}return F},processChildlistChanges:function(){if(this.childlistChanges){return}var G=this.childlistChanges=new s;function F(I){var J=G.get(I);if(!J){J={added:new s,removed:new s,maybeMoved:new s,oldPrevious:new s};G.set(I,J)}return J}var H=this.reachabilityChange.bind(this);this.mutations.forEach(function(J){if(J.type!="childList"){return}if(H(J.target)!=D){return}var L=F(J.target);var I=J.previousSibling;function K(N,M){if(!N||L.oldPrevious.has(N)||L.added.has(N)||L.maybeMoved.has(N)){return}if(M&&(L.added.has(M)||L.maybeMoved.has(M))){return}L.oldPrevious.set(N,M)}z(J.removedNodes,function(M){K(M,I);if(L.added.has(M)){L.added.delete_(M)}else{L.removed.set(M,true);L.maybeMoved.delete_(M,true)}I=M});K(J.nextSibling,I);z(J.addedNodes,function(M){if(L.removed.has(M)){L.removed.delete_(M);L.maybeMoved.set(M,true)}else{L.added.set(M,true)}})})},wasReordered:function(G){if(!this.childListChanges){return false}this.processChildlistChanges();var K=this.childlistChanges.get(G.parentNode);if(K.moved){return K.moved.get(G)}var L=K.moved=new s;var F=new s;function H(P){while(P=P.previousSibling){if(F.has(P)){return false}}return true}function J(P){if(!P){return false}if(!K.maybeMoved.has(P)){return false}var Q=L.get(P);if(Q!==undefined){return Q}if(F.has(P)){Q=H(P)}else{F.set(P,true);Q=O(P)!==N(P)}if(F.has(P)){F.delete_(P);L.set(P,Q)}else{Q=L.get(P)}return Q}var M=K.oldPreviousSibling=new s;function N(Q){var P=M.get(Q);if(P!==undefined){return P}P=K.oldPrevious.get(Q);while(P&&(K.removed.has(P)||J(P))){P=N(P)}if(P===undefined){P=Q.previousSibling}M.set(Q,P);return P}var I=new s;function O(Q){if(I.has(Q)){return I.get(Q)}var P=Q.previousSibling;while(P&&(K.added.has(P)||J(P))){P=P.previousSibling}I.set(Q,P);return P}K.maybeMoved.keys().forEach(J);return K.moved.get(G)}};var x=/[a-zA-Z_]+/;var C=/[a-zA-Z0-9_\-]+/;function E(R){var O=[];var L;var N;function Q(){if(L){if(N){L.qualifiers.push(N);N=undefined}O.push(L)}L={qualifiers:[]}}function P(){if(N){L.qualifiers.push(N)}N={}}var af=/\s/;var F;var G="Invalid or unsupported selector syntax.";var M=1;var Y=2;var S=3;var Z=4;var ad=5;var W=6;var H=7;var ab=8;var I=9;var X=10;var ae=11;var K=12;var V=13;var U=14;var J=M;var aa=0;while(aa<R.length){var ac=R[aa++];switch(J){case M:if(ac.match(x)){Q();L.tagName=ac;J=Y;break}if(ac=="*"){Q();L.tagName="*";J=S;break}if(ac=="."){Q();P();L.tagName="*";N.klass=true;J=Z;break}if(ac=="#"){Q();P();L.tagName="*";N.id=true;J=Z;break}if(ac=="["){Q();P();L.tagName="*";N.attrName="";J=W;break}if(ac.match(af)){break}throw Error(G);case Y:if(ac.match(C)){L.tagName+=ac;break}if(ac=="."){P();N.klass=true;J=Z;break}if(ac=="#"){P();N.id=true;J=Z;break}if(ac=="["){P();N.attrName="";J=W;break}if(ac.match(af)){J=U;break}if(ac==","){J=M;break}throw Error(G);case S:if(ac=="."){P();N.klass=true;J=Z;break}if(ac=="#"){P();N.id=true;J=Z;break}if(ac=="["){P();N.attrName="";J=W;break}if(ac.match(af)){J=U;break}if(ac==","){J=M;break}throw Error(G);case Z:if(ac.match(x)){N.attrValue=ac;J=ad;break}throw Error(G);case ad:if(ac.match(C)){N.attrValue+=ac;break}if(ac=="."){P();N.klass=true;J=Z;break}if(ac=="#"){P();N.id=true;J=Z;break}if(ac=="["){P();J=W;break}if(ac.match(af)){J=U;break}if(ac==","){J=M;break}throw Error(G);case W:if(ac.match(x)){N.attrName=ac;J=H;break}if(ac.match(af)){break}throw Error(G);case H:if(ac.match(C)){N.attrName+=ac;break}if(ac.match(af)){J=ab;break}if(ac=="~"){N.contains=true;J=I;break}if(ac=="="){N.attrValue="";J=ae;break}if(ac=="]"){J=S;break}throw Error(G);case ab:if(ac=="~"){N.contains=true;J=I;break}if(ac=="="){N.attrValue="";J=ae;break}if(ac=="]"){J=S;break}if(ac.match(af)){break}throw Error(G);case I:if(ac=="="){N.attrValue="";J=ae;break}throw Error(G);case X:if(ac=="]"){J=S;break}if(ac.match(af)){break}throw Error(G);case ae:if(ac.match(af)){break}if(ac=='"'||ac=="'"){F=ac;J=V;break}N.attrValue+=ac;J=K;break;case K:if(ac.match(af)){J=X;break}if(ac=="]"){J=S;break}if(ac=="'"||ac=='"'){throw Error(G)}N.attrValue+=ac;break;case V:if(ac==F){J=X;break}N.attrValue+=ac;break;case U:if(ac.match(af)){break}if(ac==","){J=M;break}throw Error(G)}}switch(J){case M:case Y:case S:case ad:case U:Q();break;default:throw Error(G)}if(!O.length){throw Error(G)}function T(ag){return'"'+ag.replace(/"/,'\\"')+'"'}O.forEach(function(ag){var ai=ag.tagName.toUpperCase();if(ag.tagName!=ai){ag.caseInsensitiveTagName=ai}var ah=ag.tagName;ag.qualifiers.forEach(function(aj){if(aj.klass){ah+="."+aj.attrValue}else{if(aj.id){ah+="#"+aj.attrValue}else{var ak=aj.attrName.toLowerCase();if(aj.attrName!=ak){aj.caseInsensitiveAttrName=ak}if(aj.contains){ah+="["+aj.attrName+"~="+T(aj.attrValue)+"]"}else{ah+="["+aj.attrName;if(aj.hasOwnProperty("attrValue")){ah+="="+T(aj.attrValue)}ah+="]"}}}});ag.selectorString=ah});return O}var f=/^([a-zA-Z:_]+[a-zA-Z0-9_\-:\.]*)$/;function b(F){if(typeof F!="string"){throw Error("Invalid request opion. attribute must be a non-zero length string.")}F=F.trim();if(!F){throw Error("Invalid request opion. attribute must be a non-zero length string.")}if(!F.match(f)){throw Error("Invalid request option. invalid attribute name: "+F)}return F}function j(K){if(!K.trim().length){throw Error("Invalid request option: elementAttributes must contain at least one attribute.")}var J={};var F={};var I=K.split(/\s+/);for(var G=0;G<I.length;G++){var H=I[G];if(!H){continue}var H=b(H);if(J.hasOwnProperty(H.toLowerCase())){throw Error("Invalid request option: observing multiple case varitations of the same attribute is not supported.")}F[H]=true;J[H.toLowerCase()]=true}return Object.keys(F)}function d(F){var M={callback:true,queries:true,rootNode:true,observeOwnChanges:true};var K={};for(var H in F){if(!(H in M)){throw Error("Invalid option: "+H)}}if(typeof F.callback!=="function"){throw Error("Invalid options: callback is required and must be a function")}K.callback=F.callback;K.rootNode=F.rootNode||document;K.observeOwnChanges=F.observeOwnChanges;if(!F.queries||!F.queries.length){throw Error("Invalid options: queries must contain at least one query request object.")}K.queries=[];for(var G=0;G<F.queries.length;G++){var J=F.queries[G];if(J.all){if(Object.keys(J).length>1){throw Error("Invalid request option. all has no options.")}K.queries.push({all:true});continue}if(J.hasOwnProperty("attribute")){var L={attribute:b(J.attribute)};L.elementFilter=E("*["+L.attribute+"]");if(Object.keys(J).length>1){throw Error("Invalid request option. attribute has no options.")}K.queries.push(L);continue}if(J.hasOwnProperty("element")){var I=Object.keys(J).length;var L={element:J.element,elementFilter:E(J.element)};if(J.hasOwnProperty("elementAttributes")){L.elementAttributes=j(J.elementAttributes);I--}if(I>1){throw Error("Invalid request option. element only allows elementAttributes option.")}K.queries.push(L);continue}if(J.characterData){if(Object.keys(J).length>1){throw Error("Invalid request option. characterData has no options.")}K.queries.push({characterData:true});continue}throw Error("Invalid request option. Unknown query request.")}return K}function q(G){var F={};G.forEach(function(H){H.qualifiers.forEach(function(I){if(I.klass){F["class"]=true}else{if(I.id){F.id=true}else{F[I.attrName]=true}}})});return Object.keys(F)}function u(G){var I={childList:true,subtree:true};var F;function H(J){if(I.attributes&&!F){return}I.attributes=true;I.attributeOldValue=true;if(!J){F=undefined;return}F=F||{};J.forEach(function(K){F[K]=true;F[K.toLowerCase()]=true})}G.forEach(function(K){if(K.characterData){I.characterData=true;I.characterDataOldValue=true;return}if(K.all){H();I.characterData=true;I.characterDataOldValue=true;return}if(K.attribute){H([K.attribute.trim()]);return}if(K.elementFilter&&K.elementFilter.some(function(L){return L.className})){H(["class"])}var J=q(K.elementFilter).concat(K.elementAttributes||[]);if(J.length){H(J)}});if(F){I.attributeFilter=Object.keys(F)}return I}function A(F,G,K){F.elementFilter=K.elementFilter;F.filterCharacterData=K.characterData;var H={target:G,type:"summary",added:[],removed:[]};H.getOldParentNode=F.getOldParentNode.bind(F);if(K.all||K.element){H.reparented=[]}if(K.all){H.reordered=[]}F.getChanged(H);if(K.all||K.attribute||K.elementAttributes){var J=K.attribute?[K.attribute]:K.elementAttributes;var I=F.getAttributesChanged(J);if(K.attribute){H.valueChanged=[];if(I[K.attribute]){H.valueChanged=I[K.attribute]}H.getOldAttribute=function(M){return F.getOldAttribute(M,K.attribute)}}else{H.attributeChanged=I;if(K.elementAttributes){K.elementAttributes.forEach(function(M){if(!H.attributeChanged.hasOwnProperty(M)){H.attributeChanged[M]=[]}})}H.getOldAttribute=F.getOldAttribute.bind(F)}}if(K.all||K.characterData){var L=F.getCharacterDataChanged();H.getOldCharacterData=F.getOldCharacterData.bind(F);if(K.characterData){H.valueChanged=L}else{H.characterDataChanged=L}}if(H.reordered){H.getOldPreviousSibling=F.getOldPreviousSibling.bind(F)}return H}function B(G){var I=false;var S=d(G);var F=u(S.queries);var N=S.rootNode;var P=S.callback;var O=Array.prototype.concat.apply([],S.queries.map(function(T){return T.elementFilter?T.elementFilter:[]}));if(!O.length){O=undefined}var Q=S.queries.some(function(T){return T.all});var R=[];if(B.createQueryValidator){R=S.queries.map(function(T){return B.createQueryValidator(N,T)})}function K(){R.forEach(function(T){if(T){T.recordPreviousState()}})}function J(T){R.forEach(function(V,U){if(V){V.validate(T[U])}})}function H(U){if(!U||!U.length){return[]}var T=new c(N,O,Q);T.processMutations(U);return S.queries.map(function(V){return A(T,N,V)})}function M(T){return T.some(function(U){var W=["added","removed","reordered","reparented","valueChanged","characterDataChanged"];if(W.some(function(X){return U[X]&&U[X].length})){return true}if(U.attributeChanged){var V=Object.keys(U.attributeChanged).some(function(X){return U.attributeChanged[X].length});if(V){return true}}return false})}var L=new h(function(T){if(!S.observeOwnChanges){L.disconnect()}var U=H(T);J(U);if(S.observeOwnChanges){K()}if(M(U)){P(U)}if(!S.observeOwnChanges){K();L.observe(N,F)}});this.reconnect=function(){if(I){throw Error("Already connected")}L.observe(N,F);I=true;K()};this.disconnect=function(){if(!I){throw Error("Not connected")}var T;if(typeof L.takeRecords=="function"){T=L.takeRecords()}else{console.log("Warning: MutationObserver.takeRecords not implemented. Current changes cannot be reported.")}L.disconnect();I=false;var U=H(T);if(M(U)){return U}};this.reconnect()}w.MutationSummary=B;w.MutationSummary.NodeMap=s;w.MutationSummary.parseElementFilter=E})(this);function TreeMirror(a,b){this.root=a;this.idMap={};this.delegate=b}TreeMirror.prototype={initialize:function(a,c,d){if(d){this.root=d}this.idMap[a]=this.root;for(var b=0;b<c.length;b++){this.deserializeNode(c[b],this.root)}},deserializeNode:function(a,c){if(a===null){return null}if(typeof a=="number"){return this.idMap[a]}var f=this.root;var d;switch(a.nodeType){case Node.COMMENT_NODE:d=f.createComment(a.textContent);break;case Node.TEXT_NODE:d=f.createTextNode(a.textContent);break;case Node.DOCUMENT_TYPE_NODE:d=f.implementation.createDocumentType(a.name,a.publicId,a.systemId);break;case Node.ELEMENT_NODE:if(this.delegate&&this.delegate.createElement){d=this.delegate.createElement(a.tagName)}if(!d){d=f.createElement(a.tagName)}Object.keys(a.attributes).forEach(function(g){if(g!="onload"&&g!="onerror"){if(!this.delegate||!this.delegate.setAttribute||!this.delegate.setAttribute(d,g,a.attributes[g])){try{d.setAttribute(g,a.attributes[g])}catch(h){}}}},this);break}this.idMap[a.id]=d;if(c){c.appendChild(d)}if(a.childNodes){for(var b=0;b<a.childNodes.length;b++){this.deserializeNode(a.childNodes[b],d)}}return d},applyChanged:function(f,d,a,h){function g(k){if(k.parentNode){k.parentNode.removeChild(k)}}function j(o){var k=o.parentNode;var n=o.previousSibling;var m=o.node;k.insertBefore(m,n?n.nextSibling:k.firstChild)}function c(m){var k=this.deserializeNode(m.node);Object.keys(m.attributes).forEach(function(o){var n=m.attributes[o];if(n===null){k.removeAttribute(o)}else{if(!this.delegate||!this.delegate.setAttribute||!this.delegate.setAttribute(k,o,n)){try{k.setAttribute(o,n)}catch(p){}}}},this)}function b(m){var k=this.deserializeNode(m.node);k.textContent=m.textContent}d.forEach(function(k){k.node=this.deserializeNode(k.node);k.previousSibling=this.deserializeNode(k.previousSibling);k.parentNode=this.deserializeNode(k.parentNode);g(k.node)},this);f.map(this.deserializeNode,this).forEach(g);d.forEach(j);a.forEach(c,this);h.forEach(b,this);f.forEach(function(k){delete this.idMap[k]},this)}};function TreeMirrorClient(h,g,f){this.target=h;this.mirror=g;this.knownNodes=new MutationSummary.NodeMap;var a=this.serializeNode(h).id;var d=[];for(var j=h.firstChild;j;j=j.nextSibling){d.push(this.serializeNode(j,true))}this.mirror.initialize(a,d);var b=this;var c=[{all:true}];if(f){c=c.concat(f)}this.mutationSummary=new MutationSummary({rootNode:h,callback:function(k){b.applyChanged(k)},queries:c})}TreeMirrorClient.prototype={nextId:1,disconnect:function(){if(this.mutationSummary){this.mutationSummary.disconnect();this.mutationSummary=undefined}},rememberNode:function(a){var b=this.nextId++;this.knownNodes.set(a,b);return b},forgetNode:function(a){delete this.knownNodes.delete_(a)},serializeNode:function(d,b){if(d===null){return null}var h=this.knownNodes.get(d);if(h!==undefined){return h}var f={nodeType:d.nodeType,id:this.rememberNode(d)};switch(f.nodeType){case Node.DOCUMENT_TYPE_NODE:f.name=d.name;f.publicId=d.publicId;f.systemId=d.systemId;break;case Node.COMMENT_NODE:case Node.TEXT_NODE:f.textContent=d.textContent;break;case Node.ELEMENT_NODE:f.tagName=d.tagName;f.attributes={};for(var c=0;c<d.attributes.length;c++){var a=d.attributes.item(c);f.attributes[a.name]=a.value}if(b&&d.childNodes.length){f.childNodes=[];for(var g=d.firstChild;g;g=g.nextSibling){f.childNodes.push(this.serializeNode(g,true))}}break}return f},serializeAddedAndMoved:function(d){var b=d.added.concat(d.reparented).concat(d.reordered);var c=new MutationSummary.NodeMap;b.forEach(function(h){var g=h.parentNode;var f=c.get(g);if(!f){f=new MutationSummary.NodeMap;c.set(g,f)}f.set(h,true)});var a=[];c.keys().forEach(function(g){var f=c.get(g);var j=f.keys();while(j.length){var h=j[0];while(h.previousSibling&&f.has(h.previousSibling)){h=h.previousSibling}while(h&&f.has(h)){a.push({node:this.serializeNode(h),previousSibling:this.serializeNode(h.previousSibling),parentNode:this.serializeNode(h.parentNode)});f.delete_(h);h=h.nextSibling}var j=f.keys()}},this);return a},serializeAttributeChanges:function(a){var b=new MutationSummary.NodeMap;Object.keys(a).forEach(function(c){a[c].forEach(function(f){var d=b.get(f);if(!d){d={node:this.serializeNode(f),attributes:{}};b.set(f,d)}d.attributes[c]=f.getAttribute(c)},this)},this);return b.keys().map(function(c){return b.get(c)})},serializeCharacterDataChange:function(a){return{node:this.serializeNode(a),textContent:a.textContent}},applyChanged:function(c){var g=c[0];var d=g.removed.map(this.serializeNode,this);var b=this.serializeAddedAndMoved(g);var a=this.serializeAttributeChanges(g.attributeChanged);var f=g.characterDataChanged.map(this.serializeCharacterDataChange,this);this.mirror.applyChanged(d,b,a,f);g.removed.forEach(this.forgetNode,this)}};var SecondScreenUtils=SecondScreenUtils||{};(function(){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var d=new Array(-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1);function b(n){var h,k,f;var m,j,g;f=n.length;k=0;h="";while(k<f){m=n.charCodeAt(k++)&255;if(k==f){h+=a.charAt(m>>2);h+=a.charAt((m&3)<<4);h+="==";break}j=n.charCodeAt(k++);if(k==f){h+=a.charAt(m>>2);h+=a.charAt(((m&3)<<4)|((j&240)>>4));h+=a.charAt((j&15)<<2);h+="=";break}g=n.charCodeAt(k++);h+=a.charAt(m>>2);h+=a.charAt(((m&3)<<4)|((j&240)>>4));h+=a.charAt(((j&15)<<2)|((g&192)>>6));h+=a.charAt(g&63)}return h}function c(o){var n,m,j,g;var k,f,h;f=o.length;k=0;h="";while(k<f){do{n=d[o.charCodeAt(k++)&255]}while(k<f&&n==-1);if(n==-1){break}do{m=d[o.charCodeAt(k++)&255]}while(k<f&&m==-1);if(m==-1){break}h+=String.fromCharCode((n<<2)|((m&48)>>4));do{j=o.charCodeAt(k++)&255;if(j==61){return h}j=d[j]}while(k<f&&j==-1);if(j==-1){break}h+=String.fromCharCode(((m&15)<<4)|((j&60)>>2));do{g=o.charCodeAt(k++)&255;if(g==61){return h}g=d[g]}while(k<f&&g==-1);if(g==-1){break}h+=String.fromCharCode(((j&3)<<6)|g)}return h}SecondScreenUtils.base64encode=b;SecondScreenUtils.base64decode=c})();var SecondScreenUtils=SecondScreenUtils||{};(function(){function a(c){return c.replace(/\\u/g,"\\\\u").replace(/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,function(d){var g="";for(var f=0;f<d.length;f++){var h=d.charCodeAt(f).toString(16);g+="\\u"+("0000"+h).substr(h.length)}return g})}function b(c){return c.replace(/(.?)\\u([0-9,a-f,A-F]{4})/g,function(f,g,d){if(g!="\\"){return g+String.fromCharCode(parseInt(d,16))}else{return f}}).replace(/\\\\u/g,"\\u")}SecondScreenUtils.unicode_encode=a;SecondScreenUtils.unicode_decode=b})();var SecondScreenUtils=SecondScreenUtils||{};(function(){function a(p,j,k){var f={};var o=(p+"").split("");var m=[];var g;var h=o[0];var c=256;var n=0;var d=setInterval(function(){n++;for(;n<o.length;n++){g=o[n];if(f.hasOwnProperty(h+g)){h+=g}else{m.push(h.length>1?f[h]:h.charCodeAt(0));if(c<=55295){f[h+g]=c;c++}h=g}if(n%100000==0){k(n,o.length);break}}if(n==o.length){clearInterval(d);k(n,o.length);m.push(h.length>1?f[h]:h.charCodeAt(0));for(var q=0;q<m.length;q++){m[q]=String.fromCharCode(m[q])}j(m.join(""))}},50)}function b(o){var d={};var n=(o+"").split("");var g=n[0];var f=g;var k=[g];var c=256;var h;for(var m=1;m<n.length;m++){var j=n[m].charCodeAt(0);if(j<256){h=n[m]}else{h=d[j]?d[j]:(f+g)}k.push(h);g=h.charAt(0);d[c]=f+g;c++;f=h}return k.join("")}SecondScreenUtils.lzw_encode=a;SecondScreenUtils.lzw_decode=b})();(function(){function a(){this.Diff_Timeout=1;this.Diff_EditCost=4;this.Match_Threshold=0.5;this.Match_Distance=1000;this.Patch_DeleteThreshold=0.5;this.Patch_Margin=4;this.Match_MaxBits=32}a.prototype.diff_main=function(j,h,p,o){"undefined"==typeof o&&(o=0>=this.Diff_Timeout?Number.MAX_VALUE:(new Date).getTime()+1000*this.Diff_Timeout);if(null==j||null==h){throw Error("Null input. (diff_main)")}if(j==h){return j?[[0,j]]:[]}"undefined"==typeof p&&(p=!0);var n=p,m=this.diff_commonPrefix(j,h);p=j.substring(0,m);j=j.substring(m);h=h.substring(m);var m=this.diff_commonSuffix(j,h),k=j.substring(j.length-m);j=j.substring(0,j.length-m);h=h.substring(0,h.length-m);j=this.diff_compute_(j,h,n,o);p&&j.unshift([0,p]);k&&j.push([0,k]);this.diff_cleanupMerge(j);return j};a.prototype.diff_compute_=function(j,h,p,o){if(!j){return[[1,h]]}if(!h){return[[-1,j]]}var n=j.length>h.length?j:h,m=j.length>h.length?h:j,k=n.indexOf(m);return -1!=k?(p=[[1,n.substring(0,k)],[0,m],[1,n.substring(k+m.length)]],j.length>h.length&&(p[0][0]=p[2][0]=-1),p):1==m.length?[[-1,j],[1,h]]:(n=this.diff_halfMatch_(j,h))?(m=n[0],j=n[1],k=n[2],h=n[3],n=n[4],m=this.diff_main(m,k,p,o),p=this.diff_main(j,h,p,o),m.concat([[0,n]],p)):p&&100<j.length&&100<h.length?this.diff_lineMode_(j,h,o):this.diff_bisect_(j,h,o)};a.prototype.diff_lineMode_=function(j,h,p){var o=this.diff_linesToChars_(j,h);j=o.chars1;h=o.chars2;o=o.lineArray;j=this.diff_main(j,h,!1,p);this.diff_charsToLines_(j,o);this.diff_cleanupSemantic(j);j.push([0,""]);for(var n=o=h=0,m="",k="";h<j.length;){switch(j[h][0]){case 1:n++;k+=j[h][1];break;case -1:o++;m+=j[h][1];break;case 0:if(1<=o&&1<=n){j.splice(h-o-n,o+n);h=h-o-n;o=this.diff_main(m,k,!1,p);for(n=o.length-1;0<=n;n--){j.splice(h,0,o[n])}h+=o.length}o=n=0;k=m=""}h++}j.pop();return j};a.prototype.diff_bisect_=function(R,Q,P){for(var O=R.length,N=Q.length,M=Math.ceil((O+N)/2),L=M,K=2*M,I=Array(K),J=Array(K),H=0;H<K;H++){I[H]=-1,J[H]=-1}I[L+1]=0;J[L+1]=0;for(var H=O-N,C=0!=H%2,B=0,z=0,D=0,o=0,x=0;x<M&&!((new Date).getTime()>P);x++){for(var E=-x+B;E<=x-z;E+=2){var G=L+E,F;F=E==-x||E!=x&&I[G-1]<I[G+1]?I[G+1]:I[G-1]+1;for(var A=F-E;F<O&&A<N&&R.charAt(F)==Q.charAt(A);){F++,A++}I[G]=F;if(F>O){z+=2}else{if(A>N){B+=2}else{if(C&&(G=L+H-E,0<=G&&G<K&&-1!=J[G])){var y=O-J[G];if(F>=y){return this.diff_bisectSplit_(R,Q,F,A,P)}}}}}for(E=-x+D;E<=x-o;E+=2){G=L+E;y=E==-x||E!=x&&J[G-1]<J[G+1]?J[G+1]:J[G-1]+1;for(F=y-E;y<O&&F<N&&R.charAt(O-y-1)==Q.charAt(N-F-1);){y++,F++}J[G]=y;if(y>O){o+=2}else{if(F>N){D+=2}else{if(!C&&(G=L+H-E,0<=G&&(G<K&&-1!=I[G])&&(F=I[G],A=L+F-G,y=O-y,F>=y))){return this.diff_bisectSplit_(R,Q,F,A,P)}}}}}return[[-1,R],[1,Q]]};a.prototype.diff_bisectSplit_=function(j,h,p,o,n){var m=j.substring(0,p),k=h.substring(0,o);j=j.substring(p);h=h.substring(o);m=this.diff_main(m,k,!1,n);n=this.diff_main(j,h,!1,n);return m.concat(n)};a.prototype.diff_linesToChars_=function(j,h){function p(q){for(var d="",v=0,u=-1,t=o.length;u<q.length-1;){u=q.indexOf("\n",v);-1==u&&(u=q.length-1);var s=q.substring(v,u+1),v=u+1;(n.hasOwnProperty?n.hasOwnProperty(s):void 0!==n[s])?d+=String.fromCharCode(n[s]):(d+=String.fromCharCode(t),n[s]=t,o[t++]=s)}return d}var o=[],n={};o[0]="";var m=p(j),k=p(h);return{chars1:m,chars2:k,lineArray:o}};a.prototype.diff_charsToLines_=function(h,g){for(var n=0;n<h.length;n++){for(var m=h[n][1],k=[],j=0;j<m.length;j++){k[j]=g[m.charCodeAt(j)]}h[n][1]=k.join("")}};a.prototype.diff_commonPrefix=function(h,g){if(!h||!g||h.charAt(0)!=g.charAt(0)){return 0}for(var n=0,m=Math.min(h.length,g.length),k=m,j=0;n<k;){h.substring(j,k)==g.substring(j,k)?j=n=k:m=k,k=Math.floor((m-n)/2+n)}return k};a.prototype.diff_commonSuffix=function(h,g){if(!h||!g||h.charAt(h.length-1)!=g.charAt(g.length-1)){return 0}for(var n=0,m=Math.min(h.length,g.length),k=m,j=0;n<k;){h.substring(h.length-k,h.length-j)==g.substring(g.length-k,g.length-j)?j=n=k:m=k,k=Math.floor((m-n)/2+n)}return k};a.prototype.diff_commonOverlap_=function(h,g){var n=h.length,m=g.length;if(0==n||0==m){return 0}n>m?h=h.substring(n-m):n<m&&(g=g.substring(0,n));n=Math.min(n,m);if(h==g){return n}for(var m=0,k=1;;){var j=h.substring(n-k),j=g.indexOf(j);if(-1==j){return m}k+=j;if(0==j||h.substring(n-k)==g.substring(0,k)){m=k,k++}}};a.prototype.diff_halfMatch_=function(t,s){function r(D,C,B){for(var A=D.substring(B,B+Math.floor(D.length/4)),z=-1,y="",x,w,f,v;-1!=(z=C.indexOf(A,z+1));){var u=o.diff_commonPrefix(D.substring(B),C.substring(z)),E=o.diff_commonSuffix(D.substring(0,B),C.substring(0,z));y.length<E+u&&(y=C.substring(z-E,z)+C.substring(z,z+u),x=D.substring(0,B-E),w=D.substring(B+u),f=C.substring(0,z-E),v=C.substring(z+u))}return 2*y.length>=D.length?[x,w,f,v,y]:null}if(0>=this.Diff_Timeout){return null}var q=t.length>s.length?t:s,p=t.length>s.length?s:t;if(4>q.length||2*p.length<q.length){return null}var o=this,n=r(q,p,Math.ceil(q.length/4)),q=r(q,p,Math.ceil(q.length/2)),m;if(!n&&!q){return null}m=q?n?n[4].length>q[4].length?n:q:q:n;var k;t.length>s.length?(n=m[0],q=m[1],p=m[2],k=m[3]):(p=m[0],k=m[1],n=m[2],q=m[3]);m=m[4];return[n,q,p,k,m]};a.prototype.diff_cleanupSemantic=function(u){for(var t=!1,s=[],r=0,q=null,p=0,o=0,n=0,k=0,m=0;p<u.length;){0==u[p][0]?(s[r++]=p,o=k,n=m,m=k=0,q=u[p][1]):(1==u[p][0]?k+=u[p][1].length:m+=u[p][1].length,q&&(q.length<=Math.max(o,n)&&q.length<=Math.max(k,m))&&(u.splice(s[r-1],0,[-1,q]),u[s[r-1]+1][0]=1,r--,r--,p=0<r?s[r-1]:-1,m=k=n=o=0,q=null,t=!0)),p++}t&&this.diff_cleanupMerge(u);this.diff_cleanupSemanticLossless(u);for(p=1;p<u.length;){if(-1==u[p-1][0]&&1==u[p][0]){t=u[p-1][1];s=u[p][1];r=this.diff_commonOverlap_(t,s);q=this.diff_commonOverlap_(s,t);if(r>=q){if(r>=t.length/2||r>=s.length/2){u.splice(p,0,[0,s.substring(0,r)]),u[p-1][1]=t.substring(0,t.length-r),u[p+1][1]=s.substring(r),p++}}else{if(q>=t.length/2||q>=s.length/2){u.splice(p,0,[0,t.substring(0,q)]),u[p-1][0]=1,u[p-1][1]=s.substring(0,s.length-q),u[p+1][0]=-1,u[p+1][1]=t.substring(q),p++}}p++}p++}};a.prototype.diff_cleanupSemanticLossless=function(w){function v(F,E){if(!F||!E){return 6}var D=F.charAt(F.length-1),C=E.charAt(0),B=D.match(a.nonAlphaNumericRegex_),A=C.match(a.nonAlphaNumericRegex_),z=B&&D.match(a.whitespaceRegex_),y=A&&C.match(a.whitespaceRegex_),D=z&&D.match(a.linebreakRegex_),C=y&&C.match(a.linebreakRegex_),x=D&&F.match(a.blanklineEndRegex_),k=C&&E.match(a.blanklineStartRegex_);return x||k?5:D||C?4:B&&!z&&y?3:z||y?2:B||A?1:0}for(var u=1;u<w.length-1;){if(0==w[u-1][0]&&0==w[u+1][0]){var t=w[u-1][1],s=w[u][1],r=w[u+1][1],q=this.diff_commonSuffix(t,s);if(q){var p=s.substring(s.length-q),t=t.substring(0,t.length-q),s=p+s.substring(0,s.length-q),r=p+r}for(var q=t,p=s,n=r,o=v(t,s)+v(s,r);s.charAt(0)===r.charAt(0);){var t=t+s.charAt(0),s=s.substring(1)+r.charAt(0),r=r.substring(1),m=v(t,s)+v(s,r);m>=o&&(o=m,q=t,p=s,n=r)}w[u-1][1]!=q&&(q?w[u-1][1]=q:(w.splice(u-1,1),u--),w[u][1]=p,n?w[u+1][1]=n:(w.splice(u+1,1),u--))}u++}};a.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/;a.whitespaceRegex_=/\s/;a.linebreakRegex_=/[\r\n]/;a.blanklineEndRegex_=/\n\r?\n$/;a.blanklineStartRegex_=/^\r?\n\r?\n/;a.prototype.diff_cleanupEfficiency=function(u){for(var t=!1,s=[],r=0,q=null,p=0,o=!1,n=!1,k=!1,m=!1;p<u.length;){if(0==u[p][0]){u[p][1].length<this.Diff_EditCost&&(k||m)?(s[r++]=p,o=k,n=m,q=u[p][1]):(r=0,q=null),k=m=!1}else{if(-1==u[p][0]?m=!0:k=!0,q&&(o&&n&&k&&m||q.length<this.Diff_EditCost/2&&3==o+n+k+m)){u.splice(s[r-1],0,[-1,q]),u[s[r-1]+1][0]=1,r--,q=null,o&&n?(k=m=!0,r=0):(r--,p=0<r?s[r-1]:-1,k=m=!1),t=!0}}p++}t&&this.diff_cleanupMerge(u)};a.prototype.diff_cleanupMerge=function(j){j.push([0,""]);for(var h=0,p=0,o=0,n="",m="",k;h<j.length;){switch(j[h][0]){case 1:o++;m+=j[h][1];h++;break;case -1:p++;n+=j[h][1];h++;break;case 0:1<p+o?(0!==p&&0!==o&&(k=this.diff_commonPrefix(m,n),0!==k&&(0<h-p-o&&0==j[h-p-o-1][0]?j[h-p-o-1][1]+=m.substring(0,k):(j.splice(0,0,[0,m.substring(0,k)]),h++),m=m.substring(k),n=n.substring(k)),k=this.diff_commonSuffix(m,n),0!==k&&(j[h][1]=m.substring(m.length-k)+j[h][1],m=m.substring(0,m.length-k),n=n.substring(0,n.length-k))),0===p?j.splice(h-o,p+o,[1,m]):0===o?j.splice(h-p,p+o,[-1,n]):j.splice(h-p-o,p+o,[-1,n],[1,m]),h=h-p-o+(p?1:0)+(o?1:0)+1):0!==h&&0==j[h-1][0]?(j[h-1][1]+=j[h][1],j.splice(h,1)):h++,p=o=0,m=n=""}}""===j[j.length-1][1]&&j.pop();p=!1;for(h=1;h<j.length-1;){0==j[h-1][0]&&0==j[h+1][0]&&(j[h][1].substring(j[h][1].length-j[h-1][1].length)==j[h-1][1]?(j[h][1]=j[h-1][1]+j[h][1].substring(0,j[h][1].length-j[h-1][1].length),j[h+1][1]=j[h-1][1]+j[h+1][1],j.splice(h-1,1),p=!0):j[h][1].substring(0,j[h+1][1].length)==j[h+1][1]&&(j[h-1][1]+=j[h+1][1],j[h][1]=j[h][1].substring(j[h+1][1].length)+j[h+1][1],j.splice(h+1,1),p=!0)),h++}p&&this.diff_cleanupMerge(j)};a.prototype.diff_xIndex=function(j,h){var p=0,o=0,n=0,m=0,k;for(k=0;k<j.length;k++){1!==j[k][0]&&(p+=j[k][1].length);-1!==j[k][0]&&(o+=j[k][1].length);if(p>h){break}n=p;m=o}return j.length!=k&&-1===j[k][0]?m:m+(h-n)};a.prototype.diff_prettyHtml=function(t){for(var s=[],r=/&/g,q=/</g,p=/>/g,o=/\n/g,n=0;n<t.length;n++){var m=t[n][0],k=t[n][1],k=k.replace(r,"&amp;").replace(q,"&lt;").replace(p,"&gt;").replace(o,"&para;<br>");switch(m){case 1:s[n]='<ins style="background:#e6ffe6;">'+k+"</ins>";break;case -1:s[n]='<del style="background:#ffe6e6;">'+k+"</del>";break;case 0:s[n]="<span>"+k+"</span>"}}return s.join("")};a.prototype.diff_text1=function(f){for(var d=[],g=0;g<f.length;g++){1!==f[g][0]&&(d[g]=f[g][1])}return d.join("")};a.prototype.diff_text2=function(f){for(var d=[],g=0;g<f.length;g++){-1!==f[g][0]&&(d[g]=f[g][1])}return d.join("")};a.prototype.diff_levenshtein=function(j){for(var h=0,p=0,o=0,n=0;n<j.length;n++){var m=j[n][0],k=j[n][1];switch(m){case 1:p+=k.length;break;case -1:o+=k.length;break;case 0:h+=Math.max(p,o),o=p=0}}return h+=Math.max(p,o)};a.prototype.diff_toDelta=function(f){for(var d=[],g=0;g<f.length;g++){switch(f[g][0]){case 1:d[g]="+"+encodeURI(f[g][1]);break;case -1:d[g]="-"+f[g][1].length;break;case 0:d[g]="="+f[g][1].length}}return d.join("\t").replace(/%20/g," ")};a.prototype.diff_fromDelta=function(u,t){for(var s=[],r=0,q=0,p=t.split(/\t/g),o=0;o<p.length;o++){var n=p[o].substring(1);switch(p[o].charAt(0)){case"+":try{s[r++]=[1,decodeURI(n)]}catch(k){throw Error("Illegal escape in diff_fromDelta: "+n)}break;case"-":case"=":var m=parseInt(n,10);if(isNaN(m)||0>m){throw Error("Invalid number in diff_fromDelta: "+n)}n=u.substring(q,q+=m);"="==p[o].charAt(0)?s[r++]=[0,n]:s[r++]=[-1,n];break;default:if(p[o]){throw Error("Invalid diff operation in diff_fromDelta: "+p[o])}}}if(q!=u.length){throw Error("Delta length ("+q+") does not equal source text length ("+u.length+").")}return s};a.prototype.match_main=function(f,d,g){if(null==f||null==d||null==g){throw Error("Null input. (match_main)")}g=Math.max(0,Math.min(g,f.length));return f==d?0:f.length?f.substring(g,g+d.length)==d?g:this.match_bitap_(f,d,g):-1};a.prototype.match_bitap_=function(E,D,C){function B(b,h){var f=b/D.length,c=Math.abs(C-h);return !z.Match_Distance?c?1:f:f+c/z.Match_Distance}if(D.length>this.Match_MaxBits){throw Error("Pattern too long for this browser.")}var A=this.match_alphabet_(D),z=this,y=this.Match_Threshold,x=E.indexOf(D,C);-1!=x&&(y=Math.min(B(0,x),y),x=E.lastIndexOf(D,C+D.length),-1!=x&&(y=Math.min(B(0,x),y)));for(var u=1<<D.length-1,x=-1,v,s,n=D.length+E.length,m,G=0;G<D.length;G++){v=0;for(s=n;v<s;){B(G,C+s)<=y?v=s:n=s,s=Math.floor((n-v)/2+v)}n=s;v=Math.max(1,C-s+1);var o=Math.min(C+s,E.length)+D.length;s=Array(o+2);for(s[o+1]=(1<<G)-1;o>=v;o--){var F=A[E.charAt(o-1)];s[o]=0===G?(s[o+1]<<1|1)&F:(s[o+1]<<1|1)&F|((m[o+1]|m[o])<<1|1)|m[o+1];if(s[o]&u&&(F=B(G,o-1),F<=y)){if(y=F,x=o-1,x>C){v=Math.max(1,2*C-x)}else{break}}}if(B(G+1,C)>y){break}m=s}return x};a.prototype.match_alphabet_=function(f){for(var d={},g=0;g<f.length;g++){d[f.charAt(g)]=0}for(g=0;g<f.length;g++){d[f.charAt(g)]|=1<<f.length-g-1}return d};a.prototype.patch_addContext_=function(g,f){if(0!=f.length){for(var j=f.substring(g.start2,g.start2+g.length1),h=0;f.indexOf(j)!=f.lastIndexOf(j)&&j.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;){h+=this.Patch_Margin,j=f.substring(g.start2-h,g.start2+g.length1+h)}h+=this.Patch_Margin;(j=f.substring(g.start2-h,g.start2))&&g.diffs.unshift([0,j]);(h=f.substring(g.start2+g.length1,g.start2+g.length1+h))&&g.diffs.push([0,h]);g.start1-=j.length;g.start2-=j.length;g.length1+=j.length+h.length;g.length2+=j.length+h.length}};a.prototype.patch_make=function(w,v,u){var t;if("string"==typeof w&&"string"==typeof v&&"undefined"==typeof u){t=w,v=this.diff_main(t,v,!0),2<v.length&&(this.diff_cleanupSemantic(v),this.diff_cleanupEfficiency(v))}else{if(w&&"object"==typeof w&&"undefined"==typeof v&&"undefined"==typeof u){v=w,t=this.diff_text1(v)}else{if("string"==typeof w&&v&&"object"==typeof v&&"undefined"==typeof u){t=w}else{if("string"==typeof w&&"string"==typeof v&&u&&"object"==typeof u){t=w,v=u}else{throw Error("Unknown call format to patch_make.")}}}}if(0===v.length){return[]}u=[];w=new a.patch_obj;for(var s=0,r=0,q=0,p=t,n=0;n<v.length;n++){var o=v[n][0],m=v[n][1];!s&&0!==o&&(w.start1=r,w.start2=q);switch(o){case 1:w.diffs[s++]=v[n];w.length2+=m.length;t=t.substring(0,q)+m+t.substring(q);break;case -1:w.length1+=m.length;w.diffs[s++]=v[n];t=t.substring(0,q)+t.substring(q+m.length);break;case 0:m.length<=2*this.Patch_Margin&&s&&v.length!=n+1?(w.diffs[s++]=v[n],w.length1+=m.length,w.length2+=m.length):m.length>=2*this.Patch_Margin&&s&&(this.patch_addContext_(w,p),u.push(w),w=new a.patch_obj,s=0,p=t,r=q)}1!==o&&(r+=m.length);-1!==o&&(q+=m.length)}s&&(this.patch_addContext_(w,p),u.push(w));return u};a.prototype.patch_deepCopy=function(h){for(var g=[],n=0;n<h.length;n++){var m=h[n],k=new a.patch_obj;k.diffs=[];for(var j=0;j<m.diffs.length;j++){k.diffs[j]=m.diffs[j].slice()}k.start1=m.start1;k.start2=m.start2;k.length1=m.length1;k.length2=m.length2;g[n]=k}return g};a.prototype.patch_apply=function(y,x){if(0==y.length){return[x,[]]}y=this.patch_deepCopy(y);var w=this.patch_addPadding(y);x=w+x+w;this.patch_splitMax(y);for(var v=0,u=[],t=0;t<y.length;t++){var s=y[t].start2+v,r=this.diff_text1(y[t].diffs),o,p=-1;if(r.length>this.Match_MaxBits){if(o=this.match_main(x,r.substring(0,this.Match_MaxBits),s),-1!=o&&(p=this.match_main(x,r.substring(r.length-this.Match_MaxBits),s+r.length-this.Match_MaxBits),-1==p||o>=p)){o=-1}}else{o=this.match_main(x,r,s)}if(-1==o){u[t]=!1,v-=y[t].length2-y[t].length1}else{if(u[t]=!0,v=o-s,s=-1==p?x.substring(o,o+r.length):x.substring(o,p+this.Match_MaxBits),r==s){x=x.substring(0,o)+this.diff_text2(y[t].diffs)+x.substring(o+r.length)}else{if(s=this.diff_main(r,s,!1),r.length>this.Match_MaxBits&&this.diff_levenshtein(s)/r.length>this.Patch_DeleteThreshold){u[t]=!1}else{this.diff_cleanupSemanticLossless(s);for(var r=0,n,p=0;p<y[t].diffs.length;p++){var m=y[t].diffs[p];0!==m[0]&&(n=this.diff_xIndex(s,r));1===m[0]?x=x.substring(0,o+n)+m[1]+x.substring(o+n):-1===m[0]&&(x=x.substring(0,o+n)+x.substring(o+this.diff_xIndex(s,r+m[1].length)));-1!==m[0]&&(r+=m[1].length)}}}}}x=x.substring(w.length,x.length-w.length);return[x,u]};a.prototype.patch_addPadding=function(h){for(var g=this.Patch_Margin,n="",m=1;m<=g;m++){n+=String.fromCharCode(m)}for(m=0;m<h.length;m++){h[m].start1+=g,h[m].start2+=g}var m=h[0],k=m.diffs;if(0==k.length||0!=k[0][0]){k.unshift([0,n]),m.start1-=g,m.start2-=g,m.length1+=g,m.length2+=g}else{if(g>k[0][1].length){var j=g-k[0][1].length;k[0][1]=n.substring(k[0][1].length)+k[0][1];m.start1-=j;m.start2-=j;m.length1+=j;m.length2+=j}}m=h[h.length-1];k=m.diffs;0==k.length||0!=k[k.length-1][0]?(k.push([0,n]),m.length1+=g,m.length2+=g):g>k[k.length-1][1].length&&(j=g-k[k.length-1][1].length,k[k.length-1][1]+=n.substring(0,j),m.length1+=j,m.length2+=j);return n};a.prototype.patch_splitMax=function(u){for(var t=this.Match_MaxBits,s=0;s<u.length;s++){if(!(u[s].length1<=t)){var r=u[s];u.splice(s--,1);for(var q=r.start1,p=r.start2,o="";0!==r.diffs.length;){var n=new a.patch_obj,k=!0;n.start1=q-o.length;n.start2=p-o.length;""!==o&&(n.length1=n.length2=o.length,n.diffs.push([0,o]));for(;0!==r.diffs.length&&n.length1<t-this.Patch_Margin;){var o=r.diffs[0][0],m=r.diffs[0][1];1===o?(n.length2+=m.length,p+=m.length,n.diffs.push(r.diffs.shift()),k=!1):-1===o&&1==n.diffs.length&&0==n.diffs[0][0]&&m.length>2*t?(n.length1+=m.length,q+=m.length,k=!1,n.diffs.push([o,m]),r.diffs.shift()):(m=m.substring(0,t-n.length1-this.Patch_Margin),n.length1+=m.length,q+=m.length,0===o?(n.length2+=m.length,p+=m.length):k=!1,n.diffs.push([o,m]),m==r.diffs[0][1]?r.diffs.shift():r.diffs[0][1]=r.diffs[0][1].substring(m.length))}o=this.diff_text2(n.diffs);o=o.substring(o.length-this.Patch_Margin);m=this.diff_text1(r.diffs).substring(0,this.Patch_Margin);""!==m&&(n.length1+=m.length,n.length2+=m.length,0!==n.diffs.length&&0===n.diffs[n.diffs.length-1][0]?n.diffs[n.diffs.length-1][1]+=m:n.diffs.push([0,m]));k||u.splice(++s,0,n)}}}};a.prototype.patch_toText=function(f){for(var d=[],g=0;g<f.length;g++){d[g]=f[g]}return d.join("")};a.prototype.patch_fromText=function(k){var j=[];if(!k){return j}k=k.split("\n");for(var r=0,q=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;r<k.length;){var p=k[r].match(q);if(!p){throw Error("Invalid patch string: "+k[r])}var o=new a.patch_obj;j.push(o);o.start1=parseInt(p[1],10);""===p[2]?(o.start1--,o.length1=1):"0"==p[2]?o.length1=0:(o.start1--,o.length1=parseInt(p[2],10));o.start2=parseInt(p[3],10);""===p[4]?(o.start2--,o.length2=1):"0"==p[4]?o.length2=0:(o.start2--,o.length2=parseInt(p[4],10));for(r++;r<k.length;){p=k[r].charAt(0);try{var n=decodeURI(k[r].substring(1))}catch(m){throw Error("Illegal escape in patch_fromText: "+n)}if("-"==p){o.diffs.push([-1,n])}else{if("+"==p){o.diffs.push([1,n])}else{if(" "==p){o.diffs.push([0,n])}else{if("@"==p){break}else{if(""!==p){throw Error('Invalid patch mode "'+p+'" in: '+n)}}}}}r++}}return j};a.patch_obj=function(){this.diffs=[];this.start2=this.start1=null;this.length2=this.length1=0};a.patch_obj.prototype.toString=function(){var f,d;f=0===this.length1?this.start1+",0":1==this.length1?this.start1+1:this.start1+1+","+this.length1;d=0===this.length2?this.start2+",0":1==this.length2?this.start2+1:this.start2+1+","+this.length2;f=["@@ -"+f+" +"+d+" @@\n"];var g;for(d=0;d<this.diffs.length;d++){switch(this.diffs[d][0]){case 1:g="+";break;case -1:g="-";break;case 0:g=" "}f[d+1]=g+encodeURI(this.diffs[d][1])+"\n"}return f.join("").replace(/%20/g," ")};SecondScreenUtils.diff_match_patch=a;SecondScreenUtils.DIFF_DELETE=-1;SecondScreenUtils.DIFF_INSERT=1;SecondScreenUtils.DIFF_EQUAL=0})();
/*! peerjs build:0.3.13, development. Copyright(c) 2013 Michelle Bu <michelle@michellebu.com> */
(function e(b,g,d){function c(n,k){if(!g[n]){if(!b[n]){var j=typeof require=="function"&&require;if(!k&&j){return j(n,!0)}if(a){return a(n,!0)}var m=new Error("Cannot find module '"+n+"'");throw m.code="MODULE_NOT_FOUND",m}var h=g[n]={exports:{}};b[n][0].call(h.exports,function(o){var p=b[n][1][o];return c(p?p:o)},h,h.exports,e,b,g,d)}return g[n].exports}var a=typeof require=="function"&&require;for(var f=0;f<d.length;f++){c(d[f])}return c})({1:[function(b,c,a){c.exports.RTCSessionDescription=window.RTCSessionDescription||window.mozRTCSessionDescription;c.exports.RTCPeerConnection=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;c.exports.RTCIceCandidate=window.RTCIceCandidate||window.mozRTCIceCandidate},{}],2:[function(f,g,d){var c=f("./util");var j=f("eventemitter3");var h=f("./negotiator");var a=f("reliable");function b(m,n,k){if(!(this instanceof b)){return new b(m,n,k)}j.call(this);this.options=c.extend({serialization:"binary",reliable:false},k);this.open=false;this.type="data";this.peer=m;this.provider=n;this.id=this.options.connectionId||b._idPrefix+c.randomToken();this.label=this.options.label||this.id;this.metadata=this.options.metadata;this.serialization=this.options.serialization;this.reliable=this.options.reliable;this._buffer=[];this._buffering=false;this.bufferSize=0;this._chunkedData={};if(this.options._payload){this._peerBrowser=this.options._payload.browser}h.startConnection(this,this.options._payload||{originator:true})}c.inherits(b,j);b._idPrefix="dc_";b.prototype.initialize=function(k){this._dc=this.dataChannel=k;this._configureDataChannel()};b.prototype._configureDataChannel=function(){var k=this;if(c.supports.sctp){this._dc.binaryType="arraybuffer"}this._dc.onopen=function(){c.log("Data channel connection success");k.open=true;k.emit("open")};if(!c.supports.sctp&&this.reliable){this._reliable=new a(this._dc,c.debug)}if(this._reliable){this._reliable.onmessage=function(m){k.emit("data",m)}}else{this._dc.onmessage=function(m){k._handleDataMessage(m)}}this._dc.onclose=function(m){c.log("DataChannel closed for:",k.peer);k.close()}};b.prototype._handleDataMessage=function(q){var k=this;var p=q.data;var n=p.constructor;if(this.serialization==="binary"||this.serialization==="binary-utf8"){if(n===Blob){c.blobToArrayBuffer(p,function(s){p=c.unpack(s);k.emit("data",p)});return}else{if(n===ArrayBuffer){p=c.unpack(p)}else{if(n===String){var o=c.binaryStringToArrayBuffer(p);p=c.unpack(o)}}}}else{if(this.serialization==="json"){p=JSON.parse(p)}}if(p.__peerData){var r=p.__peerData;var m=this._chunkedData[r]||{data:[],count:0,total:p.total};m.data[p.n]=p.data;m.count+=1;if(m.total===m.count){delete this._chunkedData[r];p=new Blob(m.data);this._handleDataMessage({data:p})}this._chunkedData[r]=m;return}this.emit("data",p)};b.prototype.close=function(){if(!this.open){return}this.open=false;h.cleanup(this);this.emit("close")};b.prototype.send=function(p,o){if(!this.open){this.emit("error",new Error("Connection is not open. You should listen for the `open` event before sending messages."));return}if(this._reliable){this._reliable.send(p);return}var n=this;if(this.serialization==="json"){this._bufferedSend(JSON.stringify(p))}else{if(this.serialization==="binary"||this.serialization==="binary-utf8"){var m=c.pack(p);var k=c.chunkedBrowsers[this._peerBrowser]||c.chunkedBrowsers[c.browser];if(k&&!o&&m.size>c.chunkedMTU){this._sendChunks(m);return}if(!c.supports.sctp){c.blobToBinaryString(m,function(q){n._bufferedSend(q)})}else{if(!c.supports.binaryBlob){c.blobToArrayBuffer(m,function(q){n._bufferedSend(q)})}else{this._bufferedSend(m)}}}else{this._bufferedSend(p)}}};b.prototype._bufferedSend=function(k){if(this._buffering||!this._trySend(k)){this._buffer.push(k);this.bufferSize=this._buffer.length}};b.prototype._trySend=function(n){try{this._dc.send(n)}catch(m){this._buffering=true;var k=this;setTimeout(function(){k._buffering=false;k._tryBuffer()},100);return false}return true};b.prototype._tryBuffer=function(){if(this._buffer.length===0){return}var k=this._buffer[0];if(this._trySend(k)){this._buffer.shift();this.bufferSize=this._buffer.length;this._tryBuffer()}};b.prototype._sendChunks=function(k){var o=c.chunk(k);for(var m=0,n=o.length;m<n;m+=1){var k=o[m];this.send(k,true)}};b.prototype.handleMessage=function(k){var m=k.payload;switch(k.type){case"ANSWER":this._peerBrowser=m.browser;h.handleSDP(k.type,this,m.sdp);break;case"CANDIDATE":h.handleCandidate(this,m.candidate);break;default:c.warn("Unrecognized message type:",k.type,"from peer:",this.peer);break}};g.exports=b},{"./negotiator":5,"./util":8,eventemitter3:9,reliable:12}],3:[function(b,c,a){window.Socket=b("./socket");window.MediaConnection=b("./mediaconnection");window.DataConnection=b("./dataconnection");window.Peer=b("./peer");window.RTCPeerConnection=b("./adapter").RTCPeerConnection;window.RTCSessionDescription=b("./adapter").RTCSessionDescription;window.RTCIceCandidate=b("./adapter").RTCIceCandidate;window.Negotiator=b("./negotiator");window.util=b("./util");window.BinaryPack=b("js-binarypack")},{"./adapter":1,"./dataconnection":2,"./mediaconnection":4,"./negotiator":5,"./peer":6,"./socket":7,"./util":8,"js-binarypack":10}],4:[function(d,f,c){var a=d("./util");var h=d("eventemitter3");var g=d("./negotiator");function b(k,m,j){if(!(this instanceof b)){return new b(k,m,j)}h.call(this);this.options=a.extend({},j);this.open=false;this.type="media";this.peer=k;this.provider=m;this.metadata=this.options.metadata;this.localStream=this.options._stream;this.id=this.options.connectionId||b._idPrefix+a.randomToken();if(this.localStream){g.startConnection(this,{_stream:this.localStream,originator:true})}}a.inherits(b,h);b._idPrefix="mc_";b.prototype.addStream=function(j){a.log("Receiving stream",j);this.remoteStream=j;this.emit("stream",j)};b.prototype.handleMessage=function(j){var k=j.payload;switch(j.type){case"ANSWER":g.handleSDP(j.type,this,k.sdp);this.open=true;break;case"CANDIDATE":g.handleCandidate(this,k.candidate);break;default:a.warn("Unrecognized message type:",j.type,"from peer:",this.peer);break}};b.prototype.answer=function(n){if(this.localStream){a.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");return}this.options._payload._stream=n;this.localStream=n;g.startConnection(this,this.options._payload);var m=this.provider._getMessages(this.id);for(var j=0,k=m.length;j<k;j+=1){this.handleMessage(m[j])}this.open=true};b.prototype.close=function(){if(!this.open){return}this.open=false;g.cleanup(this);this.emit("close")};f.exports=b},{"./negotiator":5,"./util":8,eventemitter3:9}],5:[function(c,f,b){var a=c("./util");var d=c("./adapter").RTCPeerConnection;var j=c("./adapter").RTCSessionDescription;var h=c("./adapter").RTCIceCandidate;var g={pcs:{data:{},media:{}},queue:[]};g._idPrefix="pc_";g.startConnection=function(m,p){var o=g._getPeerConnection(m,p);if(m.type==="media"&&p._stream){o.addStream(p._stream)}m.pc=m.peerConnection=o;if(p.originator){if(m.type==="data"){var n={};if(!a.supports.sctp){n={reliable:p.reliable}}var k=o.createDataChannel(m.label,n);m.initialize(k)}if(!a.supports.onnegotiationneeded){g._makeOffer(m)}}else{g.handleSDP("OFFER",m,p.sdp)}};g._getPeerConnection=function(k,o){if(!g.pcs[k.type]){a.error(k.type+" is not a valid connection type. Maybe you overrode the `type` property somewhere.")}if(!g.pcs[k.type][k.peer]){g.pcs[k.type][k.peer]={}}var n=g.pcs[k.type][k.peer];var m;if(o.pc){m=g.pcs[k.type][k.peer][o.pc]}if(!m||m.signalingState!=="stable"){m=g._startPeerConnection(k)}return m};g._startPeerConnection=function(k){a.log("Creating RTCPeerConnection.");var o=g._idPrefix+a.randomToken();var n={};if(k.type==="data"&&!a.supports.sctp){n={optional:[{RtpDataChannels:true}]}}else{if(k.type==="media"){n={optional:[{DtlsSrtpKeyAgreement:true}]}}}var m=new d(k.provider.options.config,n);g.pcs[k.type][k.peer][o]=m;g._setupListeners(k,m,o);return m};g._setupListeners=function(m,n,o){var k=m.peer;var p=m.id;var q=m.provider;a.log("Listening for ICE candidates.");n.onicecandidate=function(r){if(r.candidate){a.log("Received ICE candidates for:",m.peer);q.socket.send({type:"CANDIDATE",payload:{candidate:r.candidate,type:m.type,connectionId:m.id},dst:k})}};n.oniceconnectionstatechange=function(){switch(n.iceConnectionState){case"disconnected":case"failed":a.log("iceConnectionState is disconnected, closing connections to "+k);m.close();break;case"completed":n.onicecandidate=a.noop;break}};n.onicechange=n.oniceconnectionstatechange;a.log("Listening for `negotiationneeded`");n.onnegotiationneeded=function(){a.log("`negotiationneeded` triggered");if(n.signalingState=="stable"){g._makeOffer(m)}else{a.log("onnegotiationneeded triggered when not stable. Is another connection being established?")}};a.log("Listening for data channel");n.ondatachannel=function(s){a.log("Received data channel");var r=s.channel;var t=q.getConnection(k,p);t.initialize(r)};a.log("Listening for remote stream");n.onaddstream=function(r){a.log("Received remote stream");var t=r.stream;var s=q.getConnection(k,p);if(s.type==="media"){s.addStream(t)}}};g.cleanup=function(k){a.log("Cleaning up PeerConnection to "+k.peer);var m=k.pc;if(!!m&&(m.readyState!=="closed"||m.signalingState!=="closed")){m.close();k.pc=null}};g._makeOffer=function(k){var m=k.pc;m.createOffer(function(n){a.log("Created offer.");if(!a.supports.sctp&&k.type==="data"&&k.reliable){n.sdp=Reliable.higherBandwidthSDP(n.sdp)}m.setLocalDescription(n,function(){a.log("Set localDescription: offer","for:",k.peer);k.provider.socket.send({type:"OFFER",payload:{sdp:n,type:k.type,label:k.label,connectionId:k.id,reliable:k.reliable,serialization:k.serialization,metadata:k.metadata,browser:a.browser},dst:k.peer})},function(o){k.provider.emitError("webrtc",o);a.log("Failed to setLocalDescription, ",o)})},function(n){k.provider.emitError("webrtc",n);a.log("Failed to createOffer, ",n)},k.options.constraints)};g._makeAnswer=function(k){var m=k.pc;m.createAnswer(function(n){a.log("Created answer.");if(!a.supports.sctp&&k.type==="data"&&k.reliable){n.sdp=Reliable.higherBandwidthSDP(n.sdp)}m.setLocalDescription(n,function(){a.log("Set localDescription: answer","for:",k.peer);k.provider.socket.send({type:"ANSWER",payload:{sdp:n,type:k.type,connectionId:k.id,browser:a.browser},dst:k.peer})},function(o){k.provider.emitError("webrtc",o);a.log("Failed to setLocalDescription, ",o)})},function(n){k.provider.emitError("webrtc",n);a.log("Failed to create answer, ",n)})};g.handleSDP=function(o,m,k){k=new j(k);var n=m.pc;a.log("Setting remote description",k);n.setRemoteDescription(k,function(){a.log("Set remoteDescription:",o,"for:",m.peer);if(o==="OFFER"){g._makeAnswer(m)}},function(p){m.provider.emitError("webrtc",p);a.log("Failed to setRemoteDescription, ",p)})};g.handleCandidate=function(m,o){var n=o.candidate;var k=o.sdpMLineIndex;m.pc.addIceCandidate(new h({sdpMLineIndex:k,candidate:n}));a.log("Added ICE candidate for:",m.peer)};f.exports=g},{"./adapter":1,"./util":8}],6:[function(d,b,f){var h=d("./util");var k=d("eventemitter3");var a=d("./socket");var c=d("./mediaconnection");var g=d("./dataconnection");function j(n,m){if(!(this instanceof j)){return new j(n,m)}k.call(this);if(n&&n.constructor==Object){m=n;n=undefined}else{if(n){n=n.toString()}}m=h.extend({debug:0,host:h.CLOUD_HOST,port:h.CLOUD_PORT,key:"peerjs",path:"/",token:h.randomToken(),config:h.defaultConfig},m);this.options=m;if(m.host==="/"){m.host=window.location.hostname}if(m.path[0]!=="/"){m.path="/"+m.path}if(m.path[m.path.length-1]!=="/"){m.path+="/"}if(m.secure===undefined&&m.host!==h.CLOUD_HOST){m.secure=h.isSecure()}if(m.logFunction){h.setLogFunction(m.logFunction)}h.setLogLevel(m.debug);if(!h.supports.audioVideo&&!h.supports.data){this._delayedAbort("browser-incompatible","The current browser does not support WebRTC");return}if(!h.validateId(n)){this._delayedAbort("invalid-id",'ID "'+n+'" is invalid');return}if(!h.validateKey(m.key)){this._delayedAbort("invalid-key",'API KEY "'+m.key+'" is invalid');return}if(m.secure&&m.host==="0.peerjs.com"){this._delayedAbort("ssl-unavailable","The cloud server currently does not support HTTPS. Please run your own PeerServer to use HTTPS.");return}this.destroyed=false;this.disconnected=false;this.open=false;this.connections={};this._lostMessages={};this._initializeServerConnection();if(n){this._initialize(n)}else{this._retrieveId()}}h.inherits(j,k);j.prototype._initializeServerConnection=function(){var m=this;this.socket=new a(this.options.secure,this.options.host,this.options.port,this.options.path,this.options.key);this.socket.on("message",function(n){m._handleMessage(n)});this.socket.on("error",function(n){m._abort("socket-error",n)});this.socket.on("disconnected",function(){if(!m.disconnected){m.emitError("network","Lost connection to server.");m.disconnect()}});this.socket.on("close",function(){if(!m.disconnected){m._abort("socket-closed","Underlying socket is already closed.")}})};j.prototype._retrieveId=function(m){var n=this;var p=new XMLHttpRequest();var q=this.options.secure?"https://":"http://";var o=q+this.options.host+":"+this.options.port+this.options.path+this.options.key+"/id";var r="?ts="+new Date().getTime()+""+Math.random();o+=r;p.open("get",o,true);p.onerror=function(t){h.error("Error retrieving ID",t);var s="";if(n.options.path==="/"&&n.options.host!==h.CLOUD_HOST){s=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."}n._abort("server-error","Could not get an ID from the server."+s)};p.onreadystatechange=function(){if(p.readyState!==4){return}if(p.status!==200){p.onerror();return}n._initialize(p.responseText)};p.send(null)};j.prototype._initialize=function(m){this.id=m;this.socket.start(this.id,this.options.token)};j.prototype._handleMessage=function(v){var s=v.type;var t=v.payload;var r=v.src;var n;switch(s){case"OPEN":this.emit("open",this.id);this.open=true;break;case"ERROR":this._abort("server-error",t.msg);break;case"ID-TAKEN":this._abort("unavailable-id","ID `"+this.id+"` is taken");break;case"INVALID-KEY":this._abort("invalid-key",'API KEY "'+this.options.key+'" is invalid');break;case"LEAVE":h.log("Received leave message from",r);this._cleanupPeer(r);break;case"EXPIRE":this.emitError("peer-unavailable","Could not connect to peer "+r);break;case"OFFER":var q=t.connectionId;n=this.getConnection(r,q);if(n){h.warn("Offer received for existing Connection ID:",q)}else{if(t.type==="media"){n=new c(r,this,{connectionId:q,_payload:t,metadata:t.metadata});this._addConnection(r,n);this.emit("call",n)}else{if(t.type==="data"){n=new g(r,this,{connectionId:q,_payload:t,metadata:t.metadata,label:t.label,serialization:t.serialization,reliable:t.reliable});this._addConnection(r,n);this.emit("connection",n)}else{h.warn("Received malformed connection type:",t.type);return}}var o=this._getMessages(q);for(var p=0,u=o.length;p<u;p+=1){n.handleMessage(o[p])}}break;default:if(!t){h.warn("You received a malformed message from "+r+" of type "+s);return}var m=t.connectionId;n=this.getConnection(r,m);if(n&&n.pc){n.handleMessage(v)}else{if(m){this._storeMessage(m,v)}else{h.warn("You received an unrecognized message:",v)}}break}};j.prototype._storeMessage=function(n,m){if(!this._lostMessages[n]){this._lostMessages[n]=[]}this._lostMessages[n].push(m)};j.prototype._getMessages=function(n){var m=this._lostMessages[n];if(m){delete this._lostMessages[n];return m}else{return[]}};j.prototype.connect=function(o,n){if(this.disconnected){h.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available.");this.emitError("disconnected","Cannot connect to new Peer after disconnecting from server.");return}var m=new g(o,this,n);this._addConnection(o,m);return m};j.prototype.call=function(o,p,m){if(this.disconnected){h.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect.");this.emitError("disconnected","Cannot connect to new Peer after disconnecting from server.");return}if(!p){h.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");return}m=m||{};m._stream=p;var n=new c(o,this,m);this._addConnection(o,n);return n};j.prototype._addConnection=function(n,m){if(!this.connections[n]){this.connections[n]=[]}this.connections[n].push(m)};j.prototype.getConnection=function(p,q){var n=this.connections[p];if(!n){return null}for(var m=0,o=n.length;m<o;m++){if(n[m].id===q){return n[m]}}return null};j.prototype._delayedAbort=function(n,o){var m=this;h.setZeroTimeout(function(){m._abort(n,o)})};j.prototype._abort=function(m,n){h.error("Aborting!");if(!this._lastServerId){this.destroy()}else{this.disconnect()}this.emitError(m,n)};j.prototype.emitError=function(m,n){h.error("Error:",n);if(typeof n==="string"){n=new Error(n)}n.type=m;this.emit("error",n)};j.prototype.destroy=function(){if(!this.destroyed){this._cleanup();this.disconnect();this.destroyed=true}};j.prototype._cleanup=function(){if(this.connections){var m=Object.keys(this.connections);for(var n=0,o=m.length;n<o;n++){this._cleanupPeer(m[n])}}this.emit("close")};j.prototype._cleanupPeer=function(p){var n=this.connections[p];for(var m=0,o=n.length;m<o;m+=1){n[m].close()}};j.prototype.disconnect=function(){var m=this;h.setZeroTimeout(function(){if(!m.disconnected){m.disconnected=true;m.open=false;if(m.socket){m.socket.close()}m.emit("disconnected",m.id);m._lastServerId=m.id;m.id=null}})};j.prototype.reconnect=function(){if(this.disconnected&&!this.destroyed){h.log("Attempting reconnection to server with ID "+this._lastServerId);this.disconnected=false;this._initializeServerConnection();this._initialize(this._lastServerId)}else{if(this.destroyed){throw new Error("This peer cannot reconnect to the server. It has already been destroyed.")}else{if(!this.disconnected&&!this.open){h.error("In a hurry? We're still trying to make the initial connection!")}else{throw new Error("Peer "+this.id+" cannot reconnect because it is not disconnected from the server!")}}}};j.prototype.listAllPeers=function(m){m=m||function(){};var n=this;var p=new XMLHttpRequest();var q=this.options.secure?"https://":"http://";var o=q+this.options.host+":"+this.options.port+this.options.path+this.options.key+"/peers";var r="?ts="+new Date().getTime()+""+Math.random();o+=r;p.open("get",o,true);p.onerror=function(s){n._abort("server-error","Could not get peers from the server.");m([])};p.onreadystatechange=function(){if(p.readyState!==4){return}if(p.status===401){var s="";if(n.options.host!==h.CLOUD_HOST){s="It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key."}else{s="You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature."}m([]);throw new Error("It doesn't look like you have permission to list peers IDs. "+s)}else{if(p.status!==200){m([])}else{m(JSON.parse(p.responseText))}}};p.send(null)};b.exports=j},{"./dataconnection":2,"./mediaconnection":4,"./socket":7,"./util":8,eventemitter3:9}],7:[function(d,f,c){var b=d("./util");var g=d("eventemitter3");function a(p,n,h,o,j){if(!(this instanceof a)){return new a(p,n,h,o,j)}g.call(this);this.disconnected=false;this._queue=[];var m=p?"https://":"http://";var k=p?"wss://":"ws://";this._httpUrl=m+n+":"+h+o+j;this._wsUrl=k+n+":"+h+o+"peerjs?key="+j}b.inherits(a,g);a.prototype.start=function(j,h){this.id=j;this._httpUrl+="/"+j+"/"+h;this._wsUrl+="&id="+j+"&token="+h;this._startXhrStream();this._startWebSocket()};a.prototype._startWebSocket=function(j){var h=this;if(this._socket){return}this._socket=new WebSocket(this._wsUrl);this._socket.onmessage=function(k){try{var m=JSON.parse(k.data)}catch(n){b.log("Invalid server message",k.data);return}h.emit("message",m)};this._socket.onclose=function(k){b.log("Socket closed.");h.disconnected=true;h.emit("disconnected")};this._socket.onopen=function(){if(h._timeout){clearTimeout(h._timeout);setTimeout(function(){h._http.abort();h._http=null},5000)}h._sendQueuedMessages();b.log("Socket open")}};a.prototype._startXhrStream=function(k){try{var h=this;this._http=new XMLHttpRequest();this._http._index=1;this._http._streamIndex=k||0;this._http.open("post",this._httpUrl+"/id?i="+this._http._streamIndex,true);this._http.onerror=function(){clearTimeout(h._timeout);h.emit("disconnected")};this._http.onreadystatechange=function(){if(this.readyState==2&&this.old){this.old.abort();delete this.old}else{if(this.readyState>2&&this.status===200&&this.responseText){h._handleStream(this)}}};this._http.send(null);this._setHTTPTimeout()}catch(j){b.log("XMLHttpRequest not available; defaulting to WebSockets")}};a.prototype._handleStream=function(k){var n=k.responseText.split("\n");if(k._buffer){while(k._buffer.length>0){var j=k._buffer.shift();var h=n[j];try{h=JSON.parse(h)}catch(o){k._buffer.shift(j);break}this.emit("message",h)}}var m=n[k._index];if(m){k._index+=1;if(k._index===n.length){if(!k._buffer){k._buffer=[]}k._buffer.push(k._index-1)}else{try{m=JSON.parse(m)}catch(o){b.log("Invalid server message",m);return}this.emit("message",m)}}};a.prototype._setHTTPTimeout=function(){var h=this;this._timeout=setTimeout(function(){var j=h._http;if(!h._wsOpen()){h._startXhrStream(j._streamIndex+1);h._http.old=j}else{j.abort()}},25000)};a.prototype._wsOpen=function(){return this._socket&&this._socket.readyState==1};a.prototype._sendQueuedMessages=function(){for(var h=0,j=this._queue.length;h<j;h+=1){this.send(this._queue[h])}};a.prototype.send=function(m){if(this.disconnected){return}if(!this.id){this._queue.push(m);return}if(!m.type){this.emit("error","Invalid message");return}var k=JSON.stringify(m);if(this._wsOpen()){this._socket.send(k)}else{var j=new XMLHttpRequest();var h=this._httpUrl+"/"+m.type.toLowerCase();j.open("post",h,true);j.setRequestHeader("Content-Type","application/json");j.send(k)}};a.prototype.close=function(){if(!this.disconnected&&this._wsOpen()){this._socket.close();this.disconnected=true}};f.exports=a},{"./util":8,eventemitter3:9}],8:[function(d,g,c){var a={iceServers:[{url:"stun:stun.l.google.com:19302"}]};var j=1;var h=d("js-binarypack");var f=d("./adapter").RTCPeerConnection;var b={noop:function(){},CLOUD_HOST:"0.peerjs.com",CLOUD_PORT:9000,chunkedBrowsers:{Chrome:1},chunkedMTU:16300,logLevel:0,setLogLevel:function(m){var k=parseInt(m,10);if(!isNaN(parseInt(m,10))){b.logLevel=k}else{b.logLevel=m?3:0}b.log=b.warn=b.error=b.noop;if(b.logLevel>0){b.error=b._printWith("ERROR")}if(b.logLevel>1){b.warn=b._printWith("WARNING")}if(b.logLevel>2){b.log=b._print}},setLogFunction:function(k){if(k.constructor!==Function){b.warn("The log function you passed in is not a function. Defaulting to regular logs.")}else{b._print=k}},_printWith:function(k){return function(){var m=Array.prototype.slice.call(arguments);m.unshift(k);b._print.apply(b,m)}},_print:function(){var n=false;var o=Array.prototype.slice.call(arguments);o.unshift("PeerJS: ");for(var m=0,k=o.length;m<k;m++){if(o[m] instanceof Error){o[m]="("+o[m].name+") "+o[m].message;n=true}}n?console.error.apply(console,o):console.log.apply(console,o)},defaultConfig:a,browser:(function(){if(window.mozRTCPeerConnection){return"Firefox"}else{if(window.webkitRTCPeerConnection){return"Chrome"}else{if(window.RTCPeerConnection){return"Supported"}else{return"Unsupported"}}}})(),supports:(function(){if(typeof f==="undefined"){return{}}var r=true;var o=true;var p=false;var n=false;var s=!!window.webkitRTCPeerConnection;var u,v;try{u=new f(a,{optional:[{RtpDataChannels:true}]})}catch(t){r=false;o=false}if(r){try{v=u.createDataChannel("_PEERJSTEST")}catch(t){r=false}}if(r){try{v.binaryType="blob";p=true}catch(t){}var m=new f(a,{});try{var q=m.createDataChannel("_PEERJSRELIABLETEST",{});n=q.reliable}catch(t){}m.close()}if(o){o=!!u.addStream}if(!s&&r){var k=new f(a,{optional:[{RtpDataChannels:true}]});k.onnegotiationneeded=function(){s=true;if(b&&b.supports){b.supports.onnegotiationneeded=true}};k.createDataChannel("_PEERJSNEGOTIATIONTEST");setTimeout(function(){k.close()},1000)}if(u){u.close()}return{audioVideo:o,data:r,binaryBlob:p,binary:n,reliable:n,sctp:n,onnegotiationneeded:s}}()),validateId:function(k){return !k||/^[A-Za-z0-9_-]+(?:[ _-][A-Za-z0-9]+)*$/.exec(k)},validateKey:function(k){return !k||/^[A-Za-z0-9_-]+(?:[ _-][A-Za-z0-9]+)*$/.exec(k)},debug:false,inherits:function(m,k){m.super_=k;m.prototype=Object.create(k.prototype,{constructor:{value:m,enumerable:false,writable:true,configurable:true}})},extend:function(k,n){for(var m in n){if(n.hasOwnProperty(m)){k[m]=n[m]}}return k},pack:h.pack,unpack:h.unpack,log:function(){if(b.debug){var n=false;var o=Array.prototype.slice.call(arguments);o.unshift("PeerJS: ");for(var m=0,k=o.length;m<k;m++){if(o[m] instanceof Error){o[m]="("+o[m].name+") "+o[m].message;n=true}}n?console.error.apply(console,o):console.log.apply(console,o)}},setZeroTimeout:(function(o){var m=[];var k="zero-timeout-message";function n(q){m.push(q);o.postMessage(k,"*")}function p(q){if(q.source==o&&q.data==k){if(q.stopPropagation){q.stopPropagation()}if(m.length){m.shift()()}}}if(o.addEventListener){o.addEventListener("message",p,true)}else{if(o.attachEvent){o.attachEvent("onmessage",p)}}return n}(window)),chunk:function(s){var r=[];var o=s.size;var q=index=0;var p=Math.ceil(o/b.chunkedMTU);while(q<o){var m=Math.min(o,q+b.chunkedMTU);var k=s.slice(q,m);var n={__peerData:j,n:index,data:k,total:p};r.push(n);q=m;index+=1}j+=1;return r},blobToArrayBuffer:function(n,k){var m=new FileReader();m.onload=function(o){k(o.target.result)};m.readAsArrayBuffer(n)},blobToBinaryString:function(n,k){var m=new FileReader();m.onload=function(o){k(o.target.result)};m.readAsBinaryString(n)},binaryStringToArrayBuffer:function(n){var k=new Uint8Array(n.length);for(var m=0;m<n.length;m++){k[m]=n.charCodeAt(m)&255}return k.buffer},randomToken:function(){return Math.random().toString(36).substr(2)},isSecure:function(){return location.protocol==="https:"}};g.exports=b},{"./adapter":1,"js-binarypack":10}],9:[function(d,c,f){function o(r,p,q){this.fn=r;this.context=p;this.once=q||false}function n(){}n.prototype._events=undefined;n.prototype.listeners=function j(s){if(!this._events||!this._events[s]){return[]}for(var r=0,q=this._events[s].length,p=[];r<q;r++){p.push(this._events[s][r].fn)}return p};n.prototype.emit=function k(q,s,r,p,B,A){if(!this._events||!this._events[q]){return false}var z=this._events[q],t=z.length,x=arguments.length,w=z[0],y,v,u;if(1===t){if(w.once){this.removeListener(q,w.fn,true)}switch(x){case 1:return w.fn.call(w.context),true;case 2:return w.fn.call(w.context,s),true;case 3:return w.fn.call(w.context,s,r),true;case 4:return w.fn.call(w.context,s,r,p),true;case 5:return w.fn.call(w.context,s,r,p,B),true;case 6:return w.fn.call(w.context,s,r,p,B,A),true}for(v=1,y=new Array(x-1);v<x;v++){y[v-1]=arguments[v]}w.fn.apply(w.context,y)}else{for(v=0;v<t;v++){if(z[v].once){this.removeListener(q,z[v].fn,true)}switch(x){case 1:z[v].fn.call(z[v].context);break;case 2:z[v].fn.call(z[v].context,s);break;case 3:z[v].fn.call(z[v].context,s,r);break;default:if(!y){for(u=1,y=new Array(x-1);u<x;u++){y[u-1]=arguments[u]}}z[v].fn.apply(z[v].context,y)}}}return true};n.prototype.on=function h(r,q,p){if(!this._events){this._events={}}if(!this._events[r]){this._events[r]=[]}this._events[r].push(new o(q,p||this));return this};n.prototype.once=function b(r,q,p){if(!this._events){this._events={}}if(!this._events[r]){this._events[r]=[]}this._events[r].push(new o(q,p||this,true));return this};n.prototype.removeListener=function g(v,t,s){if(!this._events||!this._events[v]){return this}var r=this._events[v],q=[];if(t){for(var p=0,u=r.length;p<u;p++){if(r[p].fn!==t&&r[p].once!==s){q.push(r[p])}}}if(q.length){this._events[v]=q}else{this._events[v]=null}return this};n.prototype.removeAllListeners=function m(p){if(!this._events){return this}if(p){this._events[p]=null}else{this._events={}}return this};n.prototype.off=n.prototype.removeListener;n.prototype.addListener=n.prototype.on;n.prototype.setMaxListeners=function a(){return this};n.EventEmitter=n;n.EventEmitter2=n;n.EventEmitter3=n;if("object"===typeof c&&c.exports){c.exports=n}},{}],10:[function(d,b,g){var c=d("./bufferbuilder").BufferBuilder;var f=d("./bufferbuilder").binaryFeatures;var m={unpack:function(o){var n=new j(o);return n.unpack()},pack:function(o){var p=new h();p.pack(o);var n=p.getBuffer();return n}};b.exports=m;function j(n){this.index=0;this.dataBuffer=n;this.dataView=new Uint8Array(this.dataBuffer);this.length=this.dataBuffer.byteLength}j.prototype.unpack=function(){var q=this.unpack_uint8();if(q<128){var p=q;return p}else{if((q^224)<32){var n=(q^224)-32;return n}}var o;if((o=q^160)<=15){return this.unpack_raw(o)}else{if((o=q^176)<=15){return this.unpack_string(o)}else{if((o=q^144)<=15){return this.unpack_array(o)}else{if((o=q^128)<=15){return this.unpack_map(o)}}}}switch(q){case 192:return null;case 193:return undefined;case 194:return false;case 195:return true;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:return undefined;case 213:return undefined;case 214:return undefined;case 215:return undefined;case 216:o=this.unpack_uint16();return this.unpack_string(o);case 217:o=this.unpack_uint32();return this.unpack_string(o);case 218:o=this.unpack_uint16();return this.unpack_raw(o);case 219:o=this.unpack_uint32();return this.unpack_raw(o);case 220:o=this.unpack_uint16();return this.unpack_array(o);case 221:o=this.unpack_uint32();return this.unpack_array(o);case 222:o=this.unpack_uint16();return this.unpack_map(o);case 223:o=this.unpack_uint32();return this.unpack_map(o)}};j.prototype.unpack_uint8=function(){var n=this.dataView[this.index]&255;this.index++;return n};j.prototype.unpack_uint16=function(){var n=this.read(2);var o=((n[0]&255)*256)+(n[1]&255);this.index+=2;return o};j.prototype.unpack_uint32=function(){var n=this.read(4);var o=((n[0]*256+n[1])*256+n[2])*256+n[3];this.index+=4;return o};j.prototype.unpack_uint64=function(){var n=this.read(8);var o=((((((n[0]*256+n[1])*256+n[2])*256+n[3])*256+n[4])*256+n[5])*256+n[6])*256+n[7];this.index+=8;return o};j.prototype.unpack_int8=function(){var n=this.unpack_uint8();return(n<128)?n:n-(1<<8)};j.prototype.unpack_int16=function(){var n=this.unpack_uint16();return(n<32768)?n:n-(1<<16)};j.prototype.unpack_int32=function(){var n=this.unpack_uint32();return(n<Math.pow(2,31))?n:n-Math.pow(2,32)};j.prototype.unpack_int64=function(){var n=this.unpack_uint64();return(n<Math.pow(2,63))?n:n-Math.pow(2,64)};j.prototype.unpack_raw=function(o){if(this.length<this.index+o){throw new Error("BinaryPackFailure: index is out of range "+this.index+" "+o+" "+this.length)}var n=this.dataBuffer.slice(this.index,this.index+o);this.index+=o;return n};j.prototype.unpack_string=function(p){var n=this.read(p);var o=0,r="",s,q;while(o<p){s=n[o];if(s<128){r+=String.fromCharCode(s);o++}else{if((s^192)<32){q=((s^192)<<6)|(n[o+1]&63);r+=String.fromCharCode(q);o+=2}else{q=((s&15)<<12)|((n[o+1]&63)<<6)|(n[o+2]&63);r+=String.fromCharCode(q);o+=3}}}this.index+=p;return r};j.prototype.unpack_array=function(o){var p=new Array(o);for(var n=0;n<o;n++){p[n]=this.unpack()}return p};j.prototype.unpack_map=function(p){var r={};for(var o=0;o<p;o++){var n=this.unpack();var q=this.unpack();r[n]=q}return r};j.prototype.unpack_float=function(){var o=this.unpack_uint32();var n=o>>31;var q=((o>>23)&255)-127;var p=(o&8388607)|8388608;return(n==0?1:-1)*p*Math.pow(2,q-23)};j.prototype.unpack_double=function(){var s=this.unpack_uint32();var q=this.unpack_uint32();var o=s>>31;var r=((s>>20)&2047)-1023;var n=(s&1048575)|1048576;var p=n*Math.pow(2,r-20)+q*Math.pow(2,r-52);return(o==0?1:-1)*p};j.prototype.read=function(o){var n=this.index;if(n+o<=this.length){return this.dataView.subarray(n,n+o)}else{throw new Error("BinaryPackFailure: read index out of range")}};function h(){this.bufferBuilder=new c()}h.prototype.getBuffer=function(){return this.bufferBuilder.getBuffer()};h.prototype.pack=function(p){var o=typeof(p);if(o=="string"){this.pack_string(p)}else{if(o=="number"){if(Math.floor(p)===p){this.pack_integer(p)}else{this.pack_double(p)}}else{if(o=="boolean"){if(p===true){this.bufferBuilder.append(195)}else{if(p===false){this.bufferBuilder.append(194)}}}else{if(o=="undefined"){this.bufferBuilder.append(192)}else{if(o=="object"){if(p===null){this.bufferBuilder.append(192)}else{var n=p.constructor;if(n==Array){this.pack_array(p)}else{if(n==Blob||n==File){this.pack_bin(p)}else{if(n==ArrayBuffer){if(f.useArrayBufferView){this.pack_bin(new Uint8Array(p))}else{this.pack_bin(p)}}else{if("BYTES_PER_ELEMENT" in p){if(f.useArrayBufferView){this.pack_bin(new Uint8Array(p.buffer))}else{this.pack_bin(p.buffer)}}else{if(n==Object){this.pack_object(p)}else{if(n==Date){this.pack_string(p.toString())}else{if(typeof p.toBinaryPack=="function"){this.bufferBuilder.append(p.toBinaryPack())}else{throw new Error('Type "'+n.toString()+'" not yet supported')}}}}}}}}}else{throw new Error('Type "'+o+'" not yet supported')}}}}}this.bufferBuilder.flush()};h.prototype.pack_bin=function(n){var o=n.length||n.byteLength||n.size;if(o<=15){this.pack_uint8(160+o)}else{if(o<=65535){this.bufferBuilder.append(218);this.pack_uint16(o)}else{if(o<=4294967295){this.bufferBuilder.append(219);this.pack_uint32(o)}else{throw new Error("Invalid length")}}}this.bufferBuilder.append(n)};h.prototype.pack_string=function(o){var n=k(o);if(n<=15){this.pack_uint8(176+n)}else{if(n<=65535){this.bufferBuilder.append(216);this.pack_uint16(n)}else{if(n<=4294967295){this.bufferBuilder.append(217);this.pack_uint32(n)}else{throw new Error("Invalid length")}}}this.bufferBuilder.append(o)};h.prototype.pack_array=function(o){var p=o.length;if(p<=15){this.pack_uint8(144+p)}else{if(p<=65535){this.bufferBuilder.append(220);this.pack_uint16(p)}else{if(p<=4294967295){this.bufferBuilder.append(221);this.pack_uint32(p)}else{throw new Error("Invalid length")}}}for(var n=0;n<p;n++){this.pack(o[n])}};h.prototype.pack_integer=function(n){if(-32<=n&&n<=127){this.bufferBuilder.append(n&255)}else{if(0<=n&&n<=255){this.bufferBuilder.append(204);this.pack_uint8(n)}else{if(-128<=n&&n<=127){this.bufferBuilder.append(208);this.pack_int8(n)}else{if(0<=n&&n<=65535){this.bufferBuilder.append(205);this.pack_uint16(n)}else{if(-32768<=n&&n<=32767){this.bufferBuilder.append(209);this.pack_int16(n)}else{if(0<=n&&n<=4294967295){this.bufferBuilder.append(206);this.pack_uint32(n)}else{if(-2147483648<=n&&n<=2147483647){this.bufferBuilder.append(210);this.pack_int32(n)}else{if(-9223372036854776000<=n&&n<=9223372036854776000){this.bufferBuilder.append(211);this.pack_int64(n)}else{if(0<=n&&n<=18446744073709552000){this.bufferBuilder.append(207);this.pack_uint64(n)}else{throw new Error("Invalid integer")}}}}}}}}}};h.prototype.pack_double=function(p){var o=0;if(p<0){o=1;p=-p}var u=Math.floor(Math.log(p)/Math.LN2);var t=p/Math.pow(2,u)-1;var r=Math.floor(t*Math.pow(2,52));var n=Math.pow(2,32);var s=(o<<31)|((u+1023)<<20)|(r/n)&1048575;var q=r%n;this.bufferBuilder.append(203);this.pack_int32(s);this.pack_int32(q)};h.prototype.pack_object=function(p){var o=Object.keys(p);var n=o.length;if(n<=15){this.pack_uint8(128+n)}else{if(n<=65535){this.bufferBuilder.append(222);this.pack_uint16(n)}else{if(n<=4294967295){this.bufferBuilder.append(223);this.pack_uint32(n)}else{throw new Error("Invalid length")}}}for(var q in p){if(p.hasOwnProperty(q)){this.pack(q);this.pack(p[q])}}};h.prototype.pack_uint8=function(n){this.bufferBuilder.append(n)};h.prototype.pack_uint16=function(n){this.bufferBuilder.append(n>>8);this.bufferBuilder.append(n&255)};h.prototype.pack_uint32=function(o){var p=o&4294967295;this.bufferBuilder.append((p&4278190080)>>>24);this.bufferBuilder.append((p&16711680)>>>16);this.bufferBuilder.append((p&65280)>>>8);this.bufferBuilder.append((p&255))};h.prototype.pack_uint64=function(o){var p=o/Math.pow(2,32);var n=o%Math.pow(2,32);this.bufferBuilder.append((p&4278190080)>>>24);this.bufferBuilder.append((p&16711680)>>>16);this.bufferBuilder.append((p&65280)>>>8);this.bufferBuilder.append((p&255));this.bufferBuilder.append((n&4278190080)>>>24);this.bufferBuilder.append((n&16711680)>>>16);this.bufferBuilder.append((n&65280)>>>8);this.bufferBuilder.append((n&255))};h.prototype.pack_int8=function(n){this.bufferBuilder.append(n&255)};h.prototype.pack_int16=function(n){this.bufferBuilder.append((n&65280)>>8);this.bufferBuilder.append(n&255)};h.prototype.pack_int32=function(n){this.bufferBuilder.append((n>>>24)&255);this.bufferBuilder.append((n&16711680)>>>16);this.bufferBuilder.append((n&65280)>>>8);this.bufferBuilder.append((n&255))};h.prototype.pack_int64=function(o){var p=Math.floor(o/Math.pow(2,32));var n=o%Math.pow(2,32);this.bufferBuilder.append((p&4278190080)>>>24);this.bufferBuilder.append((p&16711680)>>>16);this.bufferBuilder.append((p&65280)>>>8);this.bufferBuilder.append((p&255));this.bufferBuilder.append((n&4278190080)>>>24);this.bufferBuilder.append((n&16711680)>>>16);this.bufferBuilder.append((n&65280)>>>8);this.bufferBuilder.append((n&255))};function a(n){var o=n.charCodeAt(0);if(o<=2047){return"00"}if(o<=65535){return"000"}if(o<=2097151){return"0000"}if(o<=67108863){return"00000"}return"000000"}function k(n){if(n.length>600){return(new Blob([n])).size}else{return n.replace(/[^\u0000-\u007F]/g,a).length}}},{"./bufferbuilder":11}],11:[function(d,f,b){var a={};a.useBlobBuilder=(function(){try{new Blob([]);return false}catch(h){return true}})();a.useArrayBufferView=!a.useBlobBuilder&&(function(){try{return(new Blob([new Uint8Array([])])).size===0}catch(h){return true}})();f.exports.binaryFeatures=a;var g=f.exports.BlobBuilder;if(typeof window!="undefined"){g=f.exports.BlobBuilder=window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder||window.BlobBuilder}function c(){this._pieces=[];this._parts=[]}c.prototype.append=function(h){if(typeof h==="number"){this._pieces.push(h)}else{this.flush();this._parts.push(h)}};c.prototype.flush=function(){if(this._pieces.length>0){var h=new Uint8Array(this._pieces);if(!a.useArrayBufferView){h=h.buffer}this._parts.push(h);this._pieces=[]}};c.prototype.getBuffer=function(){this.flush();if(a.useBlobBuilder){var h=new g();for(var j=0,k=this._parts.length;j<k;j++){h.append(this._parts[j])}return h.getBlob()}else{return new Blob(this._parts)}};f.exports.BufferBuilder=c},{}],12:[function(d,f,c){var b=d("./util");function a(g,h){if(!(this instanceof a)){return new a(g)}this._dc=g;b.debug=h;this._outgoing={};this._incoming={};this._received={};this._window=1000;this._mtu=500;this._interval=0;this._count=0;this._queue=[];this._setupDC()}a.prototype.send=function(g){var h=b.pack(g);if(h.size<this._mtu){this._handleSend(["no",h]);return}this._outgoing[this._count]={ack:0,chunks:this._chunk(h)};if(b.debug){this._outgoing[this._count].timer=new Date()}this._sendWindowedChunks(this._count);this._count+=1};a.prototype._setupInterval=function(){var g=this;this._timeout=setInterval(function(){var k=g._queue.shift();if(k._multiple){for(var h=0,j=k.length;h<j;h+=1){g._intervalSend(k[h])}}else{g._intervalSend(k)}},this._interval)};a.prototype._intervalSend=function(h){var g=this;h=b.pack(h);b.blobToBinaryString(h,function(j){g._dc.send(j)});if(g._queue.length===0){clearTimeout(g._timeout);g._timeout=null}};a.prototype._processAcks=function(){for(var g in this._outgoing){if(this._outgoing.hasOwnProperty(g)){this._sendWindowedChunks(g)}}};a.prototype._handleSend=function(m){var g=true;for(var h=0,j=this._queue.length;h<j;h+=1){var k=this._queue[h];if(k===m){g=false}else{if(k._multiple&&k.indexOf(m)!==-1){g=false}}}if(g){this._queue.push(m);if(!this._timeout){this._setupInterval()}}};a.prototype._setupDC=function(){var g=this;this._dc.onmessage=function(k){var m=k.data;var h=m.constructor;if(h===String){var j=b.binaryStringToArrayBuffer(m);m=b.unpack(j);g._handleMessage(m)}}};a.prototype._handleMessage=function(j){var g=j[1];var k=this._incoming[g];var q=this._outgoing[g];var o;switch(j[0]){case"no":var s=g;if(!!s){this.onmessage(b.unpack(s))}break;case"end":o=k;this._received[g]=j[2];if(!o){break}this._ack(g);break;case"ack":o=q;if(!!o){var r=j[2];o.ack=Math.max(r,o.ack);if(o.ack>=o.chunks.length){b.log("Time: ",new Date()-o.timer);delete this._outgoing[g]}else{this._processAcks()}}break;case"chunk":o=k;if(!o){var m=this._received[g];if(m===true){break}o={ack:["ack",g,0],chunks:[]};this._incoming[g]=o}var h=j[2];var p=j[3];o.chunks[h]=new Uint8Array(p);if(h===o.ack[2]){this._calculateNextAck(g)}this._ack(g);break;default:this._handleSend(j);break}};a.prototype._chunk=function(o){var n=[];var k=o.size;var m=0;while(m<k){var h=Math.min(k,m+this._mtu);var g=o.slice(m,h);var j={payload:g};n.push(j);m=h}b.log("Created",n.length,"chunks.");return n};a.prototype._ack=function(h){var g=this._incoming[h].ack;if(this._received[h]===g[2]){this._complete(h);this._received[h]=true}this._handleSend(g)};a.prototype._calculateNextAck=function(m){var j=this._incoming[m];var k=j.chunks;for(var g=0,h=k.length;g<h;g+=1){if(k[g]===undefined){j.ack[2]=g;return}}j.ack[2]=k.length};a.prototype._sendWindowedChunks=function(n){b.log("sendWindowedChunks for: ",n);var k=this._outgoing[n];var j=k.chunks;var m=[];var g=Math.min(k.ack+this._window,j.length);for(var h=k.ack;h<g;h+=1){if(!j[h].sent||h===k.ack){j[h].sent=true;m.push(["chunk",n,h,j[h].payload])}}if(k.ack+this._window>=j.length){m.push(["end",n,j.length])}m._multiple=true;this._handleSend(m)};a.prototype._complete=function(k){b.log("Completed called for",k);var g=this;var j=this._incoming[k].chunks;var h=new Blob(j);b.blobToArrayBuffer(h,function(m){g.onmessage(b.unpack(m))});delete this._incoming[k]};a.higherBandwidthSDP=function(h){var g=navigator.appVersion.match(/Chrome\/(.*?) /);if(g){g=parseInt(g[1].split(".").shift());if(g<31){var k=h.split("b=AS:30");var j="b=AS:102400";if(k.length>1){return k[0]+j+k[1]}}}return h};a.prototype.onmessage=function(g){};f.exports.Reliable=a},{"./util":13}],13:[function(c,d,b){var f=c("js-binarypack");var a={debug:false,inherits:function(h,g){h.super_=g;h.prototype=Object.create(g.prototype,{constructor:{value:h,enumerable:false,writable:true,configurable:true}})},extend:function(g,j){for(var h in j){if(j.hasOwnProperty(h)){g[h]=j[h]}}return g},pack:f.pack,unpack:f.unpack,log:function(){if(a.debug){var h=[];for(var g=0;g<arguments.length;g++){h[g]=arguments[g]}h.unshift("Reliable: ");console.log.apply(console,h)}},setZeroTimeout:(function(k){var h=[];var g="zero-timeout-message";function j(n){h.push(n);k.postMessage(g,"*")}function m(n){if(n.source==k&&n.data==g){if(n.stopPropagation){n.stopPropagation()}if(h.length){h.shift()()}}}if(k.addEventListener){k.addEventListener("message",m,true)}else{if(k.attachEvent){k.attachEvent("onmessage",m)}}return j}(this)),blobToArrayBuffer:function(j,g){var h=new FileReader();h.onload=function(k){g(k.target.result)};h.readAsArrayBuffer(j)},blobToBinaryString:function(j,g){var h=new FileReader();h.onload=function(k){g(k.target.result)};h.readAsBinaryString(j)},binaryStringToArrayBuffer:function(j){var g=new Uint8Array(j.length);for(var h=0;h<j.length;h++){g[h]=j.charCodeAt(h)&255}return g.buffer},randomToken:function(){return Math.random().toString(36).substr(2)}};d.exports=a},{"js-binarypack":10}]},{},[3]);function SecondScreen(d,D,t,C,B,W,ah,A){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia;var U=SecondScreenUtils.$;var f="\u0002";var s=1;var E=2;var ag=3;var R=5;var al=8;var k=10;var p=12;var ar=15;var ao=17;var ac=18;var X=19;var T=20;var r=21;var v=31;var M=32;var n=33;var an=34;var ab=39;var q=48;var Q=63;var ae=64;var J=65;var h=66;var c=67;var F=101;var ak=102;var af=103;var V=110;var O=112;var at=113;var b=114;var x=115;var j=116;var a=119;var o=75;var ad=76;var P=77;var g=78;var aa=79;var H=80;var G=81;var am=82;var z=83;var au=84;var ai=85;var Z=86;var aq=87;var S=88;var m=89;var I=91;var Y=92;var L=93;var ap=95;var N=96;var y=97;var w=98;var u=this;u.user_data={};u.user_data.comp_id=C;u.user_data.cookie_id=d;u.user_data.heads="[]";u.already_joined=false;u.reconnect_count=0;u.MAX_RECONNECT_COUNT=720;u.chat_hist_recvd=false;u.pending_proactive_chats=[];u.pending_tasks=[];u.active=false;u.inactive_timeout=null;u.idle_timeout=null;u.agent_present=null;u.sess_conf=B;u.bk_svr=B.bk;u._onconnect=[];u._onchatstart=[];u._onchatend=[];u._onprochat=[];u._onagentchat=[];u.last_sent=0;u.last_chat_recv_at=null;u.last_chat_agent="Agent";u.unread_chat_count=0;u.unread_chat_show_interval=null;u.unread_chat_show_helper=0;u.pending_move_timeout=null;u.pushed_evs=W;u.pushed_handlers=ah;u.support_agent_name=null;u.agent_id=null;u.agent_name=null;u.agent_email=null;u.latest_chat_id=null;u.visitor_feedback=0;u.curr_agent_focus=null;u.cur_page_triggers=null;u.online_depts={};u.webrtc_key=null;u.peer=null;u.calltype=null;u.pc_name="";u.pc_email="";u.pc_data=null;u.mobile=false;u.chat_cont_h=null;if(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i)){U.each(U('meta[name="viewport"]'),function(av,ax){var aw=U(ax).attr("content");if(aw.indexOf("user-scalable=0")!=-1||aw.indexOf("user-scalable=no")!=-1||aw.indexOf("user-scalable = 0")!=-1||aw.indexOf("user-scalable = no")!=-1){u.mobile=true}})}u.taq_convs=A;u.url_regex=/(https?:\/\/)?([a-z0-9\-]+\.)+([0-9]{1,3}|[a-z]{2}|biz|com|edu|gov|info|name|net|org)(:[0-9]+)?(\/\S*)?(?=\s+|$)/gi;for(var aj=0;aj<u.pushed_handlers.length;aj++){if(u.pushed_handlers[aj][0]=="connect"){u._onconnect.push(u.pushed_handlers[aj][1])}else{if(u.pushed_handlers[aj][0]=="chatstart"){u._onchatstart.push(u.pushed_handlers[aj][1])}else{if(u.pushed_handlers[aj][0]=="chatend"){u._onchatend.push(u.pushed_handlers[aj][1])}else{if(u.pushed_handlers[aj][0]=="prochat"){u._onprochat.push(u.pushed_handlers[aj][1])}else{if(u.pushed_handlers[aj][0]=="agentchat"){u._onagentchat.push(u.pushed_handlers[aj][1])}}}}}}u.pushed_handlers=[];var K=d+"-"+D+"-"+t;u.user_data.visitor_id=K;u.flick_title_interval=null;u.chat_enabled=true;u.chat_enabled_by_agent=false;u.prechat_enabled=false;u.offline_message_disabled=false;u.unavail_greet_enabled=false;if(_ss_track.options.chat_no_min){SecondScreen._write_sess_data("__ss_chat","1")}if(typeof _ss_track.options.chat_show!="undefined"&&_ss_track.options.chat_show==false){u.chat_enabled=false}if(typeof _ss_track.options.disable_chat!="undefined"&&_ss_track.options.disable_chat==true){u.chat_enabled=false}if(typeof _ss_track.options.enable_prechat!="undefined"&&_ss_track.options.enable_prechat==true){if(SecondScreen._read_sess_data("__ss_prechat")==null){u.prechat_enabled=true}}if(typeof _ss_track.options.disable_offline_message!="undefined"&&_ss_track.options.disable_offline_message==true){u.offline_message_disabled=true;if(typeof _ss_track.options.enable_unavail_greet!="undefined"&&_ss_track.options.enable_unavail_greet==true){u.unavail_greet_enabled=true}}if(typeof _ss_track.options.enable_chat_by_agent!="undefined"&&_ss_track.options.enable_chat_by_agent==true){u.chat_enabled_by_agent=true;if(SecondScreen._read_sess_data("__ss_chat")!=null){u.chat_enabled=true}}if(SecondScreen._read_sess_data("__ss_cobrowse")==="1"){u.show_cobrowse_stop()}if("https:"==window.location.protocol){u.ws=new WebSocket("wss://"+u.bk_svr.split(":")[0]+"/")}else{if(u.bk_svr.split(":")[1]=="443"){u.ws=new WebSocket("wss://"+u.bk_svr.split(":")[0]+"/")}else{u.ws=new WebSocket("ws://"+u.bk_svr+"/")}}u.ws.onopen=function(){U(window).on("beforeunload",function(){u.reconnect_count=u.MAX_RECONNECT_COUNT;u.hide_chat_widget();u.ws.close()});u.reconnect_count=0;if(u.already_joined){u.ws.send(String.fromCharCode(s)+u.user_data.visitor_id+f+u.user_data.comp_id+f+u.user_data.heads+f+u.user_data.cookie_id);u.chat_frame.find(".gmg_chat_content .gmg_chat_all div:not(:first-child)").remove();return}u.already_joined=true;if(u.chat_enabled){u.add_chat_widget();if(u.prechat_enabled){u.chat_frame.find(".gmg_chat_online").hide();u.chat_frame.find(".gmg_prechat_online").show()}if(u.offline_message_disabled&&!u.unavail_greet_enabled){u.hide_chat_widget()}}u.ws.send(String.fromCharCode(s)+u.user_data.visitor_id+f+u.user_data.comp_id+f+u.user_data.heads+f+u.user_data.cookie_id);for(var aw=0;aw<u.pushed_evs.length;aw++){u.push_event(u.pushed_evs[aw])}u.pushed_evs=[];for(var aw=0;aw<u._onconnect.length;aw++){(function(){var ax=aw;setTimeout(function(){u._onconnect[ax](u.new_sess)},0)})()}u.in_mirror=SecondScreen._read_sess_data("__ss_m");if(u.in_mirror){u.start_mirror()}var av=function(){var ax=new Date().getTime();if(ax-u.active>=30000){u.ws.send(String.fromCharCode(T));u.active=false;u.idle_timeout=setTimeout(function(){u.ws.send(String.fromCharCode(r))},180000)}else{setTimeout(av,30000-(ax-u.active))}};U(document).mousemove(function(){if(!u.active){u.ws.send(String.fromCharCode(X));clearTimeout(u.idle_timeout);setTimeout(av,30000)}u.active=new Date().getTime()})};u.ws.onmessage=function(a0){var az=a0.data.charCodeAt(0);if(az==k&&!u.in_mirror){if(typeof(_ss_track.ASK_SCREEN_MIRROR_PERM)!="undefined"&&_ss_track.ASK_SCREEN_MIRROR_PERM){u.ask_and_start_mirror()}else{u.start_mirror()}}else{if(az==o){var aV=a0.data.substr(1);if(aV.length!=0){var aX=u.chat_frame.find(".gmg_chat_all");var aT=u.chat_frame.find(".gmg_chat_wrap");var aW=u.chat_frame.find(".gmg_chat_content");var aM=0;var aK=aV.split(f);var aY;var aJ=false;for(var a5=0;a5<aK.length;a5++){if(aK[a5].charAt(0)=="0"){var aZ=aK[a5].lastIndexOf("|");u.add_chat_message("You",aK[a5].substring(1,aZ))}else{if(aK[a5].charAt(0)=="9"){if(aK[a5].charAt(1)=="-"){u.add_info_message("Chat has ended. <a href='javascript:void(0)' onclick='window.open(\"//"+_ss_track.GMG_SERVER+"/chemail/"+_ss_track.id+"/"+aK[a5].substr(2)+"/"+window.location.hostname+'/","","width=400,height=300,menubar=no,location=no,resizable=yes,scrollbars=yes,status=no")\'>Click here</a> to mail yourself this chat transcript.')}else{u.add_info_message("Chat has ended. <a href='javascript:void(0)' onclick='window.open(\"//"+_ss_track.GMG_SERVER+"/vsrvy/"+_ss_track.id+"/"+aK[a5].substr(1)+"/"+window.location.hostname+'/","","width=400,height=500,menubar=no,location=no,resizable=yes,scrollbars=yes,status=no")\'>Click here</a> to provide your feedback or mail yourself this chat transcript.')}}else{if(aK[a5].charAt(0)=="1"||aK[a5].charAt(0)=="2"){var a1=aK[a5].substring(1);var a9=a1.indexOf("|");var aZ=a1.lastIndexOf("|");if(aK[a5].charAt(0)=="2"){aM=aX.height()+aW.height()}var aR;if(aJ){aR=aY}else{aR=a1.substring(0,a9)}u.add_chat_message(aR,a1.substring((a9+1),aZ));u.last_chat_recv_at=a1.substring(aZ+1);u.last_chat_agent=a1.substring(0,a9)}else{if(aK[a5].charAt(0)=="4"){var aL=aK[a5].substring(1);var aA=aL.indexOf("|");aY=aL.substring(aA+1);u.add_info_message(aY+" has joined the chat")}else{if(aK[a5].charAt(0)=="7"){if(aK[a5].charAt(1)=="1"){aJ=true}else{if(aK[a5].charAt(1)=="2"){aJ=false}}}}}}}}if(u.last_chat_recv_at!=null){u.last_chat_recv_at=new Date(u.last_chat_recv_at*1000);u.update_last_chat_recv_at()}if(aM>0&&aX.children().length>1){aT.css("min-height",aM+"px")}aW.stop().scrollTop(aW[0].scrollHeight)}if(SecondScreen._read_sess_data("__ss_chat")=="1"){u.chat_show()}if(u.pending_proactive_chats.length>0){if(!u.chat_enabled){return}var aX=u.chat_frame.find(".gmg_chat_all");var aT=u.chat_frame.find(".gmg_chat_wrap");var aW=u.chat_frame.find(".gmg_chat_content");var aM=0;for(var a5=0;a5<u.pending_proactive_chats.length;a5++){aM=aX.height()+aW.height();u.add_chat_message(u.pending_proactive_chats[a5][0],u.pending_proactive_chats[a5][1]);for(var a5=0;a5<u._onprochat.length;a5++){(function(){var bb=a5;setTimeout(function(){u._onprochat[bb]()},0)})()}}if(aM>0&&aX.children().length>1){aT.css("min-height",aM+"px")}u.pending_proactive_chats=[];u.chat_show()}u.chat_hist_recvd=true}else{if(az==aa){if(SecondScreen._read_sess_data("__ss_chat")=="0"||SecondScreen._read_sess_data("__ss_chat")==null){u.chat_show()}SecondScreen._write_sess_data("chatafterprochat",1)}else{if(az==ad){if(!u.chat_enabled&&u.chat_enabled_by_agent){u.chat_enabled=true;u.add_chat_widget()}var a1=a0.data.substr(1);var a9=a1.indexOf("|");var aR,ax;aR=a1.substring(0,a9);ax=a1.substring(a9+1);u.add_chat_message(aR,ax);for(var a5=0;a5<u._onagentchat.length;a5++){(function(){var bb=a5;setTimeout(function(){u._onagentchat[bb]()},0)})()}if((SecondScreen._read_sess_data("__ss_chat")==null||SecondScreen._read_sess_data("__ss_chat")=="0")&&!!!SecondScreen._read_sess_data("__ss_dont_open_on_agent_chat")){u.chat_show()}u.last_chat_agent=aR;u.last_chat_recv_at=new Date();u.update_last_chat_recv_at();SecondScreen._write_sess_data("chatafterprochat",1);u.play_and_flick("chat");if(window.AndroidInterface){window.AndroidInterface.notifyChat(aR,ax)}}else{if(az==x){u.in_mirror=false;SecondScreen._write_sess_data("__ss_m",0);U(window).off(".__ss");U(document).off(".__ss");clearTimeout(u.mouse_scroll_intr);if(typeof u.diff_intr!="undefined"){clearTimeout(u.diff_intr)}if(typeof u.mirror_client!="undefined"){u.mirror_client.disconnect()}}else{if(az==E){u.agent_present=false;u._check_pending_tasks();if(!u.chat_enabled){return}u.stop_flick();u.chat_frame.find(".gmg_chat_textarea").attr("placeholder","No agents are currently available and hence cannot chat.");u.chat_frame.find(".gmg_chat_textarea").attr("disabled","disabled");if(u.chat_frame.find(".gmg_chat_line").length>0){return}if(u.offline_message_disabled&&!u.unavail_greet_enabled){u.hide_chat_widget();return}if(u.prechat_enabled){u.chat_frame.find(".gmg_prechat_online").hide()}else{u.chat_frame.find(".gmg_chat_online").hide()}if(!u.offline_message_disabled){u.chat_frame.find(".gmg_chat_offline").show();u.chat_frame.find(".gmg_chat_head b").html(_ss_track.options.offline_title)}else{u.chat_frame.find(".gmg_chat_unavail").show();u.chat_frame.find(".gmg_chat_head b").html(_ss_track.options.unavail_title)}if(u.chat_shown){U("iframe.gmg_chat").css("height",u.chat_frame.css("height"))}}else{if(az==ac){u.agent_present=true;u._check_pending_tasks();if(!u.chat_enabled){return}u.chat_frame.find(".gmg_chat_textarea").attr("placeholder",_ss_track.options.msg_hint);u.chat_frame.find(".gmg_chat_textarea").removeAttr("disabled");if(u.chat_frame.find(".gmg_chat_line").length>0){return}if(u.offline_message_disabled&&!u.unavail_greet_enabled){u.show_chat_widget();return}if(u.prechat_enabled){u.chat_frame.find(".gmg_prechat_online").show()}else{u.chat_frame.find(".gmg_chat_online").show()}if(!u.offline_message_disabled){u.chat_frame.find(".gmg_chat_offline").hide()}else{u.chat_frame.find(".gmg_chat_unavail").hide()}if(u.chat_shown){U("iframe.gmg_chat").css("height",u.chat_frame.css("height"))}u.chat_frame.find(".gmg_chat_head b").html(_ss_track.options.online_title)}else{if(az==G){u.chat_frame.find(".gmg_chat_info").text(u.last_chat_agent+" is typing")}else{if(az==z){u.update_last_chat_recv_at()}else{if(az==ar){var ba=a0.data.substr(1).split(",");for(var a5=0;a5<ba.length;a5++){u.online_depts[ba[a5]]=true}u.update_online_depts()}else{if(az==v){var aS=a0.data.substr(1).split(",");for(var a5=0;a5<aS.length;a5++){u.online_depts[aS[a5]]=null}u.update_online_depts()}else{if(az==ai){var aB=a0.data.substr(1);window.location.href=aB}else{if(az==aq){var a7=a0.data.substr(1).split(f);var aD=a7[0];var aR=a7[1];if(a7.length==4){var aC=a7[2];var a6=a7[3]}else{var a6=a7[2];var aC=""}u.agent_id=aD;u.agent_name=aR;u.agent_email=aC;if(_ss_track.options.img_enable){U(".gmg_chat").contents().find(".chat_agent_img_ico").css("background-image","url("+location.protocol+"//"+_ss_track.FE_SERVER+"/agent_img/"+aD+"/"+_taq.id+"/)");u.chat_frame.find(".gmg_agent_name").text(aR||"Agent");u.chat_frame.find(".gmg_agent_name").attr("title",aR||"Agent");u.chat_frame.find(".gmg_agent_img").css("background-image","url("+location.protocol+"//"+_ss_track.FE_SERVER+"/agent_img/"+aD+"/"+_taq.id+"/)");u.chat_frame.find(".gmg_agent_des").text(a6);u.chat_frame.find(".gmg_agent_des").attr("title",a6);u.chat_frame.find(".gmg_agent_info").show()}u.visitor_calloption();u.feedback_status()}else{if(az==ao){SecondScreen._write_sess_data("__ss_support",1);var a7=a0.data.substr(1).split(f);var aD=a7[0];var aR=a7[1];if(a7.length==4){var aC=a7[2];var a6=a7[3]}else{var a6=a7[2];var aC=""}u.agent_id=aD;u.agent_name=aR;u.agent_email=aC;if(_ss_track.options.img_enable){u.last_chat_agent=aR;U(".gmg_chat").contents().find(".chat_agent_img_ico").css("background-image","url("+location.protocol+"//"+_ss_track.FE_SERVER+"/agent_img/"+aD+"/"+_taq.id+"/)");u.chat_frame.find(".gmg_agent_name").text(aR||"Agent");u.chat_frame.find(".gmg_agent_name").attr("title",aR||"Agent");u.chat_frame.find(".gmg_agent_img").css("background-image","url("+location.protocol+"//"+_ss_track.FE_SERVER+"/agent_img/"+aD+"/"+_taq.id+"/)");u.chat_frame.find(".gmg_agent_des").text(a6);u.chat_frame.find(".gmg_agent_des").attr("title",a6);u.chat_frame.find(".gmg_agent_info").show()}u.add_info_message(aR+" has joined the chat");u.visitor_calloption();u.feedback_status();for(var a5=0;a5<u._onchatstart.length;a5++){(function(){var bb=a5;setTimeout(function(){u._onchatstart[bb](d,u.agent_name,u.agent_email,u.pc_name,u.pc_email,u.pc_data)},0)})()}}else{if(az==g){SecondScreen._write_sess_data("__ss_support",0);for(var a5=0;a5<u._onchatend.length;a5++){(function(){var bb=a5;setTimeout(function(){u._onchatend[bb](d,u.agent_name,u.agent_email,u.pc_name,u.pc_email)},0)})()}if(u.chat_shown){U("iframe.gmg_chat").css("height",u.chat_frame.css("height"))}}else{if(az==Z){if(a0.data.charAt(1)=="-"){u.latest_chat_id=a0.data.substr(2);u.add_info_message("Chat has ended. <a href='javascript:void(0)' onclick='window.open(\"//"+_ss_track.GMG_SERVER+"/chemail/"+_ss_track.id+"/"+a0.data.substr(2)+"/"+window.location.hostname+'/","","width=400,height=300,menubar=no,location=no,resizable=yes,scrollbars=yes,status=no")\'>Click here</a> to mail yourself this chat transcript.')}else{u.latest_chat_id=a0.data.substr(1);u.add_info_message("Chat has ended. <a href='javascript:void(0)' onclick='window.open(\"//"+_ss_track.GMG_SERVER+"/vsrvy/"+_ss_track.id+"/"+a0.data.substr(1)+"/"+window.location.hostname+'/","","width=400,height=500,menubar=no,location=no,resizable=yes,scrollbars=yes,status=no")\'>Click here</a> to provide your feedback or mail yourself this chat transcript.')}}else{if(az==ab){u.add_info_message(_ss_track.options.busy_msg)}else{if(az==Y){var aw=a0.data.substr(1);console.log("Recieved accept call with key, "+aw);function av(){if(u.webrtc_key==null){window.setTimeout(av,200)}else{var bb=u.peer.call(aw,window.localStream,{metadata:{calltype:u.calltype}});u.handle_call(bb)}}av()}else{if(az==I){if(!util.supports.audioVideo){var aI=97;u.ws.send(String.fromCharCode(aI));return}if(window.localStream){if(window.localStream.getAudioTracks()[0]){window.localStream.getAudioTracks()[0].stop()}if(window.localStream.getVideoTracks()[0]){window.localStream.getVideoTracks()[0].stop()}}if(u.peer!=null){u.peer.destroy();u.peer=null}u.calltype=null;u.webrtc_key=null;u.initializePeer();function a3(){if(u.webrtc_key==null){window.setTimeout(a3,200)}else{console.log("webrtc_key for visitor-"+f+u.webrtc_key);u.ws.send(String.fromCharCode(N)+u.webrtc_key)}}a3()}else{if(az==L){console.log("received call reject from agent");u.visitor_calloption();if(window.localStream.getAudioTracks()[0]){window.localStream.getAudioTracks()[0].stop()}if(window.localStream.getVideoTracks()[0]){window.localStream.getVideoTracks()[0].stop()}if(window.existingCall){window.existingCall.close()}}else{if(az==S){u.add_info_message(a0.data.substr(1))}else{if(az==Q){u.ask_cobrowse_perm()}else{if(az==c){u.agent_cobrowse_stop()}else{if(az==O){var aH=a0.data.substr(1).split(f);var aQ=parseInt(aH[0]);var aN=parseInt(aH[1]);console.log(aQ,aN);var aG=aQ-U(window).scrollLeft();var aF=aN-U(window).scrollTop();var aE=new MouseEvent("click",{view:window,bubbles:true,cancelable:true,clientX:aG,clientY:aF});var a4=document.elementFromPoint(aG,aF);a4.dispatchEvent(aE);u.curr_agent_focus=a4;var aP=U(a4).prop("nodeName");var a9=U(aP).index(a4);u.ws.send(String.fromCharCode(V)+JSON.stringify([a9,aP]))}else{if(az==at){var a2=parseInt(a0.data.substr(1));console.log(a2);if(u.curr_agent_focus){console.log("here",u.curr_agent_focus);var aU=U(u.curr_agent_focus).val();if(a2==8){U(u.curr_agent_focus).val(aU.slice(0,-1))}else{U(u.curr_agent_focus).val(aU+String.fromCharCode(a2))}U(u.curr_agent_focus).trigger("input")}}else{if(az==b){var ay=parseInt(a0.data.substr(1));console.log(ay);U(window).scrollTop(U(window).scrollTop()+ay)}else{if(az==a){var a8=a0.data.substr(1).split(f);var a9=parseInt(a8[0]);var aO=a8[1];U("select").eq(a9).val(aO);U("select").eq(a9).trigger("change")}}}}}}}}}}}}}}}}}}}}}}}}}}}};u.ws.onclose=function(){if(u.reconnect_count<u.MAX_RECONNECT_COUNT){u.reconnect()}else{u.agent_present=false;if(!u.chat_enabled){return}u.stop_flick();if(u.offline_message_disabled&&!u.unavail_greet_enabled){u.hide_chat_widget();return}if(u.prechat_enabled){u.chat_frame.find(".gmg_prechat_online").hide()}else{u.chat_frame.find(".gmg_chat_online").hide()}if(!u.offline_message_disabled){u.chat_frame.find(".gmg_chat_offline").show();u.chat_frame.find(".gmg_chat_head b").html(_ss_track.options.offline_title)}else{u.chat_frame.find(".gmg_chat_unavail").show();u.chat_frame.find(".gmg_chat_head b").html(_ss_track.options.unavail_title)}if(u.chat_shown){U("iframe.gmg_chat").css("height",u.chat_frame.css("height"))}}}}SecondScreen.prototype.ask_cobrowse_perm=function(){var d=this;var h=SecondScreenUtils.$;var g=64;var c=65;var b=SecondScreen._read_sess_data("__ss_cobrowse");if(b=="-1"){d.ws.send(String.fromCharCode(c))}else{if(b=="1"){d.ws.send(String.fromCharCode(g));d.show_cobrowse_stop()}else{var h=SecondScreenUtils.$;var j=h(window).width();var f=422;if(j>=320&&j<=380){f=280}else{if(j>=381&&j<=480){f=320}}var a='<div id="__gamooga_cobrowse_ask" style="background-color:#F0EFF0; box-shadow:0 0 4px #888; font-size:11px; font-weight:400; left:calc(50% - '+(f/2)+"px); margin:0; padding:0; position:fixed; top:0; width:"+f+'px; z-index:2147483647" bgcolor="#F0EFF0" width="'+f+'"><div style="margin:0; padding:0 20px 10px 20px"><div style="display:inline-block; float:left; margin:15px 15px 0 0; padding:0; position:relative"><img src="//'+_ss_track.FE_SERVER+'/static/images/support.png" style="max-height:65px; max-width:65px"></div><div style="color:#000; display:inline-block; line-height:1.4em; margin:0; padding:10px 0 0 0; position:relative; text-align:left; width:calc(100% - 80px)" align="left" width="calc(100% - 80px)"><span style="color:#000; font-family:\'Open Sans\', sans-serif; font-size:14px; font-weight:700; line-height:1.4em; margin-bottom:5px; text-align:left" align="left">Do you want the agent to control this page?</span><p style="font-family:\'Open Sans\', sans-serif; font-size:12px; line-height:1.4em; margin:10px 0; padding:0; text-align:left" align="left">You can turn off this permission any time.</p></div><div style="clear: both;"><div style="float:right; margin:0; padding:0"><button style="background:linear-gradient(to bottom, #64b4f4, #0084f6); border:1px solid #42a2f2; border-radius:4px; box-shadow:none; box-sizing:border-box; color:#fff; cursor:pointer; display:inline-block; font-family:Arial; font-size:14px; font-weight:normal; height:26px; line-height:1.1em; margin:0; margin-right:20px; padding:5px; text-shadow:none; text-transform:none; width:90px" height="26" width="90" id="__gamooga_cobrowse_allow">Allow</button><button style="background:#FFF; border:1px solid #42a2f2; border-color:#CCC; border-radius:4px; box-shadow:none; box-sizing:border-box; color:#000; cursor:pointer; display:inline-block; font-family:Arial; font-size:14px; font-weight:normal; height:26px; line-height:1.1em; margin:0; padding:5px; text-shadow:none; text-transform:none; width:100px" height="26" width="100" id="__gamooga_cobrowse_deny">Deny</button></div><div style="clear:both"></div></div></div></div>';h("body").append(a);h("#__gamooga_cobrowse_deny").click(function(){h("#__gamooga_cobrowse_ask").remove();d.ws.send(String.fromCharCode(c));SecondScreen._write_sess_data("__ss_cobrowse","-1")});h("#__gamooga_cobrowse_allow").click(function(){h("#__gamooga_cobrowse_ask").remove();d.ws.send(String.fromCharCode(g));SecondScreen._write_sess_data("__ss_cobrowse","1");d.show_cobrowse_stop()})}}};SecondScreen.prototype.show_cobrowse_stop=function(){var a=this;var c=SecondScreenUtils.$;var b=66;if(c("#__gamooga_cobrowse_status").length==0){c("body").append('<div id="__gamooga_cobrowse_status" style="background-color:#F0EFF0; box-shadow:0 0 4px #888; font-size:13px; font-weight:bold; left:0; margin:1px; padding:5px 7px; position:fixed; top:0; opacity:0.7; z-index:2147483647" bgcolor="#F0EFF0"><a href="javascript:void(0)" id="__gamooga_cobrowse_stop" style="color:#ff0000">Stop agent control</a></div>');c("#__gamooga_cobrowse_stop").click(function(){a.ws.send(String.fromCharCode(b))})}};SecondScreen.prototype.agent_cobrowse_stop=function(){SecondScreen._del_sess_data("__ss_cobrowse");$("#__gamooga_cobrowse_status").remove()};SecondScreen.prototype.feedback_status=function(){var b=this;var c=SecondScreenUtils.$;var d=98;if(_ss_track.id!="206f307a-c1bf-41ec-8ac6-8d0b3a07ace5"&&_ss_track.id!="1b2bb765-95ef-4ba1-9333-428e00656f45"){b.chat_frame.find(".visitor-feedback").remove();var a='<div class="visitor-feedback" style="width:100%;height:30px;background-color:#e6e6e6;"><div class="call-inner" style="margin:0px;display:block;"><span class="connect" style="color:#fff;font-size:14px;margin:12px 0 0 10px;float:left;"></span><div style="float:right;"><p style="display:block;font-weight:500;margin:9px 7px 6px 2px;float:left;text-transform:uppercase;font-family:sans-serif;">Feedback:</p><div class="thumb-down" style="float:right;display:inline-block;cursor:pointer;"><img class="thumb-down-src" src="'+location.protocol+"//"+_ss_track.FE_SERVER+'/static/images/feedback/thumb-down.png" style="margin:6px 10px 0px 0px;width:18px;height:18px;vertical-align: middle;"/></div><div class="thumb-up" style="float:right;display:inline-block;cursor:pointer;"><img class="thumb-up-src" src="'+location.protocol+"//"+_ss_track.FE_SERVER+'/static/images/feedback/thumb-up.png" style="margin:4px 5px 0px 0px;width:18px;height:18px;vertical-align: middle;"/></div></div></div></div>';b.chat_frame.find(".gmg_chat_content").before("<div>"+a+"</div>");b.chat_frame.find(".thumb-up").click(function(){if(b.visitor_feedback!=1){b.visitor_feedback=1;c(".thumb-up-src",this).attr("src",location.protocol+"//"+_ss_track.FE_SERVER+"/static/images/feedback/thumb-up-active.png");c(".thumb-down-src",this).attr("src",location.protocol+"//"+_ss_track.FE_SERVER+"/static/images/feedback/thumb-down.png")}else{b.visitor_feedback=0;c(".thumb-up-src",this).attr("src",location.protocol+"//"+_ss_track.FE_SERVER+"/static/images/feedback/thumb-up.png")}c(this).siblings("div.thumb-down").children(".thumb-down-src").attr("src",location.protocol+"//"+_ss_track.FE_SERVER+"/static/images/feedback/thumb-down.png");if(b.latest_chat_id!==null){var f=location.protocol+"//"+_ss_track.FE_SERVER+"/manage/chat_feedback/?chid="+b.latest_chat_id+"&feedback="+b.visitor_feedback;c.ajax({type:"GET",url:f,dataType:"jsonp",success:function(g){}})}else{b.ws.send(String.fromCharCode(d)+b.visitor_feedback)}});b.chat_frame.find(".thumb-down").click(function(){if(b.visitor_feedback!=-1){b.visitor_feedback=-1;c(".thumb-down-src",this).attr("src",location.protocol+"//"+_ss_track.FE_SERVER+"/static/images/feedback/thumb-down-active.png");c(".thumb-up-src",this).attr("src",location.protocol+"//"+_ss_track.FE_SERVER+"/static/images/feedback/thumb-up.png")}else{b.visitor_feedback=0;c(".thumb-down-src",this).attr("src",location.protocol+"//"+_ss_track.FE_SERVER+"/static/images/feedback/thumb-down.png")}c(this).siblings("div.thumb-up").children(".thumb-up-src").attr("src",location.protocol+"//"+_ss_track.FE_SERVER+"/static/images/feedback/thumb-up.png");if(b.latest_chat_id!==null){var f=location.protocol+"//"+_ss_track.FE_SERVER+"/manage/chat_feedback/?chid="+b.latest_chat_id+"&feedback="+b.visitor_feedback;c.ajax({type:"GET",url:f,dataType:"jsonp",success:function(g){}})}else{b.ws.send(String.fromCharCode(d)+b.visitor_feedback)}});if(b.chat_shown){c("iframe.gmg_chat").css("height",b.chat_frame.css("height"))}}};SecondScreen.prototype.reconnect=function(){var a=this;var b=SecondScreenUtils.$;if(a.chat_frame){a.chat_frame.find(".gmg_chat_head b").html("Reconnecting, please wait...")}setTimeout(function(){var f=a.ws.onopen;var g=a.ws.onmessage;var c=a.ws.onclose;a.reconnect_count+=1;try{if("https:"==window.location.protocol){a.ws=new WebSocket("wss://"+a.bk_svr.split(":")[0]+"/")}else{if(a.bk_svr.split(":")[1]=="443"){a.ws=new WebSocket("wss://"+a.bk_svr.split(":")[0]+"/")}else{a.ws=new WebSocket("ws://"+a.bk_svr+"/")}}}catch(d){console.log("caught",d)}a.ws.onopen=f;a.ws.onmessage=g;a.ws.onclose=c},250)};SecondScreen.prototype.set_name=function(a){var c=SecondScreenUtils.$;var b=this;b.chat_frame.find("div.gmg_prechat_name input.gmg_input").val(a);b.chat_frame.find("div.gmg_chat_name input.gmg_input").val(a);_ss_track.options.visitor_name=a;_ss_track.options.visitor_email=_ss_track.options.visitor_email||"";SecondScreen._write_local_data("vne",SecondScreenUtils.base64encode(JSON.stringify({name:a,email:_ss_track.options.visitor_email})))};SecondScreen.prototype.set_email=function(b){var c=SecondScreenUtils.$;var a=this;a.chat_frame.find("div.gmg_prechat_email input.gmg_input").val(b);a.chat_frame.find("div.gmg_chat_email input.gmg_input").val(b);_ss_track.options.visitor_email=b;_ss_track.options.visitor_name=_ss_track.options.visitor_name||"";SecondScreen._write_local_data("vne",SecondScreenUtils.base64encode(JSON.stringify({name:_ss_track.options.visitor_name,email:b})))};SecondScreen.prototype.set_prechat_answer=function(a,c){var d=SecondScreenUtils.$;var b=this;b.chat_frame.find('[data-pcs-name="'+a+'"]').val(c)};SecondScreen.prototype.update_online_depts=function(){var c=SecondScreenUtils.$;var b=this;if(!b.chat_enabled){return}var a=b.chat_frame.find(".gmg_route");c(a).each(function(){var f=c(this);var g=f.text();if(b.online_depts[f.attr("data-route")]){f.removeAttr("disabled");var d=g.indexOf(" (not available)");if(d!=-1){f.text(g.substr(0,d))}}else{f.attr("disabled","disabled");var d=g.indexOf(" (not available)");if(d==-1){f.text(g+" (not available)")}}});c(a).parent().each(function(){if(c(this).find("option:checked").is(":disabled")&&c(this).find("option:checked").val()!=""){c(this).val(c(this).find("option:enabled").text());c(this).trigger("change")}})};SecondScreen.prototype.play_notification=function(a){(function(){var b=0;var d=a;var c=window.setInterval(function(){try{$("div.gmg_chat_outer audio")[0].play()}catch(f){}if(++b===d){window.clearInterval(c)}},500)})()};SecondScreen.prototype.play_and_flick=function(a){var d=SecondScreenUtils.$;var b=this;if(a==="call"){b.play_notification(5)}else{b.play_notification(1)}if(!b.chat_frame.find("textarea.gmg_chat_textarea").is(":focus")){if(!b.flick_title_interval){b.orig_title=document.title;var c=true;b.flick_title_interval=setInterval(function(){if(c){if(a==="call"){document.title="Incoming call from "+b.last_chat_agent+"..."}else{document.title=b.last_chat_agent+" says..."}}else{document.title=b.orig_title}c=!c},1000)}}};SecondScreen.prototype.stop_flick=function(){var b=SecondScreenUtils.$;var a=this;if(a.flick_title_interval){clearInterval(a.flick_title_interval);a.flick_title_interval=null;document.title=a.orig_title}};SecondScreen.prototype.update_last_chat_recv_at=function(){var b=SecondScreenUtils.$;var a=this;if(a.last_chat_recv_at){a.chat_frame.find(".gmg_chat_info").html("Last message received at "+a.last_chat_recv_at.toLocaleTimeString())}else{a.chat_frame.find(".gmg_chat_info").html("&nbsp;")}};SecondScreen.prototype.push_event=function(b){var d=SecondScreenUtils.$;if(this.ws.readyState!=WebSocket.OPEN){this.pushed_evs.push(b);return}if(b[2]===undefined){b[2]=2}var c=3;var a="\u0002";if(_taq.id=="138080ef-4919-40af-a72e-6b75ea868631"&&b[0]=="started session"){b[1]["browser"]="---";b[1]["OS"]="---";b[1]["IP"]="---"}this.ws.send(String.fromCharCode(c)+b[0]+a+JSON.stringify(b[1])+a+b[2]);this.push_to_ga(b[0])};SecondScreen.prototype.push_to_ga=function(c){var b=this;var d=SecondScreenUtils.$;if(typeof b.sess_conf.gaid!="undefined"){var a=new Image(1,1);a.src=("https:"==window.location.protocol?"https://ssl":"http://www")+".google-analytics.com/collect?v=1&tid="+encodeURIComponent(b.sess_conf.gaid)+"&cid="+encodeURIComponent(b.user_data.cookie_id)+"&t=event&ec=ssevent&ea="+encodeURIComponent(c)+"&el="+encodeURIComponent(b.user_data.cookie_id)+"&z="+(new Date().getTime())+""+parseInt(Math.random()*10000)}};SecondScreen.prototype.push=SecondScreen.prototype.push_event;SecondScreen.prototype.push_handler=function(b){var a=this;if(b[0]=="connect"){if(a.ws.readyState==WebSocket.OPEN){setTimeout(function(){b[1](a.new_sess)},0)}else{a._onconnect.push(b[1])}}else{if(b[0]=="chatstart"){a._onchatstart.push(b[1])}else{if(b[0]=="chatend"){a._onchatend.push(b[1])}else{if(b[0]=="prochat"){a._onprochat.push(b[1])}else{if(b[0]=="agentchat"){a._onagentchat.push(b[1])}}}}}};SecondScreen.prototype._check_pending_tasks=function(){var b=this;for(var a=0;a<b.pending_tasks.length;a++){b.act_task(b.pending_tasks[a])}b.pending_tasks=[]};SecondScreen.prototype.act_task=function(a){var b=this;if(b.agent_present===null){b.pending_tasks.push(a);return}if(a[0]=="prochat_msg"){b.act_prochat_msg(a[1],a[2],a[3],a[4])}else{if(a[0]=="agent_alert"){b.act_agent_alert(a[1],a[2],a[3],a[4])}else{if(a[0]=="show_visitor"){b.act_show_visitor(a[1])}else{if(a[0]=="assign_dept"){b.act_assign_dept(a[1])}}}}};SecondScreen.prototype.agent_alarm=function(h,j,c,f){var d=this;var g=SecondScreenUtils.$;var b=12;var a="\u0002";if(f){d.ws.send(String.fromCharCode(b)+h+a+j+a+c+a+f)}else{d.ws.send(String.fromCharCode(b)+h+a+j+a+c)}};SecondScreen.prototype.act_prochat_msg=function(m,k,o,n){var p=this;var h=SecondScreenUtils.$;var c=32;var b=80;if(p.agent_present){if(!p.chat_enabled&&p.chat_enabled_by_agent){p.chat_enabled=true;p.add_chat_widget()}if(!p.chat_enabled){return}var j=SecondScreen._read_sess_data("__ss_support");if(typeof j=="undefined"||j=="0"){if(o!="0"){if(!p.online_depts[o]&&!(_ss_track.options.chat_spill_to[o]&&p.online_depts[_ss_track.options.chat_spill_to[o]])){return}else{p.ws.send(String.fromCharCode(c)+o)}}p.ws.send(String.fromCharCode(b)+n+"|"+m+"|"+k);if(p.chat_hist_recvd){var d=p.chat_frame.find(".gmg_chat_all");var f=p.chat_frame.find(".gmg_chat_wrap");var a=p.chat_frame.find(".gmg_chat_content");if(d.children().length>1){f.css("min-height",(d.height()+a.height())+"px")}p.add_chat_message(m,k);p.chat_show();p.last_chat_agent=m;p.last_chat_recv_at=new Date();p.update_last_chat_recv_at();p.play_and_flick("chat");SecondScreen._write_sess_data("chatafterprochat",0);for(var g=0;g<p._onprochat.length;g++){(function(){var q=g;setTimeout(function(){p._onprochat[q]()},0)})()}}else{p.pending_proactive_chats.push([m,k]);SecondScreen._write_sess_data("chatafterprochat",0)}p.taq_convs.pro_chat_atic(n);SecondScreen._write_sess_data("analytic_latest_trigger",n)}}};SecondScreen.prototype.act_agent_alert=function(f,g,d,a){var b=this;var c=SecondScreenUtils.$;if(b.agent_present){if(d!="0"){if(!b.online_depts[d]){return}b.agent_alarm(f,g,a,d);b.taq_convs.agent_alert_atic(a);SecondScreen._write_sess_data("analytic_latest_trigger",a)}else{b.agent_alarm(f,g,a);b.taq_convs.agent_alert_atic(a);SecondScreen._write_sess_data("analytic_latest_trigger",a)}}};SecondScreen.prototype.act_show_visitor=function(d){var b=this;var c=SecondScreenUtils.$;var a=34;if(!_ss_track.options.vis_dflt_show){b.ws.send(String.fromCharCode(a)+d)}};SecondScreen.prototype.act_assign_dept=function(d){var b=this;var c=SecondScreenUtils.$;var a=32;SecondScreen._write_sess_data("assign_dept",d);if(!b.online_depts[d]){return}else{b.ws.send(String.fromCharCode(a)+d)}};SecondScreen.prototype.ask_and_start_mirror=function(){var a=116;var b=this;var f=SecondScreenUtils.$;var g=f(window).width();var d=422;if(g>=320&&g<=380){d=280}else{if(g>=381&&g<=480){d=320}}var c='<div id="__gamooga_mirror_ask" style="background-color:#F0EFF0; box-shadow:0 0 4px #888; font-size:11px; font-weight:400; left:calc(50% - '+(d/2)+"px); margin:0; padding:0; position:fixed; top:0; width:"+d+'px; z-index:2147483647" bgcolor="#F0EFF0" width="'+d+'"><div style="margin:0; padding:0 20px 10px 20px"><div style="display:inline-block; float:left; margin:15px 15px 0 0; padding:0; position:relative"><img src="//'+_ss_track.FE_SERVER+'/static/images/support.png" style="max-height:65px; max-width:65px"></div><div style="color:#000; display:inline-block; line-height:1.4em; margin:0; padding:10px 0 0 0; position:relative; text-align:left; width:calc(100% - 80px)" align="left" width="calc(100% - 80px)"><span style="color:#000; font-family:\'Open Sans\', sans-serif; font-size:14px; font-weight:700; line-height:1.4em; margin-bottom:5px; text-align:left" align="left">Chat agent would like view your current browser tab for offering better support. Would you like to allow?</span><!--<p style="font-family:\'Open Sans\', sans-serif; font-size:12px; line-height:1.4em; margin:10px 0; padding:0; text-align:left" align="left">You can turn off notifications anytime from browser settings.</p>--></div><div style="clear: both;"><div style="float:right; margin:0; padding:0"><button style="background:linear-gradient(to bottom, #64b4f4, #0084f6); border:1px solid #42a2f2; border-radius:4px; box-shadow:none; box-sizing:border-box; color:#fff; cursor:pointer; display:inline-block; font-family:Arial; font-size:14px; font-weight:normal; height:26px; line-height:1.1em; margin:0; margin-right:20px; padding:5px; text-shadow:none; text-transform:none; width:90px" height="26" width="90" id="__gamooga_mirror_allow">Allow</button><button style="background:#FFF; border:1px solid #42a2f2; border-color:#CCC; border-radius:4px; box-shadow:none; box-sizing:border-box; color:#000; cursor:pointer; display:inline-block; font-family:Arial; font-size:14px; font-weight:normal; height:26px; line-height:1.1em; margin:0; padding:5px; text-shadow:none; text-transform:none; width:100px" height="26" width="100" id="__gamooga_mirror_deny">Deny</button></div><div style="clear:both"></div></div></div></div>';f("body").append(c);f("#__gamooga_mirror_deny").click(function(){f("#__gamooga_mirror_ask").remove();b.ws.send(String.fromCharCode(a))});f("#__gamooga_mirror_allow").click(function(){f("#__gamooga_mirror_ask").remove();b.start_mirror()})};SecondScreen.prototype.start_mirror=function(){var f=SecondScreenUtils.$;var k=101;var x=102;var s=103;var r=104;var w=105;var n=106;var m=107;var g=108;var j=109;var b=111;var p=116;var q=117;var o=118;var u=this;SecondScreen._write_sess_data("__ss_m",1);u.in_mirror=true;if(typeof WebKitMutationObserver=="function"||typeof WebKitMutationObserver=="object"||typeof MozMutationObserver=="function"||typeof MutationObserver=="function"){if(f("base").length>0){u.ws.send(String.fromCharCode(k)+f("base").attr("href"))}else{u.ws.send(String.fromCharCode(k)+location.href.match(/^(.*\/)[^\/]*$/)[1])}var d=false;var h=[];u.mirror_client=new TreeMirrorClient(document,{initialize:function(B,C){var D=JSON.stringify([B,C]);SecondScreenUtils.lzw_encode(SecondScreenUtils.unicode_encode(D),function(E){u.ws.send(String.fromCharCode(x)+E);d=true;for(var F=0;F<h.length;F++){u.ws.send(String.fromCharCode(s)+h[F])}h=[]},function(F,E){u.ws.send(String.fromCharCode(o)+F+","+E)})},applyChanged:function(D,C,B,E){if(d){u.ws.send(String.fromCharCode(s)+JSON.stringify([D,C,B,E]))}else{h.push(JSON.stringify([D,C,B,E]))}}})}else{var c=document.documentElement.innerHTML;c=c.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"");if(c.indexOf("<base")==-1){c=c.replace(/<head([^>]*)>/i,'<head$1><base href="'+location.href.match(/^(.*\/)[^\/]*$/)[1]+'">')}SecondScreenUtils.lzw_encode(SecondScreenUtils.unicode_encode(c),function(B){u.ws.send(String.fromCharCode(x)+String.fromCharCode(3)+B);u.old_html=c;u.diff_intr=setInterval(function(){var E=document.documentElement.innerHTML;E=E.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"");if(E.indexOf("<base")==-1){E=E.replace(/<head([^>]*)>/i,'<head$1><base href="'+location.href.match(/^(.*\/)[^\/]*$/)[1]+'">')}if(E!=u.old_html){var D=new SecondScreenUtils.diff_match_patch();var F=D.diff_main(u.old_html,E);D.diff_cleanupEfficiency(F);var C=D.patch_toText(D.patch_make(u.old_html,F));u.ws.send(String.fromCharCode(s)+String.fromCharCode(3)+C);u.ws.send(String.fromCharCode(w)+JSON.stringify({x:f(window).scrollLeft(),y:f(window).scrollTop()}));u.old_html=E}},5000)},function(C,B){u.ws.send(String.fromCharCode(o)+C+","+B)})}f(window).on("resize.__ss",function(){u.ws.send(String.fromCharCode(r)+JSON.stringify({h:f(window).height(),w:f(window).width()}))});f(window).resize();var a,A,z=false,v,t,y=false;u.mouse_scroll_intr=setInterval(function(){if(z){u.ws.send(String.fromCharCode(w)+JSON.stringify({x:a,y:A}));z=false}if(y){u.ws.send(String.fromCharCode(n)+JSON.stringify({x:v,y:t}));y=false}},100);f(window).on("scroll.__ss",function(){a=f(window).scrollLeft();A=f(window).scrollTop();z=true});f(window).scroll();f(document).on("mousemove.__ss",function(B){v=B.pageX;t=B.pageY;y=true});f(window).on("click.__ss",function(B){u.ws.send(String.fromCharCode(q)+JSON.stringify({x:B.pageX,y:B.pageY}))});f(document).on("input.__ss propertychange.__ss",'input[type="text"]',function(){var B=f("input").index(this);if(f(this).is(_ss_track.options.mask_fields)){var C=new Array(this.value.length+1).join("x")+" (masked)";u.ws.send(String.fromCharCode(m)+JSON.stringify([B,C]))}else{u.ws.send(String.fromCharCode(m)+JSON.stringify([B,this.value]))}});f(document).on("change.__ss",'input[type="radio"], input[type="checkbox"]',function(){var B=f("input").index(this);u.ws.send(String.fromCharCode(m)+JSON.stringify([B,this.checked]))});f(document).on("input.__ss propertychange.__ss","textarea",function(){var B=f("textarea").index(this);if(f(this).is(_ss_track.options.mask_fields)){var C=new Array(this.value.length+1).join("x")+" (masked)";u.ws.send(String.fromCharCode(g)+JSON.stringify([B,C]))}else{u.ws.send(String.fromCharCode(g)+JSON.stringify([B,this.value]))}});f(document).on("change.__ss","select",function(){var B=f("select").index(this);u.ws.send(String.fromCharCode(j)+JSON.stringify([B,this.selectedIndex]))})};SecondScreen.prototype.add_chat_widget=function(){var a="\u0002";var u=81;var T=82;var p=83;var U=84;var f=33;var v=32;var A=77;var E=SecondScreenUtils.$;var m=this;var S={normal:{widget_w:"280px",chat_head_fs:"12px",greet_fs:"11px",power_fs:"9px",text_fs:"12px",input_fs:"13px",input_w:"270px",textarea_w:"270px",input_pad_w:"253px",chat_cont_h:"253px",off_msg_h:"107px",pic_h_w:"40px"},large:{widget_w:"280px",chat_head_fs:"12px",greet_fs:"12px",power_fs:"10px",text_fs:"14px",input_fs:"14px",input_w:"440px",textarea_w:"440px",input_pad_w:"423px",chat_cont_h:"360px",off_msg_h:"287px",pic_h_w:"40px"},mobile:{widget_w:"98%",chat_head_fs:"1em",greet_fs:"0.9em",power_fs:"0.7em",text_fs:"1em",input_fs:"1em",input_w:"99%",textarea_w:"100%",input_pad_w:"94%",chat_cont_h:"180px",off_msg_h:"107px",pic_h_w:"2.5em"}};var D;if(m.mobile){E("iframe.gmg_chat").contents().find("html,body").css("width","100%");D=S.mobile;m.chat_cont_h=D.chat_cont_h;var N=(0.7*(E(window).height()-150))+"px";if(parseInt(N)<parseInt(D.chat_cont_h)){m.chat_cont_h=N}}else{D=_ss_track.options.chat_size==0?S.normal:S.large;m.chat_cont_h=D.chat_cont_h}E(window).on("resize.__cw",function(){var j=(0.7*(E(window).height()-150))+"px";if(parseInt(j)<parseInt(D.chat_cont_h)){M.find(".gmg_chat_content").css("height",j);if(m.chat_shown){E("iframe.gmg_chat").css("height",m.chat_frame.css("height"))}m.chat_cont_h=j}else{j=D.chat_cont_h;M.find(".gmg_chat_content").css("height",j);if(m.chat_shown){E("iframe.gmg_chat").css("height",m.chat_frame.css("height"))}m.chat_cont_h=j}});var C="";var y=m.sess_conf.settings.pcs;var H=false;for(var Q=0;Q<y.length;Q++){C+="<div class='gmg_prechat_srvy gmg_inp_div'"+(y[Q][5]?" id='pcs_wrap_"+y[Q][0]+"' style='display:none'":"")+">";var V="";if(y[Q][3]){V=" grq";C+="<span class='error'></span>"}var w=null;if(y[Q][2]==0){if(y[Q][6]!=""){w=JSON.parse(y[Q][6])}C+="<select data-pcs-name='"+y[Q][7]+"' data-set='"+y[Q][6]+"' id='"+y[Q][0]+"' class='gmg_select"+V+"'>";C+="<option value='' disabled='disabled' selected='selected'>"+y[Q][1]+"</option>";var s=y[Q][4].split("\r\n");for(var P=0;P<s.length;P++){var B="";if(w&&w.route&&w.route[s[P]]){B="class='gmg_route' data-route='"+w.route[s[P]]+"' disabled='disabled' ";H=true}var r="";if(w&&w.show&&w.show[s[P]]){r="data-show='"+w.show[s[P]]+"' "}C+="<option "+B+r+"value='"+s[P]+"'>"+s[P]+(B?" (not available)":"")+"</option>"}C+="</select></div>"}else{C+="<input data-pcs-name='"+y[Q][7]+"' id='"+y[Q][0]+"' type='text' class='gmg_input"+V+"' placeholder='"+y[Q][1]+"'></div>"}}var t="";var n=m.sess_conf.settings.ofs;var x=false;for(var Q=0;Q<n.length;Q++){t+="<div class='gmg_offline_srvy gmg_inp_div'"+(n[Q][5]?" id='offs_wrap_"+n[Q][0]+"' style='display:none'":"")+">";var V="";if(n[Q][3]){V=" grq";t+="<span class='error'></span>"}var w=null;if(n[Q][2]==0){if(n[Q][6]!=""){w=JSON.parse(n[Q][6])}t+="<select data-offs-name='"+n[Q][7]+"' data-set='"+n[Q][6]+"' id='"+n[Q][0]+"' class='gmg_select"+V+"'>";t+="<option value='' disabled='disabled' selected='selected'>"+n[Q][1]+"</option>";var s=n[Q][4].split("\r\n");for(var P=0;P<s.length;P++){var B="";if(w&&w.route&&w.route[s[P]]){B="class='' data-route='"+w.route[s[P]]+"'";x=true}var r="";if(w&&w.show&&w.show[s[P]]){r="data-show='"+w.show[s[P]]+"' "}t+="<option "+B+r+"value='"+s[P]+"'>"+s[P]+"</option>"}t+="</select></div>"}else{t+="<input data-offs-name='"+n[Q][7]+"' id='"+n[Q][0]+"' type='text' class='gmg_input"+V+"' placeholder='"+n[Q][1]+"'></div>"}}var O="";if(m.sess_conf.settings.depts.length>0){O="<div class='gmg_prechat_dept gmg_inp_div'><select class='gmg_select'><option value='' disabled='disabled' selected='selected'>Chat with</option>";var b=m.sess_conf.settings.depts;for(var Q=0;Q<b.length;Q++){O+='<option disabled="disabled" class="gmg_route" data-route="'+b[Q][0]+'" value="'+b[Q][0]+'">'+b[Q][1]+"</option>"}O+="</select></div>"}var k="";if(m.sess_conf.settings.depts.length>0){k="<div class='gmg_offline_dept gmg_inp_div'><select class='gmg_select'><option value='' disabled='disabled' selected='selected'>Chat with</option>";var b=m.sess_conf.settings.depts;for(var Q=0;Q<b.length;Q++){k+='<option data-route="'+b[Q][0]+'" value="'+b[Q][0]+'">'+b[Q][1]+"</option>"}k+="</select></div>"}var d="";if(!_ss_track.options.chat_no_min&&_ss_track.options.chat_close){d="<div class='gmg_chat_close' style='float:right;padding-right:5px;color:"+_ss_track.options.title_text_color+"'>&#x2715;</div>"}var I="";var L="";if(_ss_track.options.chat_css_url!=""){I="<link rel='stylesheet' type='text/css' href='"+_ss_track.options.chat_css_url+"' />"}if(_ss_track.id=="20865ce1-6c61-4713-8fef-ac507207d84a"||_ss_track.id=="076ae345-1772-45dc-ba71-2b7292bc845b"){var z="First Name Last Name";var o="Let&apos;s talk"}else{var z="Name";var o="Start chat"}var g="<!DOCTYPE html><html><head>"+I+"<style type='text/css'>* {padding:0;margin:0;}"+(m.mobile?"* {-webkit-text-size-adjust:100%;-ms-text-size-adjust:none;}.gmg_chat_textarea{box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box} body {font-size:16px !important;}":"")+" .gmg_chat_line {margin:3px 0;font-size:"+D.input_fs+";} .gmg_chat_line table {border:0;border-collapse:collapse;} .gmg_chat_line table th {background-color:#ccc;border:1px solid #666;padding:2px;text-align:left;} .gmg_chat_line table td {border:1px solid #666;padding:2px;} .gmg_chat_line ul {padding-left:20px;} .gmg_chat_line ol {padding-left:20px;} .gmg_info_msg {color:#555;background-color:#eee;padding:3px;font-size:"+D.greet_fs+";margin:7px -1px 7px 0px;display:block;clear:both;} .gmg_inp_div {font-size:"+D.text_fs+";margin:6px 4px;color:#000;} .gmg_input {width:"+D.input_pad_w+";height:23px;padding: 4px 5px 4px 10px;border-radius: 4px;border:1px solid #ccc;font-size:"+D.input_fs+";} .gmg_select {width:"+D.input_w+";padding: 4px 5px 4px 10px;border-radius: 4px;height:30px;border:1px solid #ccc;font-size:"+D.input_fs+";background:#fff;} .error {color:red;font-size:"+D.greet_fs+";display:none;}"+_ss_track.options.chat_css+"</style></head><body style='background-color:transparent;overflow:hidden;font-family:tahoma,arial,sans-serif;font-size:12px'><div style='background-color:#eee;border-bottom:1px solid "+_ss_track.options.title_color+";border-left:1px solid "+_ss_track.options.title_color+";border-right:1px solid "+_ss_track.options.title_color+";'><div class='gmg_chat_head' style='padding:8px 0 8px 10px;background:"+_ss_track.options.title_color+";border:1px solid "+_ss_track.options.title_color+";color:"+_ss_track.options.title_text_color+";cursor:pointer;font-size:"+D.chat_head_fs+"'><span class='chat_head_icon'></span><b>"+_ss_track.options.online_title+"</b>"+d+(_ss_track.options.chat_no_min?"":"<div class='gmg_chat_arrow' style='float:right;padding-right:5px;color:"+_ss_track.options.title_text_color+"'>&#x25B2;</div>")+"</div><div class='gmg_prechat_online' style='display:none'><div style='color:#000;background-color:#fff;padding:4px;font-size:"+D.greet_fs+";'>"+_ss_track.options.pre_greet+"</div><form action='javascript:void(0)' class='gmg_prechat_form'><div class='gmg_prechat_name gmg_inp_div'><input placeholder='"+z+"' type='text' class='gmg_input' value='"+_ss_track.options.visitor_name+"'></div><div class='gmg_prechat_email gmg_inp_div'><span class='error'></span><input placeholder='Email' type='text' class='gmg_input' value='"+_ss_track.options.visitor_email+"'></div>"+C+((!H)?O:"")+"<div class='gmg_prechat_sub' style='text-align:center'><input type='submit' value='"+o+"' style='font-size:"+D.greet_fs+";height:27px;padding:0 10px;margin:3px 0 20px;background:"+_ss_track.options.title_color+";border:1px solid "+_ss_track.options.title_color+";color:"+_ss_track.options.title_text_color+";border-radius:4px;-moz-border-radius:4px;-webkit-border-radius:4px'></div></form></div><div class='gmg_chat_online'><div class='gmg_agent_info' style='"+(_ss_track.options.img_enable?"":"display:none;")+"padding:5px 5px 7px 5px;background-color:#eee;border-bottom:1px solid #ccc;'><div style='background: url("+location.protocol+"//"+_ss_track.FE_SERVER+"/agent_img/0/"+_taq.id+"/) no-repeat 50% 50%;float:left;margin-right:5px;width:"+D.pic_h_w+";height:"+D.pic_h_w+";background-size: contain;' class='gmg_agent_img'> </div><div style='background:url("+location.protocol+"//"+_ss_track.FE_SERVER+"/company_logo/"+_ss_track.id+"/) no-repeat 50% 50%;float:right;width:100px;height:40px'></div><span class='gmg_agent_name' style='display:block;padding-top:5px;font-weight:bold;font-size:"+D.text_fs+";overflow:hidden;text-overflow:ellipsis;white-space:nowrap;' title='Agent'>"+_ss_track.options.dflt_ag_nm+"</span><span class='gmg_agent_des' style='display:block;padding-top:3px;font-size:9px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;min-height:14px;' title=''></span></div><div class='visitorcall-outer' style='width:100%;height:40px;background-color:rgba(0,0,0,0.7);display:none;'><div class='call-inner' style='margin:0px;display:block;'><span class='connect' style='color:#fff;font-size:14px;margin:12px 0 0 10px;float:left;'><img style='width:14px;height:14px;vertical-align:middle;' src='"+location.protocol+"//"+_ss_track.FE_SERVER+"/static/images/audiovideo/call.png'/> Connecting...</span><div class='circle video' style='float:right;display:inline-block;'><img src='"+location.protocol+"//"+_ss_track.FE_SERVER+"/static/images/audiovideo/startvideo.png' style='margin:8px 17px 0px 0px;width:24px;height:24px;vertical-align: middle;'/></div><div class='circle audio' style='float:right;display:inline-block;'><img src='"+location.protocol+"//"+_ss_track.FE_SERVER+"/static/images/audiovideo/startcall.png' style='margin:8px 17px 0px 0px;width:24px;height:24px;vertical-align: middle;'/></div><div class='circle ft' style='float:right;display:inline-block;'><img src='"+location.protocol+"//"+_ss_track.FE_SERVER+"/static/images/filetransfer/livechat-send-file.png' style='margin:8px 17px 0px 0px;width:24px;height:24px;vertical-align: middle;'/></div></div></div><div class='agentcall-outer' style='position:absolute;z-index:99999;width:70%;height:auto;margin: 12%;z-index:999999;background-color:rgba(0,0,0,0.8);box-shadow:0px 0px 5px rgba(0,0,0,0.6);border-radius:10px;padding-bottom:10px;display:none;'><div class='video-call-inner' style='margin:0px;display:block;'><p align='center' style='margin:0px;color:#fff;font-size:14px;padding:7px 0 7px 10px;border-bottom:1px solid;'>Incoming Call</p><div align='center' style='width:33%;display:inline-block;'><div class='circle green answer_audio' style='display:inline-block;width:33px;height:33px;'><img src='"+location.protocol+"//"+_ss_track.FE_SERVER+"/static/images/audiovideo/startcall.png' style='margin:8px 7px;width: 28px;height: 28px;'/></div></div><div align='center' style='width:33%;display:inline-block;'><div class='circle green answer_video' style='display:inline-block;width:33px;height:33px;'><img src='"+location.protocol+"//"+_ss_track.FE_SERVER+"/static/images/audiovideo/startvideo.png' style='margin:8px 7px;width: 32px;height: 32px;'/></div></div><div align='center' style='width:33%;display:inline-block;'><div class='circle red call_reject' style='display:inline-block;width:33px;height:33px;'><img src='"+location.protocol+"//"+_ss_track.FE_SERVER+"/static/images/audiovideo/reject.png' style='margin:8px 7px;width: 32px;height: 32px;'/></div></div></div><div class='audio-call-inner' style='margin:0px;display:block;'><p align='center' style='margin:0px;color:#fff;font-size:14px;padding:7px 0 7px 10px;border-bottom:1px solid;'>Incoming Call</p><div align='center' style='width:50%;display:inline-block;'><div class='circle green answer_audio' style='display:inline-block;width:33px;height:33px;'><img src='"+location.protocol+"//"+_ss_track.FE_SERVER+"/static/images/audiovideo/startcall.png' style='margin:8px 7px;width: 28px;height: 28px;'/></div></div><div align='center' style='width:40%;display:inline-block;'><div class='circle red call_reject' style='display:inline-block;width:33px;height:33px;'><img src='"+location.protocol+"//"+_ss_track.FE_SERVER+"/static/images/audiovideo/reject.png' style='margin:8px 7px;width: 32px;height: 32px;'/></div></div></div></div><div class='oncall-outer' style='margin-top:-3px;width:100%;height:auto;background-color: rgba(0,0,0,0.7);display:none;padding-bottom:40px;'><div class='oncall_videobox'><video autoplay class='agent_video_box' poster='"+location.protocol+"//"+_ss_track.FE_SERVER+"/static/images/audiovideo/video_default.png' style='width: 100%;background-color: #7A7A7A;height: 145px;'></video><br><video autoplay muted class='visitor_video_box' poster='"+location.protocol+"//"+_ss_track.FE_SERVER+"/static/images/audiovideo/video_default.png' style='background-color: #383838;position: absolute;width:30%;height:50px;margin-top:-55px;border-top: 2px solid rgba(255,255,255,0.5);border-right: 2px solid rgba(255,255,255,0.5);'></video><div class='circle video_fullscreen' style='position: absolute;weight:28px;height:28px;border-radius:50px;margin: -40px 7px 0 0;border: 2px solid rgba(255,255,255,0.5);background-color: rgba(0,0,0,0.6);right: 0;'><img src='"+location.protocol+"//"+_ss_track.FE_SERVER+"/static/images/audiovideo/maximize.png' style='margin:7px 7px;width: 14px;height: 14px;vertical-align: middle;'/></div></div><div class='oncall-inner' style='margin:0px;display:block;'><div align='center' style='display:inline-block;float:right;'><div class='circle red end_call' style='display:inline-block;width:25px;height:25px;padding:3px;margin: 4px 8px 0px 5px;'><img src='"+location.protocol+"//"+_ss_track.FE_SERVER+"/static/images/audiovideo/reject.png' style='width:24px;height:24px;'/></div></div><div class='oncall_video_btn' align='center' style='display:inline-block;float:right;display:block;'><div class='circle green video-toggle' style='display:inline-block;width:25px;height:25px;padding:3px;margin: 4px 5px 0px 5px;'><img src='"+location.protocol+"//"+_ss_track.FE_SERVER+"/static/images/audiovideo/video_hide.png' style='width:24px;height:24px;'/></div></div><div class='oncall_audio_btn' align='center' style='display:inline-block;float:right;'><div class='circle green audio-toggle' style='display:inline-block;width:25px;height:25px;padding:5px;margin: 0px 5px 0px 5px;'><img src='"+location.protocol+"//"+_ss_track.FE_SERVER+"/static/images/audiovideo/mute.png' style='width: 24px;height: 24px;'/></div></div></div></div><div class='gmg_chat_content' style='font-family:arial,sans-serif;height:"+m.chat_cont_h+"!important;width:100%;overflow:auto;background-color:#fff;color:#000;'><div class='gmg_chat_wrap' style='padding:3px;margin:1px;'><div class='gmg_chat_all'><div class='gmg_info_msg gmg_info_msg_top'>"+_ss_track.options.online_greet+"</div></div></div></div><div class='gmg_chat_info' style='font-family:arial,sans-serif;font-size:9px;text-align:right;padding:2px;padding-right:4px;background-color:#fff;color:#777;'>&nbsp;</div><textarea class='gmg_chat_textarea' style='height:48px;width:"+D.textarea_w+";border:0;border-top:1px solid #bbb;border-bottom:1px solid #bbb;padding:4px;color:#000;font-size:"+D.input_fs+" !important;background-color:#fff;resize:none' placeholder='"+_ss_track.options.msg_hint+"'></textarea></div><div class='gmg_offline gmg_chat_offline' style='display:none'><div style='color:#000;background-color:#fff;padding:4px;font-size:"+D.greet_fs+";'>"+_ss_track.options.offline_greet+"</div><form action='javascript:void(0)' class='gmg_chat_form'><div class='gmg_chat_name gmg_inp_div'><input placeholder='Name' type='text' class='gmg_input' value='"+_ss_track.options.visitor_name+"'></div><div class='gmg_chat_email gmg_inp_div'><span class='error'></span><input placeholder='Email' type='text' class='gmg_input' value='"+_ss_track.options.visitor_email+"'></div>"+t+((!x)?k:"")+"<div class='gmg_chat_msg gmg_inp_div'><span class='error'></span><textarea placeholder='Type your message here' style='height:"+D.off_msg_h+";' class='gmg_input'></textarea></div><div class='gmg_chat_sub' style='text-align:center;'><input type='submit' value='Submit' style='font-size:"+D.greet_fs+";height:27px;padding:0 10px;margin:0 0 6px;background:"+_ss_track.options.title_color+";border:1px solid "+_ss_track.options.title_color+";color:"+_ss_track.options.title_text_color+";border-radius:4px;-moz-border-radius:4px;-webkit-border-radius:4px;cursor:pointer;'></div></form></div><div class='gmg_chat_unavail' style='display:none'><div style='color:#000;background-color:#fff;padding:4px 4px 15px 4px;font-size:"+D.greet_fs+";'>"+_ss_track.options.unavail_greet+"</div></div>";if(window.location.host=="zestim.com"){g+="<div style='color:#000;height:12px;text-align:center;font-size:"+D.power_fs+";background-color:#eee'>Powered by <a href='http://www.zestim.com/?utm_medium=chat_widget&utm_source="+window.location.hostname+"' target='_new' style='color:#000;'>Zestim</a></div></div></body></html>"}else{g+="<div style='color:#000;height:12px;text-align:center;font-size:"+D.power_fs+";background-color:#eee'>Powered by <a href='http://www.gsecondscreen.com/?utm_medium=chat_widget&utm_source="+window.location.hostname+"' target='_new' style='color:#000;'>Gamooga Second Screen</a></div></div></body></html>"}var R;if(_ss_track.options.chat_pos==0){R="bottom:0;right:"+_ss_track.options.chat_pos_off+"px"}else{if(_ss_track.options.chat_pos==1){R="bottom:0;left:"+_ss_track.options.chat_pos_off+"px"}else{if(_ss_track.options.chat_pos==2){R="left:0;top:"+_ss_track.options.chat_pos_off+"px;transform:rotate(90deg) translate(0,-100%);transform-origin:0 0;-moz-transform:rotate(90deg) translate(0,-100%);-moz-transform-origin:0 0;-ms-transform:rotate(90deg) translate(0,-100%);-ms-transform-origin:0 0;-webkit-transform:rotate(90deg) translate(0,-100%);-webkit-transform-origin:0 0;-o-transform:rotate(90deg) translate(0,-100%);-o-transform-origin:0 0;filter:progid:DXImageTransform.Microsoft.BasicImage(rotation=1)"}else{if(_ss_track.options.chat_pos==3){var G=-1*_ss_track.options.chat_pos_off-250;R="left:0;top:100%;margin-top:"+G+"px;transform:rotate(90deg) translate(0,-100%);transform-origin:0 0;-moz-transform:rotate(90deg) translate(0,-100%);-moz-transform-origin:0 0;-ms-transform:rotate(90deg) translate(0,-100%);-ms-transform-origin:0 0;-webkit-transform:rotate(90deg) translate(0,-100%);-webkit-transform-origin:0 0;-o-transform:rotate(90deg) translate(0,-100%);-o-transform-origin:0 0;filter:progid:DXImageTransform.Microsoft.BasicImage(rotation=1)"}else{if(_ss_track.options.chat_pos==4){R="right:0;top:"+_ss_track.options.chat_pos_off+"px;transform:rotate(270deg) translate(0,-100%);transform-origin:250px 0;-moz-transform:rotate(270deg) translate(0,-100%);-moz-transform-origin:250px 0;-ms-transform:rotate(270deg) translate(0,-100%);-ms-transform-origin:250px 0;-webkit-transform:rotate(270deg) translate(0,-100%);-webkit-transform-origin:250px 0;-o-transform:rotate(270deg) translate(0,-100%);-o-transform-origin:250px 0;filter:progid:DXImageTransform.Microsoft.BasicImage(rotation=3);-ms-writing-mode:bt-rl"}else{if(_ss_track.options.chat_pos==5){var G=-1*_ss_track.options.chat_pos_off-250;R="right:0;top:100%;margin-top:"+G+"px;transform:rotate(270deg) translate(0,-100%);transform-origin:250px 0;-moz-transform:rotate(270deg) translate(0,-100%);-moz-transform-origin:250px 0;-ms-transform:rotate(270deg) translate(0,-100%);-ms-transform-origin:250px 0;-webkit-transform:rotate(270deg) translate(0,-100%);-webkit-transform-origin:250px 0;-o-transform:rotate(270deg) translate(0,-100%);-o-transform-origin:250px 0;filter:progid:DXImageTransform.Microsoft.BasicImage(rotation=3);-ms-writing-mode:bt-rl"}}}}}}var J="<div class='gmg_chat_outer'><audio preload='none'><source src='//"+_ss_track.FE_SERVER+"/static/swf/chat.mp3' type='audio/mpeg'><source src='//"+_ss_track.FE_SERVER+"/static/swf/chat.wav' type='audio/wav'></audio><iframe allowfullscreen='true' webkitallowfullscreen='true' mozallowfullscreen='true' class='gmg_chat' style='width:"+D.widget_w+(m.mobile?" !important; max-width:500px":"")+";max-height:100%;height:0;position:fixed;"+R+";text-align:left;z-index:9999999999;border:0;-webkit-border-radius:4px 4px 0 0;-moz-border-radius:4px 4px 0 0;border-radius:4px 4px 0 0;box-shadow: 0 0 5px #333' marginheight='0' marginwidth='0' frameborder='0'";var q="></iframe></div>";if(false&&E.browser.webkit){_ss_track.__srcfn=function(){return g};E("body").append(J+" src='javascript:if(parent._ss_track)parent._ss_track.__srcfn()'"+q)}else{E("body").append(J+q);var h=E("iframe.gmg_chat")[0];h.contentWindow.document.open();h.contentWindow.document.write(g);h.contentWindow.document.close()}E("iframe.gmg_chat").load(function(){if(m.chat_shown){E("iframe.gmg_chat").css("height",m.chat_frame.css("height"))}});var M=m.chat_frame=E("iframe.gmg_chat").contents().find("body");if(!_ss_track.options.hide_on_min){E("iframe.gmg_chat").stop().animate({height:m.chat_frame.find(".gmg_chat_head").outerHeight()+"px"},250,"linear")}m.chat_shown=false;var c=function(j,W){return function(){return W.apply(j,arguments)}};if(_ss_track.options.chat_close){M.find(".gmg_chat_close").click(function(){m.stop_flick();m.remove_chat_widget()})}if(!_ss_track.options.chat_no_min){M.find(".gmg_chat_head").click(c(m,m.chat_clicked))}var F=null;M.find(".gmg_chat_textarea").keypress(c(m,function(W){var j=this;if(W.which=="13"){j.chat_posted();j.ws.send(String.fromCharCode(U));clearTimeout(F);F=null;if(j.mobile){M.find(".gmg_chat_textarea").blur();if(window.AndroidInterface){window.AndroidInterface.hideKeyboard()}}return false}if(F==null){j.ws.send(String.fromCharCode(T))}clearTimeout(F);F=setTimeout(function(){j.ws.send(String.fromCharCode(U));F=null},5000)}));var K=null;M.find(".gmg_prechat_srvy select").change(function(){var Y=E(this).attr("data-set");var aa=E(this).val();var X=E(this).find("option:checked").attr("data-show");var j=E(this).find("option:checked").attr("data-route");var W=E(this);while(true){var Z=W.data("dep");if(!Z){break}W.removeAttr("dep");Z.hide();W=Z}if(m.chat_shown){E("iframe.gmg_chat").css("height",m.chat_frame.css("height"))}if(X){M.find(".gmg_prechat_form #pcs_wrap_"+X).show();E(this).data("dep",M.find(".gmg_prechat_form #pcs_wrap_"+X));if(m.chat_shown){E("iframe.gmg_chat").css("height",m.chat_frame.css("height"))}}if(j){K=j}});M.find(".gmg_offline_srvy select").change(function(){var Y=E(this).attr("data-set");var aa=E(this).val();var X=E(this).find("option:checked").attr("data-show");var j=E(this).find("option:checked").attr("data-route");var W=E(this);while(true){var Z=W.data("dep");if(!Z){break}W.removeAttr("dep");Z.hide();W=Z}if(m.chat_shown){E("iframe.gmg_chat").css("height",m.chat_frame.css("height"))}if(X){M.find(".gmg_chat_form #offs_wrap_"+X).show();E(this).data("dep",M.find(".gmg_chat_form #offs_wrap_"+X));if(m.chat_shown){E("iframe.gmg_chat").css("height",m.chat_frame.css("height"))}}if(j){K=j}});if(K=="0"){K=null}if(m.sess_conf.settings.depts.length>0){m.update_online_depts()}M.find(".gmg_prechat_form").submit(function(aa){var W=M.find(".gmg_prechat_name input").val();var j=M.find(".gmg_prechat_email input").val();var Z=false;M.find(".gmg_prechat_srvy .grq").css("border","1px solid #ccc").prev().hide();M.find(".gmg_prechat_srvy .grq").each(function(){if(E(this).is(":visible")&&(E(this).val()==null||E(this).val()=="")){E(this).css("border","1px solid red");E(this).prev().html(" (required)").show();Z=true}});M.find(".gmg_prechat_email input").css("border","1px solid #ccc");M.find(".gmg_prechat_email span.error").hide();if(j==""){M.find(".gmg_prechat_email input").css("border","1px solid red");M.find(".gmg_prechat_email span.error").html(" (required)").show();Z=true}else{if(!/[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]+/i.test(j)){M.find(".gmg_prechat_email input").css("border","1px solid red");M.find(".gmg_prechat_email span.error").html(" (valid email required)").show();Z=true}}M.find(".gmg_prechat_dept select").css("border","1px solid #ccc");if(M.find(".gmg_prechat_dept select").length>0){if(!M.find(".gmg_prechat_dept select").val()){M.find(".gmg_prechat_dept select").css("border","1px solid red");Z=true}}if(!Z){m.finish_prechat();if(M.find(".gmg_prechat_dept select").length>0){m.ws.send(String.fromCharCode(v)+M.find(".gmg_prechat_dept select").val());m.ws.send(String.fromCharCode(A)+"(has filled prechat form and started chat)")}else{if(K&&K!="0"){m.ws.send(String.fromCharCode(v)+K);m.ws.send(String.fromCharCode(A)+"(has filled prechat form and started chat)")}else{m.ws.send(String.fromCharCode(A)+"(has filled prechat form and started chat)")}}var Y=[];var X=[];M.find(".gmg_prechat_srvy input,.gmg_prechat_srvy select").each(function(){if(E(this).val()!=""){Y.push([E(this).attr("id"),E(this).val()])}if(E(this).prop("tagName")=="INPUT"){X.push([E(this).attr("placeholder"),E(this).val()])}else{if(E(this).prop("tagName")=="SELECT"){X.push([E("option:eq(0)",this).text(),E(this).val()])}}});m.pc_name=W;m.pc_email=j;m.pc_data=X;m.ws.send(String.fromCharCode(f)+W+a+j+a+JSON.stringify(X));if(W!=_ss_track.options.visitor_name||j!=_ss_track.options.visitor_email||Y.length>0){E.ajax({type:"GET",url:"//"+_ss_track.GMG_SERVER+"/vnameemail_post/",data:{cid:_ss_track.id,vid:m.user_data.cookie_id,name:W,email:j,pcsdj:JSON.stringify(Y)},dataType:"jsonp",success:function(ab){if(ab=="0"){SecondScreen._write_local_data("vne",SecondScreenUtils.base64encode(JSON.stringify({name:W,email:j})));_ss_track.options.visitor_name=W;_ss_track.options.visitor_email=j}}})}}E("iframe.gmg_chat").css("height",m.chat_frame.css("height"))});M.find(".gmg_chat_form").submit(function(Z){var X=E(this).find(".gmg_chat_name input").val();var W=E(this).find(".gmg_chat_email input").val();var ab=E(this).find(".gmg_chat_msg textarea").val();var Y=false;E(this).find(".gmg_chat_email input").css("border","1px solid #ccc");E(this).find(".gmg_chat_msg textarea").css("border","1px solid #ccc");E(this).find(".gmg_chat_email span.error").hide();E(this).find(".gmg_chat_msg span.error").hide();E(this).find(".gmg_offline_srvy .grq").css("border","1px solid #ccc").prev().hide();E(this).find(".gmg_offline_srvy .grq").each(function(){if(E(this).is(":visible")&&(E(this).val()==null||E(this).val()=="")){E(this).css("border","1px solid red");E(this).prev().html(" (required)").show();Y=true}});E(this).find(".gmg_chat_email input").css("border","1px solid #ccc");E(this).find(".gmg_chat_email span.error").hide();if(W==""){E(this).find(".gmg_chat_email input").css("border","1px solid red");E(this).find(".gmg_chat_email span.error").html(" (required)").show();Y=true}else{if(!/[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]+/i.test(W)){E(this).find(".gmg_chat_email input").css("border","1px solid red");E(this).find(".gmg_chat_email span.error").html(" (valid email required)").show();Y=true}}E(this).find(".gmg_offline_dept select").css("border","1px solid #ccc");if(E(this).find(".gmg_offline_dept select").length>0){if(!E(this).find(".gmg_offline_dept select").val()){E(this).find(".gmg_offline_dept select").css("border","1px solid red");Y=true}}E("iframe.gmg_chat").css("height",m.chat_frame.css("height"));if(!Y){var j={};E(this).find(".gmg_offline_srvy input").each(function(ae,ad,ac){j[E(this).attr("placeholder")]=E(this).val()});E(this).find(".gmg_chat_sub input").val("Sending...");E(this).find(".gmg_chat_sub input").attr("disabled","disabled");var aa=0;E(this).find(".gmg_offline_srvy select").each(function(){var ac=(JSON.parse(E(this).attr("data-set")));if(!E.isEmptyObject(ac.route)){aa=E(this).find("option:selected").attr("data-route")}});if(!x){aa=E(this).find(".gmg_offline_dept select").val()}E.ajax({type:"GET",url:"//"+_ss_track.GMG_SERVER+"/offline_mail/",data:{id:_ss_track.id,n:X,e:W,m:ab,l:location.href,d:aa,extra_data:JSON.stringify(j)},dataType:"jsonp",success:function(ad){if(ad[0]=="0"){M.find(".gmg_chat_sub input").val("Sent!");setTimeout(function(){M.find(".gmg_chat_name input").val("");M.find(".gmg_chat_email input").val("");M.find(".gmg_chat_msg textarea").val("");M.find(".gmg_chat_sub input").val("Submit");M.find(".gmg_chat_sub input").removeAttr("disabled")},4000)}else{if(ad[0]=="-1"){var ac=ad[1];if(ac.e){M.find(".gmg_chat_email span.error").html(" "+ac.e).show();M.find(".gmg_chat_email input").css("border","1px solid red")}if(ac.m){M.find(".gmg_chat_msg span.error").html(" "+ac.m).show();M.find(".gmg_chat_msg textarea").css("border","1px solid red")}M.find(".gmg_chat_sub input").val("Error! Try again.");setTimeout(function(){M.find(".gmg_chat_sub input").val("Submit");M.find(".gmg_chat_sub input").removeAttr("disabled")},4000);E("iframe.gmg_chat").css("height",m.chat_frame.css("height"))}}}}).error(function(){E(this).find(".gmg_chat_sub input").val("Error! Try again.");setTimeout(function(){E(this).find(".gmg_chat_sub input").val("Submit");E(this).find(".gmg_chat_sub input").removeAttr("disabled")},4000)})}Z.preventDefault()});M.click(function(){m.stop_flick()});m.visitor_calloption()};SecondScreen.prototype.is_chatting=function(){var b=SecondScreenUtils.$;var a=this;return SecondScreen._read_sess_data("__ss_support")=="1"};SecondScreen.prototype.submitPrechatForm=function(){var f=33;var a="\u0002";var d=this;var c=_ss_track.options.visitor_name;var b=_ss_track.options.visitor_email;var g=_ss_track.options.pc_resp;d.pc_data=g;console.log(g);d.ws.send(String.fromCharCode(f)+c+a+b+a+JSON.stringify(g));d.finish_prechat();$.ajax({type:"GET",url:"//"+_ss_track.GMG_SERVER+"/vnameemail_post/",data:{cid:_ss_track.id,vid:d.user_data.cookie_id,name:c,email:b,pcsdj:JSON.stringify(g)},dataType:"jsonp",success:function(h){if(h=="0"){SecondScreen._write_local_data("vne",SecondScreenUtils.base64encode(JSON.stringify({name:c,email:b})));_ss_track.options.visitor_name=c;_ss_track.options.visitor_email=b}}})};SecondScreen.prototype.attach_altid=function(b,a){var d=SecondScreenUtils.$;var c=this;d.ajax({type:"GET",url:"//"+_ss_track.GMG_SERVER+"/valtid_post/",data:{cid:_ss_track.id,vid:c.user_data.cookie_id,altid:b},dataType:"jsonp",success:function(f){if(f=="0"){if(a){a(true)}}else{if(a){a(false)}}}})};SecondScreen.prototype.show_chat_widget=function(){var b=SecondScreenUtils.$;var a=this;if(!a.chat_enabled){return}b(".gmg_chat_outer").show()};SecondScreen.prototype.hide_chat_widget=function(){var b=SecondScreenUtils.$;var a=this;if(!a.chat_enabled){return}b(".gmg_chat_outer").hide()};SecondScreen.prototype.remove_chat_widget=function(){var b=SecondScreenUtils.$;var a=this;if(!a.chat_enabled){return}SecondScreen._del_sess_data("__ss_chat");a.chat_enabled=false;b(".gmg_chat_outer").remove()};SecondScreen.prototype.prefill_chat=function(c){var d=89;var f=SecondScreenUtils.$;var b=this;for(var a=0;a<c.length;a++){var g=c[a];if(g.who=="visitor"){b.add_chat_message("You",g.chat)}else{b.add_chat_message(g.who,g.chat);b.last_chat_recv_at=new Date(g.epoch*1000);b.last_chat_agent=g.who}}b.update_last_chat_recv_at();b.ws.send(String.fromCharCode(d)+JSON.stringify(c))};SecondScreen.prototype.live_chat_click=function(f,g,c,b){var d=SecondScreenUtils.$;var a=this;if(!a.chat_enabled){if(a.chat_enabled_by_agent){a.chat_enabled=true;a.add_chat_widget();if(a.prechat_enabled){a.chat_frame.find(".gmg_chat_online").hide();a.chat_frame.find(".gmg_prechat_online").show()}if(a.offline_message_disabled&&!a.unavail_greet_enabled){a.hide_chat_widget()}}else{return}}if(a.agent_present){if(a.offline_message_disabled&&!a.unavail_greet_enabled){a.show_chat_widget();a.chat_show();if(b){a.prefill_chat(b)}return}if(a.prechat_enabled){a.chat_frame.find(".gmg_prechat_online").show()}else{a.chat_frame.find(".gmg_chat_online").show()}if(!a.offline_message_disabled){a.chat_frame.find(".gmg_chat_offline").hide()}else{a.chat_frame.find(".gmg_chat_unavail").hide()}if(a.chat_shown){d("iframe.gmg_chat").css("height",a.chat_frame.css("height"))}a.chat_frame.find(".gmg_chat_head b").html(_ss_track.options.online_title);a.chat_show();if(c){a.finish_prechat();if(b){a.prefill_chat(b)}}if(a.prechat_enabled&&(f||g)){if(f){a.chat_frame.find(".gmg_prechat_name input").val(f)}if(g){a.chat_frame.find(".gmg_prechat_email input").val(g)}a.chat_frame.find(".gmg_prechat_form").submit()}}else{if(a.offline_message_disabled&&!a.unavail_greet_enabled){a.hide_chat_widget();return}if(a.prechat_enabled){a.chat_frame.find(".gmg_prechat_online").hide()}else{a.chat_frame.find(".gmg_chat_online").hide()}if(!a.offline_message_disabled){a.chat_frame.find(".gmg_chat_offline").show();a.chat_frame.find(".gmg_chat_head b").html(_ss_track.options.offline_title)}else{a.chat_frame.find(".gmg_chat_unavail").show();a.chat_frame.find(".gmg_chat_head b").html(_ss_track.options.unavail_title)}if(a.chat_shown){d("iframe.gmg_chat").css("height",a.chat_frame.css("height"))}a.chat_show()}};SecondScreen.prototype.chat_toggle=function(){var b=SecondScreenUtils.$;var a=this;if(!a.chat_enabled){return}if(a.chat_shown){a.chat_frame.find(".gmg_chat_arrow").html("&#x25B2;");b("iframe.gmg_chat").stop().css("height",a.chat_frame.find(".gmg_chat_head").outerHeight()+"px");if(_ss_track.options.chat_size==1){b("iframe.gmg_chat").css("width","300px")}if(_ss_track.options.chat_pos==2||_ss_track.options.chat_pos==3){b("iframe.gmg_chat").css({transform:"rotate(90deg) translate(0,-100%)","-webkit-transform":"rotate(90deg) translate(0,-100%)","-moz-transform":"rotate(90deg) translate(0,-100%)","-ms-transform":"rotate(90deg) translate(0,-100%)","-o-transform":"rotate(90deg) translate(0,-100%)",filter:"progid:DXImageTransform.Microsoft.BasicImage(rotation=1)"})}else{if(_ss_track.options.chat_pos==4||_ss_track.options.chat_pos==5){b("iframe.gmg_chat").css({transform:"rotate(270deg) translate(0,-100%)","-webkit-transform":"rotate(270deg) translate(0,-100%)","-moz-transform":"rotate(270deg) translate(0,-100%)","-ms-transform":"rotate(270deg) translate(0,-100%)","-o-transform":"rotate(270deg) translate(0,-100%)",filter:"progid:DXImageTransform.Microsoft.BasicImage(rotation=3)"})}}a.chat_shown=false;SecondScreen._write_sess_data("__ss_chat","0");if(_ss_track.options.hide_on_min){b("iframe.gmg_chat").stop().css("height","0")}}else{if(a.ws.readyState==a.ws.CLOSED){a.reconnect_count=0;a.reconnect()}a.chat_frame.find(".gmg_chat_arrow").html("&#x25BC;");if(_ss_track.options.chat_size==1){b("iframe.gmg_chat").css("width","450px")}b("iframe.gmg_chat").stop().css("height",a.chat_frame.css("height"));if(_ss_track.options.chat_pos>=2){b("iframe.gmg_chat").css({transform:"none","-webkit-transform":"none","-moz-transform":"none","-ms-transform":"none","-o-transform":"none",filter:"none"})}a.chat_shown=true;var c=a.chat_frame.find(".gmg_chat_content");c.stop().scrollTop(c[0].scrollHeight);SecondScreen._write_sess_data("__ss_chat","1");if(a.unread_chat_show_interval!==null){a.unread_chat_count=0;clearInterval(a.unread_chat_show_interval);a.unread_chat_show_interval=null;a.unread_chat_show_helper=0;a.chat_frame.find(".gmg_chat_head b").html(_ss_track.options.online_title)}}};SecondScreen.prototype.init_call=function(c){var d=SecondScreenUtils.$;var b=this;if(!util.supports.audioVideo){b.add_info_message("Sorry, your browser does not support "+c+" call.");return}var a=(c==="video")?true:false;navigator.getUserMedia({audio:true,video:a},function(g){window.localStream=g;if(b.peer==null){b.initializePeer()}console.log("Sending call init "+c);var f=95;b.ws.send(String.fromCharCode(f));b.calltype=c;b.after_visitor_calloption(c)},function(){console.log("Couldn't get media");b.add_info_message("Unable to access your microphone/camera. Sorry, you cannot make call.");b.visitor_calloption()})};SecondScreen.prototype.end_call=function(){var b=SecondScreenUtils.$;var a=this;if(window.existingCall){window.existingCall.close()}a.peer.destroy();if(window.localStream.getAudioTracks()[0]){window.localStream.getAudioTracks()[0].stop()}if(window.localStream.getVideoTracks()[0]){window.localStream.getVideoTracks()[0].stop()}a.calltype=null;a.peer=null;a.webrtc_key=null;a.visitor_calloption()};SecondScreen.prototype.chat_audio_off=function(){var b=SecondScreenUtils.$;var a=this;window.localStream.getAudioTracks()[0].enabled=false;a.chat_frame.find(".oncall-outer .oncall_audio_btn").css({"background-color":"rgb(233,152,33)"});a.chat_frame.find(".oncall-outer .audio-toggle").click(function(){a.chat_audio_on()})};SecondScreen.prototype.chat_video_off=function(){var b=SecondScreenUtils.$;var a=this;window.localStream.getVideoTracks()[0].enabled=false;a.chat_frame.find(".oncall-outer .oncall_video_btn").css({"background-color":"rgb(233,152,33)"});a.chat_frame.find(".oncall-outer .video-toggle").click(function(){a.chat_video_on()})};SecondScreen.prototype.chat_audio_on=function(){var b=SecondScreenUtils.$;var a=this;window.localStream.getAudioTracks()[0].enabled=true;a.chat_frame.find(".oncall-outer .oncall_audio_btn").css({"background-color":"transparent"});a.chat_frame.find(".oncall-outer .audio-toggle").click(function(){a.chat_audio_off()})};SecondScreen.prototype.chat_video_on=function(){var b=SecondScreenUtils.$;var a=this;window.localStream.getVideoTracks()[0].enabled=true;a.chat_frame.find(".oncall-outer .oncall_video_btn").css({"background-color":"transparent"});a.chat_frame.find(".oncall-outer .video-toggle").click(function(){a.chat_video_off()})};SecondScreen.prototype.chat_clicked=function(){var b=SecondScreenUtils.$;var a=this;a.chat_toggle()};SecondScreen.prototype.chat_show=function(){var b=SecondScreenUtils.$;var a=this;a.chat_shown=false;a.chat_toggle()};SecondScreen.prototype.chat_hide=function(){var b=SecondScreenUtils.$;var a=this;a.chat_shown=true;a.chat_toggle()};SecondScreen.prototype.chat_posted=function(){var f=SecondScreenUtils.$;var d=this;if(!d.chat_enabled){return}var c=77;var g=d.chat_frame.find(".gmg_chat_textarea").val();g=g.trim();if(g==""){return}g=g.substr(0,1024);d.chat_frame.find(".gmg_chat_textarea").val("");d.add_chat_message("You",g);if((_ss_track.id=="a6ac3e6e-c86b-4536-aedd-105a3df85b16"||_ss_track.id=="90a5d6f0-53a1-49ee-94f9-a388cd636831")&&!_ss_track.___simpli_trigger_timeout){var b=SecondScreen._read_sess_data("__ss_support");if(typeof b=="undefined"||b=="0"){if(SecondScreen._read_sess_data("chatafterprochat")===undefined){_ss_track.___simpli_trigger_timeout=setTimeout(function(){var h=SecondScreen._read_sess_data("__ss_support");if(typeof h=="undefined"||h=="0"){d.add_chat_message("System","We have made you wait for long! Seems all our consultants are busy chatting with other customers. We have your details and will get in touch with you shortly.")}},180000)}else{_ss_track.___simpli_trigger_timeout=setTimeout(function(){var h=SecondScreen._read_sess_data("__ss_support");if(typeof h=="undefined"||h=="0"){d.add_chat_message("System",'We have made you wait for long! Seems all our consultants are busy chatting with other customers. We request you to leave your details on "request a call back" section on our site.')}},180000)}}}d.ws.send(String.fromCharCode(c)+g);var a=SecondScreen._read_sess_data("analytic_latest_trigger");if(a){d.taq_convs.chat_start_atic(a);SecondScreen._del_sess_data("analytic_latest_trigger")}};SecondScreen.prototype.add_info_message=function(c){var b=SecondScreenUtils.$;var a=this;a._add_message("<div class='gmg_info_msg'>"+c+"</div>")};SecondScreen.prototype.add_status_message=function(c){var b=SecondScreenUtils.$;var a=this;a._add_message("<i>"+c+"</i>")};SecondScreen.prototype.agent_calling=function(a){var b=this;b.chat_frame.find(".gmg_info_msg_top").css("margin-top","0px");if(b.prechat_enabled){b.finish_prechat()}b.chat_show();b.chat_frame.find(".oncall-outer").hide();b.chat_frame.find(".visitorcall-outer div.audio").hide();b.chat_frame.find(".visitorcall-outer div.video").hide();if(a==="audio"){b.chat_frame.find(".agentcall-outer > div.audio-call-inner").show();b.chat_frame.find(".agentcall-outer > div.video-call-inner").hide()}else{b.chat_frame.find(".agentcall-outer > div.audio-call-inner").hide();b.chat_frame.find(".agentcall-outer > div.video-call-inner").show()}b.chat_frame.find(".agentcall-outer").show();b.chat_frame.find(".agentcall-outer .answer_audio").unbind("click").bind("click",function(){b.answer_call("audio")});b.chat_frame.find(".agentcall-outer .call_reject").unbind("click").bind("click",function(){b.answer_call("reject")});if(a==="video"){b.chat_frame.find(".agentcall-outer .answer_video").unbind("click").bind("click",function(){b.answer_call("video")})}};SecondScreen.prototype.on_calling_option=function(){var a=this;a.chat_frame.find(".gmg_info_msg_top").css("margin-top","0px");a.chat_frame.find(".agentcall-outer").hide();a.chat_frame.find(".visitorcall-outer").hide();a.chat_frame.find(".oncall-outer").show();a.chat_frame.find(".oncall-outer .audio-toggle").unbind("click").bind("click",function(){a.chat_audio_off()});a.chat_frame.find(".oncall-outer .video-toggle").unbind("click").bind("click",function(){a.chat_video_off()});a.chat_frame.find(".oncall-outer .end_call").unbind("click").bind("click",function(){window.existingCall.close()});a.addVideoFrame()};SecondScreen.prototype.addVideoFrame=function(){var a=this;a.chat_frame.find(".gmg_chat_content").css("height","150px");$("iframe.gmg_chat").css("height",a.chat_frame.css("height"));a.chat_frame.find(".toggle_calloption").unbind("click");a.chat_frame.find(".video_fullscreen").click(function(b){a.toggleFullScreen()})};SecondScreen.prototype.toggleFullScreen=function(){var a=this;var b=a.chat_frame.find(".agent_video_box")[0];if(b.requestFullscreen){b.requestFullscreen()}else{if(b.mozRequestFullScreen){b.mozRequestFullScreen()}else{if(b.webkitRequestFullscreen){b.webkitRequestFullscreen()}else{if(b.msRequestFullscreen){b.msRequestFullscreen()}}}}};SecondScreen.prototype.bind=function(a,b){return function(){return b.apply(a,arguments)}};SecondScreen.prototype.initializePeer=function(){var b=this;var a=_ss_track.options.peerjs_svr.split(":");if(location.protocol=="https:"){a=[a[0],"443"]}else{if(a.length==1){a.push("80")}}var c=new Peer({host:a[0],port:a[1],path:"/",debug:4,config:{iceServers:[{url:"stun:stun.l.google.com:19302"}]}});c.on("open",function(){console.log("peer connection opened - "+c.id);b.webrtc_key=c.id});c.on("call",function(d){console.log("receiving a new call");window.existingCall=d;b.play_and_flick("call");b.agent_calling(d.metadata.calltype)});c.on("error",function(d){alert(d.message);console.log(d.message);b.visitor_calloption()});b.peer=c};SecondScreen.prototype.answer_call=function(b){var d=this;d.stop_flick();if(b!=="reject"){var c=(b==="video")?true:false;navigator.getUserMedia({audio:true,video:c},function(f){window.localStream=f;window.existingCall.answer(window.localStream);d.handle_call(window.existingCall)},function(){console.log("Couldn't get media");d.add_info_message("Unable to access your microphone/camera. Call cannot be connected.");d.answer_call("reject")})}else{var a=97;d.ws.send(String.fromCharCode(a));window.existingCall.close();d.visitor_calloption()}};SecondScreen.prototype.handle_call=function(b){var a=this;window.existingCall=b;b.on("stream",function(c){a.on_calling_option();a.chat_frame.find(".oncall-outer .agent_video_box").prop("src",URL.createObjectURL(c));a.chat_frame.find(".oncall-outer .visitor_video_box").prop("src",URL.createObjectURL(window.localStream))});b.on("close",function(){a.end_call()})};SecondScreen.prototype.visitor_calloption=function(){var b=SecondScreenUtils.$;var a=this;a.chat_frame.find(".agentcall-outer").hide();a.chat_frame.find(".oncall-outer").hide();if(_ss_track.options.audio_video>0||_ss_track.options.file_transfer==true){a.chat_frame.find(".gmg_info_msg_top").css("margin-top","0px");a.chat_frame.find(".visitorcall-outer .connect").hide();a.chat_frame.find(".visitorcall-outer div.audio").hide();a.chat_frame.find(".visitorcall-outer div.video").hide();a.chat_frame.find(".visitorcall-outer div.ft").hide();if(_ss_track.options.audio_video>0){a.chat_frame.find(".visitorcall-outer div.audio").unbind("click").bind("click",function(){a.init_call("audio")});a.chat_frame.find(".visitorcall-outer div.audio").show();if(_ss_track.options.audio_video==2){a.chat_frame.find(".visitorcall-outer div.video").unbind("click").bind("click",function(){a.init_call("video")});a.chat_frame.find(".visitorcall-outer div.video").show()}}if(_ss_track.options.file_transfer==true){a.chat_frame.find(".visitorcall-outer div.ft").unbind("click").bind("click",function(){var c=window.open(location.protocol+"//"+_ss_track.GMG_SERVER+"/livechat/filetransfer/?comp_id="+_ss_track.id,"child","height=250,width=500");return false;c.focus()});a.chat_frame.find(".visitorcall-outer div.ft").show()}a.chat_frame.find(".visitorcall-outer").show()}a.chat_frame.find(".gmg_chat_content").css("height",a.chat_cont_h);if(a.chat_shown){b("iframe.gmg_chat").css("height",a.chat_frame.css("height"))}};function sendFilename(a){var c="[file_transfer "+a+" ]";var b=77;_ss_track.api.ws.send(String.fromCharCode(b)+c);_ss_track.api.add_chat_message("You",c)}SecondScreen.prototype.after_visitor_calloption=function(b){var a=this;a.chat_frame.find(".visitorcall-outer div.video").hide();a.chat_frame.find(".visitorcall-outer div.audio").hide();if(b=="audio"){a.chat_frame.find(".visitorcall-outer .connect").attr("src",location.protocol+"//"+_ss_track.FE_SERVER+"/static/images/audiovideo/call.png")}else{if(b=="video"){a.chat_frame.find(".visitorcall-outer .connect").attr("src",location.protocol+"//"+_ss_track.FE_SERVER+"/static/images/audiovideo/video.png")}}a.chat_frame.find(".visitorcall-outer .connect").show()};SecondScreen.prototype.add_chat_message=function(c,f){var d=SecondScreenUtils.$;var b=this;c=c.replace(/<|>/g,function(g){return g=="<"?"&lt;":"&gt;"});var a;if(f.lastIndexOf("[file transfer",0)===0){a=f.replace("[file_transfer ","");a=a.substring(0,a.length-1);f=a.replace(/^.*[\\\/]/,"")}else{f=f.replace(/<|>/g,function(g){return g=="<"?"&lt;":"&gt;"}).replace(b.url_regex,function(h,k){var j="";if(!k){j="http://"}var g=document.createElement("a");g.href=j+h;if(g.host==""){g.href=g.href}if(g.host==window.location.host){return'<a target="_top" href="'+j+h+'">'+h+"</a>"}else{return'<a target="_new" href="'+j+h+'">'+h+"</a><small>&#x279A;</small>"}}).replace(/\[(\/?)((b)|(i)|(u)|(table)|(tr)|(td)|(th)|(ul)|(ol)|(li)|(br))\]/g,"<$1$2>")}if(!_ss_track.options.img_enable){b.agent_id=0}if(b.agent_id==null){b.agent_id=0}if(c=="You"){msg='<div style="clear:both;"><img src="'+location.protocol+"//"+_ss_track.FE_SERVER+'/static/images/user_chat_icon.png" style="float: right;margin:8px 4px 0 0;width:24px;height:24px;border-radius:24px;"><span style="border: 5px solid #e5e5e5;float: right;right: 0;-ms-transform: rotate(45deg);-webkit-transform: rotate(45deg);transform: rotate(45deg);margin: 12px 4px 0 -9px;"></span><span style="border: 5px solid #fbfbfb;float: right;right: 0;-ms-transform: rotate(45deg); -webkit-transform: rotate(45deg);transform: rotate(45deg);margin: 12px 0 0 -9px;"></span><p style="float:right;background-color:#fbfbfb;padding: 4px 10px 4px 5px;border:1px solid #e5e5e5;border-radius:4px;margin:3px 3px 0 0;max-width:70%;word-wrap:break-word;margin-bottom:10px;"><b>'+c+"</b><br><span>"+f+"</span></p></div>"}else{msg='<div style="clear:both;"><div class="chat_agent_img_ico" style="background: url('+location.protocol+"//"+_ss_track.FE_SERVER+"/agent_img/"+b.agent_id+"/"+_taq.id+'/) 50% 50% / contain no-repeat;float:left;margin:8px 4px 0 3px;width:24px;height:24px;border-radius:24px;"></div><span style="border: 5px solid #cbe7f5;float:left;right: 0;-ms-transform: rotate(45deg);-webkit-transform: rotate(45deg);transform: rotate(45deg);margin: 12px 0 0 1px;"></span><span style="border: 5px solid #E4F1FA;float:left;right: 0;-ms-transform: rotate(45deg); -webkit-transform: rotate(45deg);transform: rotate(45deg);margin: 12px 0 0 -9px;"></span><p style="background-color:#e4f1fa;padding: 4px 5px 4px 10px;border:1px solid #cbe7f5;border-radius:4px;margin:0 0 0 -6px;max-width:70%;word-wrap:break-word;margin-bottom:10px;float:left;"><b>'+(c!=""?c:"Agent")+"</b><br><span>"+f+"</span></p></div>"}if(a){msg=d(msg);msg.find("br").before('<a href="'+a+'" target="_blank" style="display:inline; cursor:pointer;"><img src="'+location.protocol+"//"+_ss_track.FE_SERVER+'/static/images/filetransfer/ft-chatmsg.png" width="20px" height="20px" style="vertical-align:bottom; float:right; opacity:.7; margin-left:10px; display:inline-block; margin-top:-4px;"></a>');msg.find("span").last().text("");msg.find("span").last().append('<a target="_blank" href="'+a+'">'+f+"</a>");b._add_message(msg[0].outerHTML)}else{b._add_message(msg)}if(b.latest_chat_id!==null){b.latest_chat_id=null;b.feedback_status()}};SecondScreen.prototype._add_message=function(c){var b=SecondScreenUtils.$;var a=this;if(!a.chat_enabled){return}if(a.prechat_enabled){a.finish_prechat()}a.chat_frame.find(".gmg_chat_content .gmg_chat_all").append("<div class='gmg_chat_line'>"+c+"</div>");a.chat_frame.find(".gmg_chat_content").stop().animate({scrollTop:a.chat_frame.find(".gmg_chat_content")[0].scrollHeight},"slow")};SecondScreen.prototype.finish_prechat=function(){var b=SecondScreenUtils.$;var a=this;a.prechat_enabled=false;if(a.agent_present){a.chat_frame.find(".gmg_chat_online").show();a.chat_frame.find(".gmg_prechat_online").hide();if(a.chat_shown){b("iframe.gmg_chat").css("height",a.chat_frame.css("height"))}}SecondScreen._write_sess_data("__ss_prechat","1")};var _ss_track=_ss_track||{};_ss_track.id=_taq.id;if(_ss_track.api){_ss_track.events=_ss_track.api}else{_ss_track.events=_ss_track.events||[]}_ss_track.handlers=_ss_track.handlers||[];_ss_track.options=_ss_track.options||{};_ss_track.options.pre_greet="Please provide your details.";_ss_track.options.online_title="Chat with us!";_ss_track.options.online_greet="Enter your message and one of our agents will attend to you right away.";_ss_track.options.offline_title="Leave us a message!";_ss_track.options.offline_greet="We are now offline. Please leave a message and we will get back to you.";_ss_track.options.unavail_title="We are offline";_ss_track.options.unavail_greet="Live chat is now offline. Please check back later when we are online and our support team will be happy to assist you.";_ss_track.options.msg_hint="Type your message and press ENTER";_ss_track.options.title_color="#3C3B37";_ss_track.options.title_text_color="#fff";_ss_track.options.chat_pos=0;_ss_track.options.chat_pos_off=3;_ss_track.options.chat_close=false;_ss_track.options.mask_fields="";_ss_track.options.vdataprops=[];_ss_track.options.vis_dflt_show=true;_ss_track.options.chat_css="";_ss_track.options.chat_size=0;_ss_track.options.img_enable=false;_ss_track.options.chat_no_min=_ss_track.options.chat_no_min||false;_ss_track.options.audio_video=0;_ss_track.options.file_transfer=false;_ss_track.options.peerjs_svr="127.0.0.1:9000";_ss_track.options.busy_msg="All our agents are busy. Please wait and one of our agents will attend to you shortly.";_ss_track.options.dflt_ag_nm="Agent";_ss_track.options.chat_css_url="";_ss_track.options.hide_on_min=false;if(document.getElementById("__ta")){var l=document.createElement("a");l.href=document.getElementById("__ta").src;if(l.host==""){l.href=l.href}_ss_track.FE_SERVER=l.host;_ss_track.GMG_SERVER=_ss_track.GMG_SERVER||"www.gsecondscreen.com";_ss_track.VI_SERVER="ae.gsecondscreen.com";if(l.host.search("gamooga.com")==-1&&l.host.search("cloudfront.net")==-1&&l.host.search("gsecondscreen.com")==-1){_ss_track.DEV=true;_ss_track.GMG_SERVER=_ss_track.FE_SERVER;_ss_track.VI_SERVER=_ss_track.FE_SERVER}}WEB_SOCKET_SWF_LOCATION="//"+_ss_track.FE_SERVER+"/static/js/WebSocketMainInsecure.swf";_ss_track.ajax_conf=function(){return SecondScreenUtils.$.ajax({type:"GET",url:"//"+_ss_track.FE_SERVER+"/conf/"+_ss_track.id+"/",dataType:"jsonp",jsonpCallback:"_ss_on_ajax_conf"})};_ss_track.init=function(p,b,f,r,s,a,h,o,t,c,k){var j=SecondScreenUtils.$;SecondScreen._read_sess_data=s;SecondScreen._write_sess_data=a;SecondScreen._del_sess_data=h;SecondScreen._read_local_data=o;SecondScreen._write_local_data=t;SecondScreen._del_local_data=c;var g=function(w){var x=w[0];if(typeof _ss_track.options.disable_chat=="undefined"&&typeof _ss_track.options.chat_show=="undefined"){if(x.settings["dcw"]){_ss_track.options.disable_chat=x.settings["dcw"];if(x.settings["eca"]){_ss_track.options.enable_chat_by_agent=x.settings["eca"]}}if(x.settings["ep"]){_ss_track.options.enable_prechat=true}if(x.settings["dom"]){_ss_track.options.disable_offline_message=x.settings["dom"];if(x.settings["enoffun"]){_ss_track.options.enable_unavail_greet=x.settings["enoffun"]}}var y=function(C){return j("<div/>").text(C).html()};_ss_track.options.pre_greet=y(x.settings["prgrt"]);_ss_track.options.online_title=y(x.settings["ontit"]);_ss_track.options.online_greet=y(x.settings["ongrt"]);_ss_track.options.offline_title=y(x.settings["offtit"]);_ss_track.options.offline_greet=y(x.settings["offgrt"]);_ss_track.options.msg_hint=y(x.settings["msghint"]);_ss_track.options.unavail_title=y(x.settings["offuntitle"]);_ss_track.options.unavail_greet=y(x.settings["offungreet"]);_ss_track.options.chat_pos=parseInt(x.settings["chps"]);_ss_track.options.chat_pos_off=parseInt(x.settings["chpsoff"]);_ss_track.options.chat_close=x.settings["cc"];_ss_track.options.mask_fields=x.settings["mskfl"];_ss_track.options.vdataprops=x.settings["vdp"];_ss_track.options.vis_dflt_show=x.settings["vds"];_ss_track.options.chat_css=x.settings["chcss"];_ss_track.options.chat_size=x.settings["chsize"];_ss_track.options.img_enable=x.settings["imen"];_ss_track.options.audio_video=x.settings["av"];_ss_track.options.file_transfer=x.settings["ft"];_ss_track.options.peerjs_svr=x.settings["pjs"];_ss_track.options.busy_msg=x.settings["bmsg"];_ss_track.options.dflt_ag_nm=x.settings["dfagn"];_ss_track.options.chat_css_url=x.settings["chcssurl"];_ss_track.options.hide_on_min=x.settings["hom"];_ss_track.options.chat_spill_to=x.settings["dept_spill_to"];var B=_ss_track.options.title_color=x.settings["titcl"];var A=parseInt(B.substr(1,2),16);var z=parseInt(B.substr(3,2),16);var u=parseInt(B.substr(5,2),16);var v=1-(0.299*A+0.587*z+0.114*u)/255;if(v<0.5){_ss_track.options.title_text_color="#000"}else{_ss_track.options.title_text_color="#fff"}}return x};var q=SecondScreen._read_local_data("vne");if(q){var d=JSON.parse(SecondScreenUtils.base64decode(q));_ss_track.options.visitor_name=d.name;_ss_track.options.visitor_email=d.email}else{_ss_track.options.visitor_name="";_ss_track.options.visitor_email=""}var n=g(r);if(window!=window.top){return}if(_ss_track.options.chat_pos>=2&&/(Android|webOS|iPhone|iPad|iPod|BlackBerry|Windows Phone)/g.test(navigator.userAgent)){_ss_track.options.chat_pos=0}_ss_track.api=new SecondScreen(p,b,f,_ss_track.id,n,_ss_track.events,_ss_track.handlers,k);var m=function(u,v){return function(){return v.apply(u,arguments)}};_ss_track.events={};_ss_track.handlers={};_ss_track.events.push=m(_ss_track.api,_ss_track.api.push_event);_ss_track.handlers.push=m(_ss_track.api,_ss_track.api.push_handler);if(window.location.hash.indexOf("chatpopup")!=-1){_ss_track.handlers.push(["connect",function(){_ss_track.api.live_chat_click()}])}};window.addEventListener("message",receiveMessage,false);function receiveMessage(b){var a=b.origin||b.originalEvent.origin;if(a.indexOf(_ss_track.GMG_SERVER)>-1){var c=JSON.parse(b.data);if("filename" in c){sendFilename(c.filename)}}}var _taq=_taq||{};(function(){_taq.fns=_taq.fns||{};var a={};_taq.init=function(b){setTimeout(function(){b(a)},0)};_taq.setCustomActionCallback=function(b){a.customActionCallback=b};_taq.setNotifShowHandler=function(b){a.preNotifBlockHook=b};a.id=_taq.id;a.convs={};a.is_ready=false;if(typeof _taq.handlers=="undefined"){a.handlers=[];_taq.handlers=a.handlers}else{a.handlers=_taq.handlers}_taq.is_mobile=(function(b){return(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(b)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(b.substr(0,4)))})(navigator.userAgent||navigator.vendor||window.opera);(function(d){if(typeof JSON=="undefined"||typeof localStorage=="undefined"||typeof sessionStorage=="undefined"){return}if(window!=window.top&&window.location.search!="?__gmg_force_embed"){return}if(document.getElementById("__ta")){var b=document.createElement("a");b.href=document.getElementById("__ta").src;if(b.host==""){b.href=b.href}a.FE_SERVER=b.host;a.BE_SERVER=a.BE_SERVER||"www.gsecondscreen.com";a.VI_SERVER="ae.gsecondscreen.com";if(b.host.search("gsecondscreen.com")==-1&&b.host.search("gamooga.com")==-1){a.DEV=true;a.BE_SERVER=a.FE_SERVER;a.VI_SERVER=a.FE_SERVER;_taq._int=a}else{a.DEV=false}}if(typeof jQuery==="undefined"||jQuery.fn.jquery!="1.7.2"){var c=document.createElement("SCRIPT");c.type="text/javascript";c.src="//"+a.FE_SERVER+"/static/jquery-noamd.min.js";if(c.readyState){c.onreadystatechange=function(){if(this.readyState=="complete"||this.readyState=="loaded"){this.onreadystatechange=null;_taq.$=$.noConflict(true);d(_taq.$)}}}else{c.onload=function(){_taq.$=$.noConflict(true);d(_taq.$)}}document.getElementsByTagName("HEAD")[0].appendChild(c)}else{_taq.$=jQuery;d(jQuery)}})(function(d){function b(f){return(document.cookie.match("(^|; )"+f+"=([^;]*)")||0)[2]}if(typeof Prototype!=="undefined"&&Prototype.Version.substr(0,3)=="1.6"){var c=JSON.stringify;JSON.stringify=function(h){var f=Array.prototype.toJSON;delete Array.prototype.toJSON;var g=c(h);Array.prototype.toJSON=f;return g}}if(window.XDomainRequest){d.ajaxTransport(function(g){if(g.crossDomain&&g.async){if(g.timeout){g.xdrTimeout=g.timeout;delete g.timeout}var f;return{send:function(j,h){function k(m,p,o,n){f.onload=f.onerror=f.ontimeout=d.noop;f=undefined;h(m,p,o,n)}f=new XDomainRequest();f.onload=function(){k(200,"OK",{text:f.responseText},"Content-Type: "+f.contentType)};f.onerror=function(){k(404,"Not Found")};f.onprogress=d.noop;f.ontimeout=function(){k(0,"timeout")};f.timeout=g.xdrTimeout||Number.MAX_VALUE;f.open(g.type,g.url);f.send((g.hasContent&&g.data)||null)},abort:function(){if(f){f.onerror=d.noop;f.abort()}}}}})}if(a.DEV){a.xds=new _taq.libs.xds("http://"+a.BE_SERVER+"/static/xds-serve.html")}else{a.xds=new _taq.libs.xds("https://xds.gsecondscreen.com/xds2/")}d.when((function(){var f=d.Deferred();a.xds.getLSPrefixItems(a.id,function(g){a.local_store=g;a.setLSItem=function(j,h){a.local_store[a.id+":"+j]=h;a.xds.setLSItem(a.id+":"+j,h)};_taq.setLSItem=a.setLSItem;a.getLSItem=function(h){return a.local_store[a.id+":"+h]};_taq.getLSItem=a.getLSItem;a.removeLSItem=function(h){delete a.local_store[a.id+":"+h];a.xds.removeLSItem(a.id+":"+h)};_taq.removeLSItem=a.removeLSItem;f.resolve()});return f})(),(function(){var f=d.Deferred();a.xds.getSSPrefixItems(a.id,function(g){a.sess_store=g;a.setSSItem=function(j,h){a.sess_store[a.id+":"+j]=h;a.xds.setSSItem(a.id+":"+j,h)};_taq.setSSItem=a.setSSItem;a.getSSItem=function(h){return a.sess_store[a.id+":"+h]};_taq.getSSItem=a.getSSItem;a.removeSSItem=function(h){delete a.sess_store[a.id+":"+h];a.xds.removeSSItem(a.id+":"+h)};_taq.removeSSItem=a.removeSSItem;f.resolve()});return f})(),(function(){var g=function(k){if(typeof k==="number"){return k}k=k.replace(/^[^\d]*/,"").replace(/[^\d]*$/,"").replace(/[^\d\.]/g,"");var m=k.charAt(k.length-3);var j=k.charAt(k.length-2);var h=parseInt(k.replace(/[^\d]/g,""));if(m==","||m=="."){h=h/100}else{if(j==","||j=="."){h=h/10}}return h};var f=d.Deferred();d.ajax({type:"GET",url:"//"+a.FE_SERVER+"/newconf/"+a.id+"/",dataType:"jsonp",jsonpCallback:"_ta_on_conf",success:function(n){a.config=n;if(n.pst){_taq.webpush_set=n.pst}if(typeof n.custom_event_script!="undefined"){var m=document.createElement("script");m.type="text/javascript";m.text=n.custom_event_script;m.id="__ta_ces";var j=document.getElementsByTagName("script")[0];j.parentNode.insertBefore(m,j)}if(typeof n.evt!="undefined"){var p=function(B,D){var A={};var s=false;for(var u=0;u<B.kv.length;u++){var z=B.kv[u];var C=z[0];var r="???";if(z[1]=="1"){r=z[2]}else{if(z[1]=="5"){try{r=new Function("return ("+z[2]+")();")()}catch(y){s=true;break}}else{if(z[1]>="2"){var x;if(z[1]=="3"){var v=z[2].split("|");var w=d(D);for(var t=0;t<v[0]-0;t++){w=w.parent()}if(v[1]==""){x=d(w)}else{x=d(v[1],w)}}else{x=d(z[2])}if(x.length>0){if(x.prop("tagName")=="SELECT"){r=d("option:selected",x).text()}else{r=x.val()||x.text()}}else{s=true;break}}}}r=d.trim(r);if(r.length>102){r=r.substr(0,100)+"..."}if(z.length==4){if(z[3]=="n"){r=g(r)}else{if(z[3]=="b"){var q=r.toLowerCase();if(q=="false"||q=="no"||q=="0"){r=false}else{r=true}}}}A[C]=r}if(!s){_taq.events.push([B.n,A,B.t])}};var k=function(q,r){(function(){var t=q;var s=r;if(typeof t.p!="undefined"){setTimeout(function(){if(d(t.p).filter(":visible").length>0){p(t,s)}},t.wt*1000)}else{p(t,s)}})()};for(var o=0;o<n.evt.length;o++){var h=n.evt[o];(function(){var r=h;var q=window.location.pathname+window.location.search+window.location.hash;if((r.ut==1&&q==r.u)||(r.ut==2&&q.indexOf(r.u)==0)||(r.ut==3&&q.indexOf(r.u)!=-1)||(r.ut==5&&q.indexOf(r.u)==-1)||(r.ut==4&&new RegExp(r.u).test(q))){if(r.w==1){d(document).ready(function(){k(r)})}else{if(r.w>=2&&r.w<=5){d(document).on("mousedown.__ta_ec",r.c,function(){k(r,this)})}else{if(r.w==6){d(document).ready(function(){setTimeout(function(){k(r)},parseInt(r.c)*1000)})}else{if(r.w==7){d(document).ready(function(){var v=parseInt(r.c)*1000;var t=new Date().getTime()+v;var u=function(w){setTimeout(function(){var x=new Date().getTime()-t;if(x>=0){k(r)}else{u(-x)}},w)};var s=function(){t=new Date().getTime()+v};d(document).on("mousedown.__ta_ec keydown.__ta_ec",s);u(v)})}}}}}})()}}f.resolve()}});return f})()).done(function(){if(typeof a.getLSItem("vid")=="undefined"){var f=a.DEV?"_ssd_v":"_ss_v";var g=b(f)||"";if(g!=""){var h=g.split("|")[0];a.setLSItem("vid",h)}}a.newvisitor=(typeof a.getLSItem("vid")=="undefined");d.when((function(){var j=d.Deferred();a.EV_SERVER=a.config.evbk;if(typeof a.getLSItem("vid")=="undefined"||a.getLSItem("vid")=="pKQDA7RSJZ6xsvjh"||a.getLSItem("vid")=="DOWBA7Ym87eZ11mT"||(a.getLSItem("vid")=="zazYBXoeNPeslF3i"&&a.id=="96148074-8fb3-4e8c-94a0-13f2012c5623")){a.newvisitor=true;d.ajax({type:"GET",url:"//"+a.EV_SERVER+"/nv/",dataType:"jsonp",jsonpCallback:"_ta_on_nv",success:function(k){a.setLSItem("vid",k);_taq.vid=k;localStorage.setItem("_gmg_vid",k);a.vid=k;j.resolve()}})}else{a.newvisitor=false;a.vid=a.getLSItem("vid");_taq.vid=a.vid;localStorage.setItem("_gmg_vid",_taq.vid);j.resolve()}return j})(),(function(){var m=d.Deferred();var n;var o;var p=false;if(typeof a.getLSItem("sid")!="undefined"){var k=a.getLSItem("sid");var j=JSON.parse(k);n=j.sid;o=j.to;if(o<new Date().getTime()){p=true}}else{p=true}if(p){n=parseInt(new Date().getTime()+""+parseInt(Math.random()*10000)).toString(36)}o=new Date().getTime()+1800*1000;var k=JSON.stringify({sid:n,to:o});a.setLSItem("sid",k);_taq.sid=n;a.sid=n;a.newsessid=p;if(p){d.ajax({type:"GET",url:"//"+a.VI_SERVER+"/vi/",dataType:"jsonp",jsonpCallback:"_ss_on_ajax_vi",success:function(s){var r="";if(document.referrer){try{r=document.referrer.match(/:\/\/(.+)/)[1]}catch(w){r="(none)"}}else{r="(none)"}var v={location:s.location,IP:s.IP,browser:s.browser,OS:s.OS,referrer:r,repeat:!a.newvisitor};v.domain=location.host;var t=s.browser.split(" ");t.splice(t.length-1,1);var y=t.join(" ")||s.browser;var q=s.OS.split(" ");q.splice(q.length-1,1);var u=q.join(" ")||s.OS;v["base OS"]=u;v["base browser"]=y;v.country=s.location.split(", ")[1];var z=function(A){A=A.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var C=new RegExp("[\\?&]"+A+"=([^&#]*)"),B=C.exec(location.search);return B==null?"":decodeURIComponent(B[1].replace(/\+/g," "))};var x=function(A){var B=b("__utmz");if(B){var C=(function(){var F=B.split(".").slice(4).join(".").split("|");var G={};for(var E=0;E<F.length;E++){var D=F[E].split("=");G[D[0]]=D[1]}return G})();return C[A]}else{return null}};v["utm campaign"]=z("utm_campaign")||"(none)";v["utm medium"]=z("utm_medium")||"direct / organic";v["utm source"]=z("utm_source")||"(none)";v["utm term"]=z("utm_term")||"(none)";v.from_mobile=_taq.is_mobile;a.setLSItem("sess_data",JSON.stringify(v));_taq.events.push(["started session",v]);if("serviceWorker" in navigator&&"PushManager" in window){if(Notification.permission==="granted"){navigator.serviceWorker.ready.then(function(A){A.pushManager.getSubscription().then(function(E){if(E){var B=a.getLSItem("_push_regid");var D=a.getLSItem("last_push_regid");if(B){a.removeLSItem("_push_regid")}if(D){var C;if(E.endpoint.indexOf("push.services.mozilla.com")!=-1){var F=E.getKey("p256dh");C=btoa(String.fromCharCode.apply(null,new Uint8Array(F)))}else{C=E.toJSON().keys.auth}var G=D.substr(0,16);if(D.indexOf(C)===-1||G!==a.getLSItem("vid")){_taq.do_webpush_registration()}}else{_taq.do_webpush_registration()}}else{_taq.do_webpush_registration()}})})}}m.resolve()}})}else{m.resolve()}return m})(),(function(){if(typeof _ss_track!="undefined"&&typeof _ss_track.ajax_conf!="undefined"){SecondScreenUtils.$=_taq.$;return _ss_track.ajax_conf()}else{var j=d.Deferred();j.resolve();return j}})()).done(function(y,u,x){if(a.config.bvids.join(",").indexOf(a.vid)!=-1){return}try{if(typeof a.getLSItem("sess_data")!="undefined"){if(a.config.bips.join(",").indexOf(JSON.parse(a.getLSItem("sess_data"))["IP"])!=-1){return}}}catch(s){}var j;if(typeof a.getSSItem("tid")!="undefined"&&window.opener==null){j=a.getSSItem("tid")}else{j=parseInt(Math.random()*10000).toString(36);a.setSSItem("tid",j);if(typeof _ss_track!="undefined"&&typeof _ss_track.events!="undefined"&&a.id!="f1b1c3ef-7239-49c1-a695-55b29f5003a5"){_ss_track.events.push(["started session",JSON.parse(a.getLSItem("sess_data")),-1])}}_taq.tid=j;a.tid=j;if(window.location.hash.indexOf("#__taq_debug=")==0||a.getLSItem("debug")){_taq.debug=true;a.setLSItem("debug",1)}if(window.location.hash.indexOf("#__ss_notif_view=")==0){(function(){var A=JSON.parse(decodeURIComponent(window.location.hash.split("=")[1]));setTimeout(function(){a.notifications.show(null,null,A)},0)})()}if(window.location.hash.indexOf("#__ss_event_conf=")==0){var k=parseInt(window.location.hash.split("=")[1]);a.setSSItem("event_conf",k);window.location.href=window.location.href.split("#")[0];return}if(typeof a.getSSItem("event_conf")!="undefined"){(function(){var B=document.createElement("script");B.type="text/javascript";B.async=true;B.id="__taevcf";B.src="//"+a.BE_SERVER+"/static/sseventconf.min.js";var A=document.getElementsByTagName("script")[0];A.parentNode.insertBefore(B,A)})();_ss_track={};_ss_track.DEV=a.DEV;_ss_track.event_conf=a.config.evt;_ss_track.GMG_SERVER=a.BE_SERVER;SecondScreenUtils={};SecondScreenUtils.$=_taq.$;SecondScreen={};SecondScreen._read_sess_data=function(A){return a.getSSItem(A)};SecondScreen._write_sess_data=function(B,A){a.setSSItem(B,A)};return}if(typeof _ss_track!="undefined"&&typeof _ss_track.init!="undefined"){_ss_track.init(a.vid,a.sid,a.tid,x,a.getSSItem,a.setSSItem,a.removeSSItem,a.getLSItem,a.setLSItem,a.removeLSItem,a.convs)}var q=function(C){for(var B=0;B<C.length;B++){for(var A=0;A<C[B]["a"].length;A++){a.actions.process(C[B]["t"],C[B]["a"][A],C[B]["d"])}}};a.get_data_task=function(){if(typeof WebSocket!="undefined"&&a.EV_SERVER.indexOf("evbk6")==-1){var B=window.location.protocol==="https:"?"wss":"ws";a.get_data_ws=new WebSocket(B+"://"+a.EV_SERVER+"/pm/?c="+encodeURIComponent(a.id)+"&v="+encodeURIComponent(a.vid)+"&s="+encodeURIComponent(a.sid)+"&t="+encodeURIComponent(a.tid)+"&z="+(new Date().getTime())+""+parseInt(Math.random()*10000));a.get_data_ws.onmessage=function(C){if(C.data){q(JSON.parse(C.data))}};a.get_data_ws.onclose=function(C){if(_taq.debug){console.log("Websocket closed with event",C)}if(C.code===1000||C.code===1005){setTimeout(a.get_data_task,100)}else{setTimeout(a.get_data_task,10000)}};a.get_data_ws.onerror=function(C){if(_taq.debug){console.log("Websocket failed with error",C)}};var A=setInterval(function(){if(_taq.debug){console.log("Current state of websocket",a.get_data_ws.readyState)}},250);setTimeout(function(){clearInterval(A)},4000)}else{a.get_data_xhr=d.ajax({type:"GET",url:"//"+a.EV_SERVER+"/pm/?c="+encodeURIComponent(a.id)+"&v="+encodeURIComponent(a.vid)+"&s="+encodeURIComponent(a.sid)+"&t="+encodeURIComponent(a.tid)+"&z="+(new Date().getTime())+""+parseInt(Math.random()*10000),async:true,cache:false,success:function(C){var D=C;if(D){q(D);setTimeout(a.get_data_task,100)}else{setTimeout(a.get_data_task,1000)}},error:function(C,E,D){if(E==="abort"){setTimeout(a.get_data_task,100)}else{setTimeout(a.get_data_task,10000)}}})}};a.get_data_task();a.onevent={};a.onready=[];var n=a.handlers;a.handlers={};a.handlers.push=function(A){if(A[0]=="event"){a.onevent[A[1]]=A[2]}else{if(A[0]=="ready"){if(a.is_ready){setTimeout(A[1],0)}else{a.onready.push(A[1])}}}};_taq.handlers=a.handlers;for(var p=0;p<n.length;p++){a.handlers.push(n[p])}a.events={push:function(C){if(typeof(_taq._DONT_PUSH_EVENTS_)!="undefined"&&_taq._DONT_PUSH_EVENTS_==true){return}if(typeof a.onevent[C[0]]!="undefined"){C=a.onevent[C[0]](C);if(!C){return}}var B="";if(_taq.debug){B=parseInt(Math.random()*10000);console.log("%c Gamooga %cevent "+B+" %c "+C[0]+" %c "+JSON.stringify(C[1]),"color:#ff3333","color:blue","background:#ff3333;color:white","");B="&rid="+B}var A=new Image(1,1);var E="//"+a.EV_SERVER+"/mev/?c="+encodeURIComponent(a.id)+"&v="+encodeURIComponent(a.vid)+"&s="+encodeURIComponent(a.sid)+"&t="+encodeURIComponent(a.tid)+"&z="+(new Date().getTime())+""+parseInt(Math.random()*10000);var D=window.btoa(unescape(encodeURIComponent(JSON.stringify(C))));D=D.replace(/\+/g,"-").replace(/\//g,"_");E+="&data="+D+B;A.src=E;if(typeof _ss_track!="undefined"&&typeof _ss_track.events!="undefined"&&(C[0]=="started session"||a.config.dashevs.length==0||a.config.dashevs.indexOf(C[0])!=-1)){_ss_track.events.push(C)}}};var z=_taq.events instanceof Array?_taq.events:[];_taq.events=a.events;var w=-1;var o=-1;for(var p=0;p<z.length;p++){if(z[p][0]=="started session"){w=p}else{if(z[p][0]=="visited page"){o=p}}}if(w!=-1){_taq.events.push(z[w])}if(o!=-1){_taq.events.push(z[o])}for(var p=0;p<z.length;p++){if(p!=w&&p!=o){_taq.events.push(z[p])}}_taq.registerPinCode=function(D,C){navigator.permissions.query({name:"geolocation"}).then(function(E){if(E.state==="granted"){navigator.geolocation.getCurrentPosition(A)}else{if(E.state==="prompt"){navigator.geolocation.getCurrentPosition(A,B,{enableHighAccuracy:true})}else{B()}}});function A(E){var F=0;if(window.location.protocol==="https:"){F=776}else{F=15000}d.ajax({type:"GET",url:"//"+a.EV_SERVER+":"+F+"/gamooga-esp/get_pincode/?c="+encodeURIComponent(a.id)+"&latitude="+encodeURIComponent(E.coords.latitude)+"&longitude="+encodeURIComponent(E.coords.longitude),async:true,cache:false,success:function(G){if(Object.keys(G).length!==0){for(var H in G){C[H]=G[H]}C.location_enabled=true;_taq.events.push([D,C])}else{C.location_enabled=false;_taq.events.push([D,C])}},error:function(G){C.location_enabled=false;_taq.events.push([D,C])}})}function B(){C.location_enabled=false;_taq.events.push([D,C])}};a.property={push:function(E){var C=new Image(1,1);var F="//"+a.EV_SERVER+"/vpr/?c="+encodeURIComponent(a.id)+"&v="+encodeURIComponent(a.vid)+"&s="+encodeURIComponent(a.sid)+"&t="+encodeURIComponent(a.tid)+"&z="+(new Date().getTime())+""+parseInt(Math.random()*10000);if(E instanceof Array){var D="";var G=E[0];var A=E[1];var B=typeof(A);if(B=="number"){tp="n"}else{if(B=="boolean"){tp="b"}else{if(typeof A=="undefined"||A==""||A==null){tp="u"}else{tp="s"}}}if(_taq.debug){D=parseInt(Math.random()*10000);console.log("%c Gamooga %cvisitor property "+D+" %c "+G+" %c "+JSON.stringify(A),"color:#ff3333","color:blue","background:#ff3333;color:white","");D="&rid="+D}F+="&p="+encodeURIComponent(G)+"&vl="+encodeURIComponent(A)+"&tp="+tp+D}else{var D="";if(_taq.debug){D=parseInt(Math.random()*10000)}Object.keys(E).forEach(function(J){if(E.hasOwnProperty(J)){var H=E[J];var I=typeof(H);if(I=="number"){tp="n"}else{if(I=="boolean"){tp="b"}else{if(typeof H=="undefined"||H==""||H==null){tp="u"}else{tp="s"}}}if(_taq.debug){console.log("%c Gamooga %cvisitor property "+D+" %c "+J+" %c "+JSON.stringify(H),"color:#ff3333","color:blue","background:#ff3333;color:white","")}F+="&p="+encodeURIComponent(J)+"&vl="+encodeURIComponent(H)+"&tp="+tp}});if(_taq.debug){D="&rid="+D}F+=D}C.src=F}};var v=[];if(typeof _taq.property!="undefined"){v=_taq.property}_taq.property=a.property;for(var p=0;p<v.length;p++){_taq.property.push(v[p])}a.identify={push:function(B){var D="";var A;if(typeof(B)=="string"){D="&u="+encodeURIComponent(B);A=null}else{if(typeof(B[0])=="string"){D="&u="+encodeURIComponent(B[0])}else{for(var C=0;C<B[0].length;C++){D+="&u="+encodeURIComponent(B[0][C])}}A=B[1]}var E=1;if(!a.getLSItem("dvid")){E=0}d.ajax({type:"GET",url:"//"+a.EV_SERVER+"/id/?c="+encodeURIComponent(a.id)+"&v="+encodeURIComponent(a.vid)+"&p="+E+D+"&z="+(new Date().getTime())+""+parseInt(Math.random()*10000),async:true,cache:false,success:function(F){if(F.result=="success"){var H=F.vid;a.setLSItem("dvid",a.vid);a.setLSItem("vid",H);var G=_taq.vid;_taq.vid=H;a.vid=H;if(G!=H){if(a.get_data_xhr){a.get_data_xhr.abort()}else{if(a.get_data_ws){a.get_data_ws.close()}}}if(A){setTimeout(A,0)}}},error:function(F,H,G){setTimeout(function(){a.identify.push(D)},10000)}})}};var t=[];if(typeof _taq.identify!="undefined"){t=_taq.identify}_taq.identify=a.identify;for(var p=0;p<t.length;p++){_taq.identify.push(t[p])}var m="(none)";var r={};if(typeof a.getLSItem("sess_data")!="undefined"){r=JSON.parse(a.getLSItem("sess_data"))}try{m=document.referrer.match(/:\/\/[^\/]+(.+)/)[1]}catch(s){m="(none)"}if(a.id!="7357fe2f-816e-41e4-b5b9-e5a1ab6da323"){if(a.id=="f7ca3cdc-108f-498a-8b89-3097ef91fcd2"||a.id=="7be7d6a8-f0c2-444a-87e9-5010f121ee4e"||a.id=="3502ff1e-371e-4f30-b3b3-b690e5c5710e"||a.id=="fd15aa02-6922-41d1-b46d-250ad8e35d31"||a.id=="fc0f4120-f635-4120-a30f-cdeaaa40593c"||a.id=="4bf13e52-1dac-4651-9ead-774bca37cea2"||a.id=="dee8ce7e-747a-4b21-a97a-40fda1ae2007"){if(a.id=="7be7d6a8-f0c2-444a-87e9-5010f121ee4e"&&a.newsessid){setTimeout(function(){_taq.events.push(["visited page",{title:document.title,url:location.href.replace(/^.*\/\/[^\/]+/,""),from_page:m,domain:location.host,from_mobile:_taq.is_mobile,base_OS:r["base OS"],base_browser:r["base browser"],IP:r.IP,location:r.location}])},1000)}else{setTimeout(function(){_taq.events.push(["visited page",{title:document.title,url:location.href.replace(/^.*\/\/[^\/]+/,""),from_page:m,domain:location.host,from_mobile:_taq.is_mobile,base_OS:r["base OS"],base_browser:r["base browser"],IP:r.IP,location:r.location}])},300)}}else{if(a.id=="5be773f5-7851-4baf-9b97-837b3de59c12"){_taq.events.push(["visited page",{title:document.title,url:location.href.replace(/^.*\/\/[^\/]+/,""),from_page:m,from_mobile:_taq.is_mobile,base_OS:r["base OS"],base_browser:r["base browser"],IP:r.IP,location:r.location}])}else{_taq.events.push(["visited page",{title:document.title,url:location.href.replace(/^.*\/\/[^\/]+/,""),from_page:m,from_mobile:_taq.is_mobile,base_OS:r["base OS"],base_browser:r["base browser"],IP:r.IP,location:r.location}])}}}a.convs.chat_start_atic=function(C){var A=new Image(1,1);var B="//"+a.EV_SERVER+"/ev/?e="+encodeURIComponent("^chat start - "+C)+"&c="+encodeURIComponent(a.id)+"&v="+encodeURIComponent(a.vid)+"&s="+encodeURIComponent(a.sid)+"&t="+encodeURIComponent(a.tid)+"&z="+(new Date().getTime())+""+parseInt(Math.random()*10000)+"&ky=-&vl=-&tp=s";A.src=B};a.convs.pro_chat_atic=function(C){var A=new Image(1,1);var B="//"+a.EV_SERVER+"/ev/?e="+encodeURIComponent("^proactive chat - "+C)+"&c="+encodeURIComponent(a.id)+"&v="+encodeURIComponent(a.vid)+"&s="+encodeURIComponent(a.sid)+"&t="+encodeURIComponent(a.tid)+"&z="+(new Date().getTime())+""+parseInt(Math.random()*10000)+"&ky=-&vl=-&tp=s";A.src=B};a.convs.agent_alert_atic=function(C){var A=new Image(1,1);var B="//"+a.EV_SERVER+"/ev/?e="+encodeURIComponent("^agent alert - "+C)+"&c="+encodeURIComponent(a.id)+"&v="+encodeURIComponent(a.vid)+"&s="+encodeURIComponent(a.sid)+"&t="+encodeURIComponent(a.tid)+"&z="+(new Date().getTime())+""+parseInt(Math.random()*10000)+"&ky=-&vl=-&tp=s";A.src=B};a.actions={};a.actions.process=function(G,A,D){var I=null;if(A.r=="message_visitor"){var B=A.args["msg"];var C=A.args["name"];var H=A.args["dept"];(function(){var J=C;var L=B;var K=H;var M=G;I=function(){if(typeof _ss_track!="undefined"){_ss_track.api.act_task(["prochat_msg",J,L,K,M])}}})()}else{if(A.r=="alert_agent"){var E=A.args["reason"];var F=A.args["desc"];var H=A.args["dept"];(function(){var J=E;var L=F;var K=H;var M=G;I=function(){if(typeof _ss_track!="undefined"){_ss_track.api.act_task(["agent_alert",J,L,K,M])}}})()}else{if(A.r=="show_notif"){(function(){var L=G;var K=A.args["notif"];var J=A.args["nid"];I=function(N){var M=false;if(a.preNotifBlockHook){M=a.preNotifBlockHook(L,J,K,N)}if(navigator.userAgent&&/(nykaa-android|nykaa-ios)/ig.test(navigator.userAgent)){}else{if(!M){a.notifications.show(L,J,K,N)}}}})()}else{if(A.r=="show_visitor"){var H=A.args["dept"];(function(){var J=H;I=function(){if(typeof _ss_track!="undefined"){_ss_track.api.act_task(["show_visitor",J])}}})()}else{if(A.r=="assign_dept"){var H=A.args["dept"];(function(){var J=H;I=function(){if(typeof _ss_track!="undefined"){_ss_track.api.act_task(["assign_dept",J])}}})()}else{if(A.r=="custom_action"){if(_taq.debug){console.log("GAMOOGA: Received custom action",A.args)}if(a.customActionCallback){a.customActionCallback(A.args["name"],A.args["ca_data"])}}}}}}}if(I){if(D.r==2){(function(){var K=D.args["opg"]*1000;var J=I;setTimeout(function(){J()},K)})()}else{if(D.r==3){(function(){var J=new Date().getTime();var M=D.args["opgidl"]*1000;var K=I;var L=parseInt(Math.random()*10000);d(document).on("mousemove.__ta_ap_"+L+" mousedown.__ta_ip_"+L+" keydown.__ta_ip_"+L,function(){J=new Date().getTime()});var N=function(){var O=new Date().getTime();if(O-J>M){d(document).off("mousemove.__ta_ap_"+L+" mousedown.__ta_ip_"+L+" keydown.__ta_ip_"+L);K()}else{setTimeout(N,M-(O-J))}};N()})()}else{if(D.r==4){(function(){var J=I;var K=parseInt(Math.random()*10000);d("body").on("mouseleave._ta_lit_"+K,function(L){if(L.clientY<50){d("body").off("mouseleave._ta_lit_"+K);J()}})})()}else{if(D.r==5){(function(){var J=new Date().getTime();var N=J;var M=D.args["opgact"]*1000;var K=I;var L=parseInt(Math.random()*10000);d(document).on("mousemove.__ta_ap_"+L+" mousedown.__ta_ap_"+L+" keydown.__ta_ap_"+L,function(){var O=new Date().getTime();if(O-N>5000){J=O}N=O;if(N-J>=M){K();d(document).off("mousemove.__ta_ap_"+L+" mousedown.__ta_ap_"+L+" keydown.__ta_ap_"+L)}})})()}else{if(D.r==6){(function(){var K=I;var J=D.args["scrlto"];var L=parseInt(Math.random()*10000);d(window).on("scroll._ta_scrl_"+L,function(R){var N=d(window).height();var P=d(document).height();var Q=d(window).scrollTop();var M=P-N;var O=Math.floor(Q/M*100);if(O&&O>=J){d(window).off("scroll._ta_scrl_"+L);K()}})})()}else{I()}}}}}}};a.notifications={};a.notifications.atic_view=function(B,A){var C=new Image(1,1);var D="//"+a.EV_SERVER+"/ev/?e="+encodeURIComponent("^notif view - "+B)+"&c="+encodeURIComponent(a.id)+"&v="+encodeURIComponent(a.vid)+"&s="+encodeURIComponent(a.sid)+"&t="+encodeURIComponent(a.tid)+"&z="+(new Date().getTime())+""+parseInt(Math.random()*10000)+"&ky=notif&vl="+encodeURIComponent(A)+"&tp=s";C.src=D};a.notifications.atic_click=function(B,A){var C=new Image(1,1);var D="//"+a.EV_SERVER+"/ev/?e="+encodeURIComponent("^notif click - "+B)+"&c="+encodeURIComponent(a.id)+"&v="+encodeURIComponent(a.vid)+"&s="+encodeURIComponent(a.sid)+"&t="+encodeURIComponent(a.tid)+"&z="+(new Date().getTime())+""+parseInt(Math.random()*10000)+"&ky=notif&vl="+encodeURIComponent(A)+"&tp=s";C.src=D};a.notifications.atic_close=function(B,A){var C=new Image(1,1);var D="//"+a.EV_SERVER+"/ev/?e="+encodeURIComponent("^notif close - "+B)+"&c="+encodeURIComponent(a.id)+"&v="+encodeURIComponent(a.vid)+"&s="+encodeURIComponent(a.sid)+"&t="+encodeURIComponent(a.tid)+"&z="+(new Date().getTime())+""+parseInt(Math.random()*10000)+"&ky=notif&vl="+encodeURIComponent(A)+"&tp=s";C.src=D};a.notifications.on_click=function(C,B,A){if(C!==null){a.notifications.atic_click(C,B)}if(A){var D=d(A).attr("href");if(D){setTimeout(function(){window.location.href=D},300)}return false}else{return true}};_taq.fns.__notifclick=a.notifications.on_click;a.notifications.close=function(C,B,A){if(B){a.notifications.atic_close(B,A)}if(C==3){clearInterval(d("#__ta_notif_frame_"+C).data("updateint"))}d("#__ta_notif_frame_"+C).parent().remove();if(C==2){d("#__ta_notif_pad").remove()}};_taq.fns.__notifclose=_taq.fns.__notifclose||a.notifications.close;a.notifications._preload={};a.notifications.show=function(R,O,C,E){if(_taq.debug){console.log(Date.now(),"notif show start")}if(E){a.notifications._preload[O]="to_load"}else{if(a.notifications._preload[O]=="loaded"){var N=d("#__ta_notif_frame_"+C.nst);if(N&&N.css("visibility")=="hidden"){var W=N.height();if(C.nst==2&&C.pos=="1"){d("#__ta_notif_pad").height(W+2)}N.css("visibility","visible");if(C.nst==1){d(".gmg_notif_overlay").css("display","block")}a.notifications.atic_view(R,O)}else{console.log("ERROR: Preloaded notif not in DOM or is already visible.")}delete a.notifications._preload[O];return}else{if(a.notifications._preload[O]=="to_load"){a.notifications._preload[O]="should_show";return}}}if(C.nst==3){if(C.w!=""){d(C.jqid).css("width",C.w+"px")}if(C.h!=""){d(C.jqid).css("height",C.h+"px")}d(C.jqid).html(C.ctext);_taq.$(document).trigger(_taq.$.Event("gmg_inpage_render"));a.notifications.atic_view(R,O);(function(){d(C.jqid).click(function(){var ac=R;var ab=O;a.notifications.atic_click(ac,ab)})})()}else{if(C.nact==1){if(R){if(a.getSSItem("__ss_support")){return}if(typeof _ss_track!="undefined"&&typeof _ss_track.api!="undefined"){if(_ss_track.api.agent_present===false){return}if(_ss_track.api.agent_present===null){(function(){var ad=R;var ab=O;var ac=C;_ss_track.handlers.push(["connect",function(){a.notifications.show(ad,ab,ac,E)}])})();return}}}if(C.hpcs==true){C.lnk="javascript:parent._ss_track.api.live_chat_click(null,null,true);"}else{C.lnk="javascript:parent._ss_track.api.live_chat_click();"}}if(R!==null&&!E){if(_taq.debug){console.log(Date.now(),"notif view event fire")}setTimeout(function(){a.notifications.atic_view(R,O)},0)}var H=["","arial, helvetica, sans-serif",'"times new roman", serif','"arial black", sans-serif','"arial narrow", sans-serif','"courier new", monospace',"garamond, serif","georgia, serif","tahoma, sans-serif",'"trebuchet ms", sans-serif',"verdana, sans-serif"];var G=C.lnk;if(G!=""){if(G.substr(0,4)!="http"&&G.substr(0,11)!="javascript:"){G="http://"+G}}var F="<!DOCTYPE html><html><head><base target='_top'><style type='text/css'>* {padding:0;margin:0;} a {text-decoration:none;} ul,ol {margin-left:30px;padding-left:10px;} .gmgbutton {padding:5px 10px;display:inline;background:#777 url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAABkCAYAAABHLFpgAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAALdJREFUeNrEjkEWwiAQQyGlwOAN3Hv/m3UnA62vONF2p25lkfeTwAx+CuEWYgguxBgdYoo7YkwDOWeKDEjOO6TQStlRXlkRIylGl3JQYSaFJGxJIq9M2No9OYbuSOncYXuHWZN5Nglhcm6M4eDsfJDrt+Jv8vO7hyzL4rFtD8rmsPbu0bcOtEZq6tG0eVSKqlqhldao1grL2NY728qMhdozfbfqz3sc1dpBnYvMeqyrbet99U8BBgCRTXT4kGguQQAAAABJRU5ErkJggg==) repeat-x bottom;border: none;color:#fff;cursor:pointer;font-weight:bold;border-radius:3px;-moz-border-radius:3px;-webkit-border-radius:3px;} .gmgbutton:hover {background-position:0 center;} .gmgbutton:active {position: relative;top: 1px;}</style></head><body style='background-color:transparent;overflow:hidden;'>";var J=d("<div/>");if(C.io){J.append("<div class='close' style='color:#fff;cursor:pointer;font-size:13px;position:absolute;right:0;background:#000;border-bottom-left-radius:5px;padding:1px 3px' onclick='parent._taq.fns.__notifclose("+C.nst+',"'+R+'","'+O+"\")'>&#x2715;</div>")}else{J.append("<div class='close' style='color:"+C.tc+";cursor:pointer;font-size:13px;float:right;padding:1px 3px' onclick='parent._taq.fns.__notifclose("+C.nst+',"'+R+'","'+O+"\")'>&#x2715;</div>")}if(C.nst!=2&&!C.io&&C.ttl!=""){J.append("<div class='title' style='color:"+C.tc+";font-size:"+(C.ts||20)+"px;font-family:"+H[(C.tf||1)]+";padding:5px 10px;'>"+C.ttl+"</div>")}if(C.io){J.append("<div class='content' style='padding:0;'><img loading='eager' src='"+C.cimgurl+"' style='height:"+C.cimgh+"px;width:"+C.cimgw+'px;display:block\' onerror=\'this.src="/static/images/notif_image_error.png";this.onerror="";\'></div>')}else{var M=C.ctext;M=M.replace(/<script /g,"<dontremovescript ");M=M.replace(/<\/script>/g,"</dontremovescript>");J.append("<div class='content' style='color:"+C.cc+";font-size:"+(C.cs||13)+"px;font-family:"+H[(C.cf||1)]+";padding:5px 10px;'>"+M+"</div>")}if(C.cta!=""&&!C.io){if(G==""){G="javascript:void(0)"}var Q="'background-color:"+C.ctabc+";color:"+C.ctatc+";font-size:"+C.ctas+"px;font-family:"+H[C.ctaf]+";padding:5px 10px;margin:10px;display:inline-block;'";var X="";if(G.substr(0,11)=="javascript:"){var X="";J.append("<div class='cta'><a "+(C.ctac?"onmouseup='javascript:setTimeout(function() { parent._taq.fns.__notifclose("+C.nst+',"'+R+'","'+O+"\")},150)' ":"")+(R!==null?"onclick='javascript:return parent._taq.fns.__notifclick(\""+R+'","'+O+"\")' ":"")+"style="+Q+" class='gmgbutton' href='"+G+"'>"+C.cta+"</a></div>")}else{var Z=C.ltrg;if(Z=="1"){J.append("<div class='cta'><a "+(C.ctac?"onmouseup='javascript:setTimeout(function() { parent._taq.fns.__notifclose("+C.nst+',"'+R+'","'+O+"\")},150)' ":"")+(R!==null?"onclick='javascript:return parent._taq.fns.__notifclick(\""+R+'","'+O+"\",this)' ":"")+"style="+Q+" class='gmgbutton' href='"+G+"' target='_top'>"+C.cta+"</a></div>")}else{J.append("<div class='cta'><a "+(C.ctac?"onmouseup='javascript:setTimeout(function() { parent._taq.fns.__notifclose("+C.nst+',"'+R+'","'+O+"\")},150)' ":"")+(R!==null?"onclick='javascript:return parent._taq.fns.__notifclick(\""+R+'","'+O+"\")' ":"")+"style="+Q+" class='gmgbutton' href='"+G+"' target='_blank'>"+C.cta+"</a></div>")}}}if(!C.io){if(C.nst!=2){if(C.ctaa==2){J.find("div.cta").css("text-align","center")}else{if(C.ctaa==3){J.find("div.cta").css("text-align","right")}else{if(C.ctaa>=4){J.find("div.cta").detach().insertBefore(J.find("div.content"));if(C.ctaa==4){J.find("div.cta").css({"float":"left",margin:"8px 3px 0 0"})}else{if(C.ctaa==5){J.find("div.cta").css({"float":"right",margin:"8px 0 0 3px"})}else{if(C.ctaa==6){J.find("div.cta").css("text-align","center")}}}}}}}else{J.find("div.cta").css("display","inline-block")}}if(C.cta==""||C.io){if(G!=""){if(G.substr(0,11)=="javascript:"){J.wrapInner("<a "+(C.ctac?"onmouseup='javascript:setTimeout(function() { parent._taq.fns.__notifclose("+C.nst+',"'+R+'","'+O+"\")},150)' ":"")+(R!==null?"onclick='javascript:return parent._taq.fns.__notifclick(\""+R+'","'+O+"\")' ":"")+"href='"+G+"'></a>")}else{var Z=C.ltrg;if(Z=="1"){J.wrapInner("<a "+(C.ctac?"onmouseup='javascript:setTimeout(function() { parent._taq.fns.__notifclose("+C.nst+',"'+R+'","'+O+"\")},150)' ":"")+(R!==null?"onclick='javascript:return parent._taq.fns.__notifclick(\""+R+'","'+O+"\",this)' ":"")+"href='"+G+"' target='_top'></a>")}else{J.wrapInner("<a "+(C.ctac?"onmouseup='javascript:setTimeout(function() { parent._taq.fns.__notifclose("+C.nst+',"'+R+'","'+O+"\")},150)' ":"")+(R!==null?"onclick='javascript:return parent._taq.fns.__notifclick(\""+R+'","'+O+"\")' ":"")+"href='"+G+"' target='_blank'></a>")}}}else{J.wrapInner("<div "+(C.ctac?"onmouseup='javascript:setTimeout(function() { parent._taq.fns.__notifclose("+C.nst+',"'+R+'","'+O+"\")},150)' ":"")+(R!==null?"onclick='javascript:return parent._taq.fns.__notifclick(\""+R+'","'+O+"\")' ":"")+"></a>")}}if(C.nst==1||C.nst==3){J.find("div.close").css({"font-size":"15px"})}else{if(C.nst==2){J.find("div.close").css({padding:"2px 10px","font-size":"15px",color:C.cc});J.find("a.gmgbutton").css({display:"inline-block"});J.find("div.content").css({display:"inline-block"});J.find("div.title").css({display:"inline-block"});J.find("div.cta").css({display:"inline-block"});J.wrapInner("<div class='centerwrap' style='text-align:center'></div>")}}if(d("#__ta_notif_frame_"+C.nst).length!=0){if(C.nst==3){clearInterval(d("#__ta_notif_frame_"+C.nst).data("updateint"))}d("#__ta_notif_frame_"+C.nst).parent().remove();if(C.nst==2){d("#__ta_notif_pad").remove()}}var I="<div style='position:absolute;top:0;left:0'><iframe style='position:fixed;display:block;bottom:-3px;text-align:left;z-index:9999999999;border:0;background-color:#fff;overflow:hidden;border:1px solid #666;height:0;box-sizing:content-box' marginheight='0' marginwidth='0' frameborder='0' id='__ta_notif_frame_"+C.nst+"'></iframe>";var P=d(window).width();if(C.cimgw>=P){C.cimgw=(P*90)/100;J.find("div.close").css({position:"fixed",right:"0px"})}else{if(C.w>=P){C.w=(P*90)/100;J.find("div.close").css({position:"fixed",right:"0px"})}}d("body").append(I);var N=d("#__ta_notif_frame_"+C.nst);N.css("border-color",C.bc);N.css("background-color",C.bgc);if(typeof C.nst=="undefined"||C.nst==0){if(C.io){N.css("width",C.cimgw+"px")}else{N.css("width",C.w+"px")}if(typeof C.br=="undefined"||C.br==true){N.css({"-webkit-border-radius":"5px","-moz-border-radius":"5px","border-radius":"5px"})}if(typeof C.bs=="undefined"||C.bs==true){N.css({"box-shadow":"0 0 5px #999"})}if(C.pos=="1"){N.css("left","10px");N.css("right","auto")}else{if(C.pos=="2"){N.css("right","10px");N.css("left","auto")}}}else{if(C.nst==1){if(C.io){N.css("width",C.cimgw+"px")}else{N.css("width",C.w+"px")}N.css("border-width","1px");if(typeof C.br=="undefined"||C.br==true){N.css({"-webkit-border-radius":"5px","-moz-border-radius":"5px","border-radius":"5px"})}if(typeof C.bs=="undefined"||C.bs==true){N.css({"box-shadow":"0 0 5px #999"})}N.parent().prepend('<div style="position:fixed;top:0;right:0;height:100%;width:100%;background:#000;opacity:0.8;z-index:9999999998" class="gmg_notif_overlay">&nbsp;</div>');N.css({bottom:"auto",top:"50%",left:"50%",right:"auto","margin-top":"-100px"});if(!C.io){N.css({"margin-left":"-"+(C.w/2)+"px"})}else{N.css({"margin-left":"-"+(C.cimgw/2)+"px"})}}else{if(C.nst==2){N.css("width","100%");J.find(".gmgbutton").css("margin","4px");N.css({"border-left":"0","border-right":"0"});if(C.pos=="1"){N.css({bottom:"auto","border-bottom-width":"2px","border-top":"0",position:"fixed",top:"0"});d("body").prepend("<div id='__ta_notif_pad' style='position:static;height:0px;'></div>")}else{if(C.pos=="2"){N.css({"border-top-width":"2px","border-bottom":"0",position:"fixed",bottom:"0"})}}}else{if(C.nst==3){if(C.io){N.css("width",C.cimgw+"px")}else{N.css("width",C.w+"px")}N.css("border-width","1px");if(typeof C.br=="undefined"||C.br==true){N.css({"-webkit-border-radius":"5px","-moz-border-radius":"5px","border-radius":"5px"})}if(typeof C.bs=="undefined"||C.bs==true){N.css({"box-shadow":"0 0 5px #999"})}N.css({bottom:"auto"});var A=10;var K=10;var D=d(C.coe);if(D.length==0){if(console&&console.log){console.log("Element not found: "+C.coe)}return}var V=D.offset();var B,L,U,T;if(C.cop==1){B=V.left+D.outerWidth()/2+(C.col-0);L=V.top-10-K+(C.cot-0);if(C.io){U=B-C.cimgw/2}else{U=B-C.w/2}T=L;N.css({position:"absolute",top:T+"px",left:U+"px"});N.after('<div style="position:absolute;left:'+(B-A/2)+"px;top:"+(L-1)+"px;border-top:"+K+"px solid "+C.bgc+";border-left:"+(A/2)+"px solid transparent;border-right:"+(A/2)+'px solid transparent;height:0;width:0;z-index:99999999999;">&nbsp;</div>');var Y=2;var aa=1;N.after('<div style="position:absolute;left:'+(B-(A/2)-aa)+"px;top:"+(L-1)+"px;border-top:"+(K+Y)+"px solid "+C.bc+";border-left:"+(A/2+aa)+"px solid transparent;border-right:"+(A/2+aa)+'px solid transparent;height:0;width:0;z-index:99999999999;"></div>')}else{if(C.cop==2){B=V.left-A-10+(C.col-0);L=V.top+D.outerHeight()/2+(C.cot-0);if(C.io){U=B-2-C.cimgw}else{U=B-2-C.w}T=L;N.css({position:"absolute",top:T+"px",left:U+"px"});N.after('<div style="position:absolute;left:'+(B-1)+"px;top:"+(L-K/2)+"px;border-left:"+A+"px solid "+C.bgc+";border-bottom:"+(K/2)+"px solid transparent;border-top:"+(K/2)+'px solid transparent;height:0;width:0;z-index:99999999999;">&nbsp;</div>');var aa=2;var Y=1;N.after('<div style="position:absolute;left:'+(B-1)+"px;top:"+(L-K/2-Y)+"px;border-left:"+(A-0+aa)+"px solid "+C.bc+";border-bottom:"+(K/2+Y)+"px solid transparent;border-top:"+(K/2+Y)+'px solid transparent;height:0;width:0;z-index:99999999999;"></div>')}else{if(C.cop==3){B=V.left+D.outerWidth()+10+(C.col-0);L=V.top+D.outerHeight()/2+(C.cot-0);U=B+A;T=L;N.css({position:"absolute",top:T+"px",left:U+"px"});N.after('<div id="__ta_notif_arr1" style="position:absolute;left:'+(B+1)+"px;top:"+(L-K/2)+"px;border-right:"+A+"px solid "+C.bgc+";border-bottom:"+(K/2)+"px solid transparent;border-top:"+(K/2)+'px solid transparent;height:0;width:0;z-index:99999999999;">&nbsp;</div>');var aa=2;var Y=1;N.after('<div id="__ta_notif_arr2" style="position:absolute;left:'+(B+1-aa)+"px;top:"+(L-K/2-Y)+"px;border-right:"+(A-0+aa)+"px solid "+C.bc+";border-bottom:"+(K/2+Y)+"px solid transparent;border-top:"+(K/2+Y)+'px solid transparent;height:0;width:0;z-index:99999999999;"></div>');N.on("updatepos",function(){D=d(C.coe);if(D.length==0){return}V=D.offset();B=V.left+D.outerWidth()+10+(C.col-0);L=V.top+D.outerHeight()/2+(C.cot-0);U=B+A;T=L;T=L;N.css({position:"absolute",top:T+"px",left:U+"px"});d("#__ta_notif_arr1").css({left:(B+1)+"px",top:(L-K/2)+"px"});d("#__ta_notif_arr2").css({left:(B+1-aa)+"px",top:(L-K/2-Y)+"px"})})}else{if(C.cop==4){B=V.left+D.outerWidth()/2+(C.col-0);L=V.top+D.outerHeight()+10+(C.cot-0);if(C.io){U=B-C.cimgw/2}else{U=B-C.w/2}T=L+K;N.css({position:"absolute",top:T+"px",left:U+"px"});N.after('<div style="position:absolute;left:'+(B-A/2)+"px;top:"+(L+1)+"px;border-bottom:"+K+"px solid "+C.bgc+";border-left:"+(A/2)+"px solid transparent;border-right:"+(A/2)+'px solid transparent;height:0;width:0;z-index:99999999999;">&nbsp;</div>');var Y=2;var aa=1;N.after('<div style="position:absolute;left:'+(B-(A/2)-aa)+"px;top:"+(L+1-Y)+"px;border-bottom:"+(K+Y)+"px solid "+C.bc+";border-left:"+(A/2+aa)+"px solid transparent;border-right:"+(A/2+aa)+'px solid transparent;height:0;width:0;z-index:99999999999;"></div>')}}}}}}}}N.data("srchtml",F+J.html().replace(/<dontremovescript /g,"<script ").replace(/<\/dontremovescript>/g,"<\/script>")+"</body></html>");var S=function(){if(_taq.debug){console.log(Date.now(),"notif load")}for(var ae=0;ae<N.contents().find("img").length;ae++){var ac=N.contents().find("img")[ae];if(!ac.complete&&ac.naturalHeight==0){if(_taq.debug){console.log(Date.now(),"notif wait load")}setTimeout(S,250);return}}var ad=N.contents().find("body").height();var ab=d(window).height();if(ad>=ab){ad=(ab*90)/100;N.contents().find("body").css("overflow","scroll")}N.height(ad);if(C.nst==1){N.css("margin-top","-"+(ad/2)+"px")}else{if(C.nst==3){if(C.cop==1){N.css("margin-top","-"+(ad+2)+"px")}else{if(C.cop==2||C.cop==3){N.css("margin-top","-"+(ad/2)+"px")}else{if(C.cop==4){N.css("margin-top","0")}}}N.data("updateint",setInterval(function(){N.trigger("updatepos")},250))}}if(!E||a.notifications._preload[O]=="should_show"){if(C.nst==2&&C.pos=="1"){d("#__ta_notif_pad").height(ad+2)}N.css("visibility","visible");if(C.nst==1){d(".gmg_notif_overlay").css("display","block")}delete a.notifications._preload[O]}else{if(E){a.notifications._preload[O]="loaded"}}if(_taq.debug){console.log(Date.now(),"notif load done")}};N.css("visibility","hidden");if(d(".gmg_notif_overlay").length>0){d(".gmg_notif_overlay").css("display","none")}N.load(S);if(_taq.debug){console.log(Date.now(),"notif setting src")}N.get(0).src='javascript:parent._taq.$("#__ta_notif_frame_'+C.nst+'").data("srchtml")'}};if(typeof _taq._pre_act_arr_arr!="undefined"){for(var p=0;p<_taq._pre_act_arr_arr.length;p++){q(_taq._pre_act_arr_arr[p])}}if(typeof _taq._pre_atic_view!="undefined"){for(var p=0;p<_taq._pre_atic_view.length;p++){(function(){var C=_taq._pre_atic_view[p][0];var A=_taq._pre_atic_view[p][1];var B=_taq._pre_atic_view[p][2];a.notifications.atic_view(C,A);d(B).click(function(){a.notifications.atic_click(C,A)})})()}}setTimeout(function(){if(typeof _taq._pre_atic_click!="undefined"){for(var A=0;A<_taq._pre_atic_click.length;A++){a.notifications.atic_click(_taq._pre_atic_click[A][0],_taq._pre_atic_click[A][1])}}},1000);if(typeof _taq.pre_get_data_ws!="undefined"){_taq.pre_get_data_ws.close()}_taq.fns.__notifshow=a.notifications.show;for(var p=0;p<a.onready.length;p++){setTimeout(a.onready[p],0)}a.onready=[];a.is_ready=true})})})})();var _taq=_taq||{};var FCM_WPP_PREFIX="https://fcm.googleapis.com/wp/";var FCM_ENDPOINT_PREFIX="https://fcm.googleapis.com/fcm/send/";var GCM_ENDPOINT_PREFIX="https://android.googleapis.com/gcm/send/";_taq.init(function(r){var f=604800000;function c(){var v,w=navigator.userAgent,y=w.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[],x=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;return/trident/i.test(y[1])?(v=/\brv[ :]+(\d+)/g.exec(w)||[],{name:"IE",version:v[1]||""}):"Chrome"===y[1]&&(v=w.match(/\bOPR\/(\d+)/),null!=v)?{name:"Opera",version:v[1]}:(y=y[2]?[y[1],y[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(v=w.match(/version\/(\d+)/i))&&y.splice(1,1,v[1]),x&&(y[0]="iOS"),y[0]=y[0].toLowerCase(),{name:y[0],version:y[1]})}function t(w,z){var y=0,x=50,v=!1,A=window.setInterval(function(){w()&&(window.clearInterval(A),z(v)),y++>x&&(window.clearInterval(A),v=!0,z(v))},10)}function h(w){var x=w.toLowerCase();if(0===x.indexOf("msie")&&0===x.indexOf("trident")){return !1}var v=/(?:msie|rv:)\s?([\d\.]+)/.exec(x);return v&&parseInt(v[1],10)>=10?!0:!1}function j(w,y,v){y=y||0;v=v||w.byteLength;var x=new Uint8Array(w.slice(y,v));return btoa(String.fromCharCode.apply(null,x))}function k(w,x,v){return j(w,x,v).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function o(z){var x="=".repeat((4-z.length%4)%4);var v=(z+x).replace(/\-/g,"+").replace(/_/g,"/");var y=window.atob(v);var w=new Uint8Array(y.length);for(let i=0;i<y.length;++i){w[i]=y.charCodeAt(i)}return w}function g(v){if(v.startsWith(GCM_ENDPOINT_PREFIX)){return v.substr(GCM_ENDPOINT_PREFIX.length)}return v.substr(v.lastIndexOf("/")+1)}function p(){var A=window.chrome;var v=window.navigator;var z=v.vendor;var x=typeof window.opr!=="undefined";var y=v.userAgent.indexOf("Edge")>-1;var w=v.userAgent.match("CriOS");if(w){return true}else{if(A!==null&&typeof A!=="undefined"&&z==="Google Inc."&&x===false&&y===false){return true}else{return false}}}function q(y){var w;if(window.webkitRequestFileSystem){window.webkitRequestFileSystem(window.TEMPORARY,1,function(){w=!1},function(z){w=!0})}else{if(window.indexedDB&&/Firefox/.test(window.navigator.userAgent)){var v;try{v=window.indexedDB.open("___test")}catch(x){w=!0}"undefined"==typeof w&&t(function(){return"done"===v.readyState?!0:!1},function(z){z||(w=v.result?!1:!0)})}else{if(h(window.navigator.userAgent)){w=!1;try{window.indexedDB||(w=!0)}catch(x){w=!0}}else{if(window.localStorage&&/Safari/.test(window.navigator.userAgent)){try{window.localStorage.setItem("___test",1)}catch(x){w=!0}"undefined"==typeof w&&(w=!1,window.localStorage.removeItem("___test"))}}}}t(function(){return"undefined"!=typeof w?!0:!1},function(z){y(w)})}function b(){return(location.hostname.search("pushmessage.co")!=-1)||(r.DEV&&location.pathname.search("/webpush-register")==0)}function u(){if(b()){setTimeout(window.close,500)}}function d(y){var x=[y,{}];if(typeof r.onevent[y]!="undefined"){x=r.onevent[y](x);if(!x){return}}var w=new Image(1,1);var z="//"+r.EV_SERVER+"/ev/?e="+encodeURIComponent(y)+"&c="+encodeURIComponent(r.id)+"&v="+encodeURIComponent(r.vid)+"&s="+encodeURIComponent(r.sid)+"&t="+encodeURIComponent(r.tid)+"&z="+(new Date().getTime())+""+parseInt(Math.random()*10000)+"&ky=-&vl=-&tp=s";for(var v in x[1]){if(x[1].hasOwnProperty(v)){z+="&ky="+v+"&vl="+encodeURIComponent(x[1][v])+"&tp=s"}}w.src=z}function s(x){var v=x.endpoint;var w=g(v);if(v.startsWith(FCM_ENDPOINT_PREFIX)){return FCM_WPP_PREFIX+w}if(!v.startsWith(GCM_ENDPOINT_PREFIX)){return v}if(x.subscriptionId&&x.endpoint.indexOf(x.subscriptionId)===-1){v=x.endpoint+"/"+x.subscriptionId}return v}function m(D){let pushRegName="_push_regid";if(_taq.webpush_property_suffix){pushRegName=pushRegName+"_"+_taq.webpush_property_suffix}if(D.endpoint.indexOf("push.services.mozilla.com")!=-1){var C=D.endpoint;var A=D.getKey("p256dh");var x=btoa(String.fromCharCode.apply(null,new Uint8Array(A)));var B=C+"$"+x;if(_taq.property){_taq.property.push([pushRegName,"4:"+B]);r.setLSItem("last_push_regid",r.getLSItem("vid")+":4:"+B)}}else{var z=s(D);var y=z.split("/");var B=y[y.length-1];if(z.startsWith(FCM_WPP_PREFIX)){var A=D.getKey("p256dh");var x=k(A);var v=D.getKey("auth");var w=k(v);B=B+"$"+x+"$"+w;if(_taq.property){_taq.property.push([pushRegName,"5:"+B]);r.setLSItem("last_push_regid",r.getLSItem("vid")+":5:"+B)}}else{if(_taq.property){_taq.property.push([pushRegName,"3:"+B]);r.setLSItem("last_push_regid",r.getLSItem("vid")+":3:"+B)}}}d("^webpush allow");_taq.setLSItem("webpush_status","registered");u()}function n(v){d("^webpush show");Notification.requestPermission(function(){if(Notification.permission=="granted"){var w=r.config.pst;var y={userVisibleOnly:true};if(w&&w.pk_pub&&p()){var x=o(w.pk_pub);y.applicationServerKey=x}v.pushManager.subscribe(y).then(function(z){return m(z)},function(z){console.log(z);d("^webpush block");_taq.setLSItem("webpush_status","denied");u()});if(b()){setTimeout(function(){d("^webpush timeout");_taq.setLSItem("webpush_status","timeout");_taq.setLSItem("webpush_ask_again",(new Date().getTime()+f)+"");u()},4000)}}else{if(Notification.permission=="denied"){d("^webpush block");_taq.setLSItem("webpush_status","denied");u()}else{if(Notification.permission=="default"){d("^webpush close");u()}}}})}function a(v){if(!("showNotification" in ServiceWorkerRegistration.prototype)){return}if(Notification.permission==="denied"){return}if(!("PushManager" in window)){return}v.pushManager.getSubscription().then(function(w){if(!w){n(v);return}else{if(_taq.id=="fcbe3928-6512-48a6-8cb5-c8c51e100539"||_taq.id=="115e82c1-148b-4542-a3be-b628d92a03f9"){v.update()}}m(w)},function(w){console.log(w);u()})}_taq.do_webpush_registration=function(w){var y="/manifest.json";var x="/sw.js?cid="+_taq.id;var v="/";if(_taq.id=="107a3b41-1aa3-45c6-a324-f0399a2aa2af"){y="/gamooga/testing/manifest.json";x="/gamooga/testing/sw.js?cid="+_taq.id}if(_taq.webpush_set.murl){y=_taq.webpush_set.murl}if(_taq.webpush_set.swurl){x=_taq.webpush_set.swurl+"?cid="+_taq.id}if(_taq.webpush_set.sw_scp){v=_taq.webpush_set.sw_scp}if(w){y="/webpush-manifest-"+_taq.id+".json";x="/webpush-sw.js?cid="+_taq.id}if(_taq.$('link[rel="manifest"]').length==0){_taq.$("head").append('<link rel="manifest" href="'+y+'">')}if("serviceWorker" in navigator){if(_taq.id=="fcbe3928-6512-48a6-8cb5-c8c51e100539"||_taq.id=="115e82c1-148b-4542-a3be-b628d92a03f9"){navigator.serviceWorker.getRegistrations().then(function(z){for(var A=0;A<z.length;A++){if(z[A].active&&z[A].active.scriptURL.indexOf("sw.js?cid=")==-1){z[A].unregister()}}navigator.serviceWorker.register(x,{scope:v}).then(function(B){a(B)})})}else{navigator.serviceWorker.register(x,{scope:v}).then(function(z){a(z)})}}else{console.log("Service workers aren't supported in this browser.")}};_taq.do_webpush_reg_without_sw=function(v){var w="/manifest.json";if(_taq.webpush_set.murl){w=_taq.webpush_set.murl}if(v){w="/webpush-manifest-"+_taq.id+".json"}if(_taq.$('link[rel="manifest"]').length==0){_taq.$("head").append('<link rel="manifest" href="'+w+'">')}if("serviceWorker" in navigator){navigator.serviceWorker.ready.then(function(x){a(x)})}else{console.log("Service workers aren't supported in this browser.")}};_taq.has_webpush_registration=function(){return !!_taq.getLSItem("webpush_status")};_taq.is_incognito=function(v){q(function(w){v(w)})};_taq.do_popup_webpush_registration=function(){var w=r.config.pst;var x=_taq.getLSItem("webpush_status");var z=_taq.getLSItem("webpush_ask_again");if(x=="denied"||x=="registered"||((x=="timeout"||x=="premature_close"||x=="default"||x=="popup_denied")&&z>(new Date().getTime())+"")){console.log("GAMOOGA: Cannot start registration, current status: "+x+", timeout: "+new Date(z-0));return}else{if(!w||!w.nm||!w.img||!((w.st==2)||(w.st==0&&w.msg)||(w.st==1&&w.bcfg))){console.log("GAMOOGA: Incomplete webpush settings, cannot start registration.");return}}var y="chrome" in window&&"serviceWorker" in navigator&&c().version>=42;var v=/Firefox[\/\s](\d+\.\d+)/.test(navigator.userAgent)&&"serviceWorker" in navigator&&c().version>=44;if(!y&&!v){console.log("GAMOOGA: Unsupported browser/version, cannot start registration.");return}if((!("showNotification" in ServiceWorkerRegistration.prototype))||(!("PushManager" in window))||(!("serviceWorker" in navigator))){console.log("GAMOOGA: Incompatible browser.");return}q(function(J){var D=_taq.$;if(!J){if(w.st==2){var A;if(r.DEV){A="/webpush-notif-perm-"+_taq.id}else{A="https://"+w.nm+".pushmessage.co/webpush-notif-perm-"+_taq.id}function I(P){var M=P.origin||P.originalEvent.origin;if(r.DEV||M.indexOf("pushmessage.co")!=-1){if(window.removeEventListener){window.removeEventListener("message",I,false)}else{if(window.detachEvent){window.detachEvent("onmessage",I)}}var L=JSON.parse(P.data)["status"];if(L=="default"){_taq.setLSItem("webpush_status","default");_taq.setLSItem("webpush_ask_again",(new Date().getTime()+f)+"")}else{if(L=="denied"){_taq.setLSItem("webpush_status","denied");d("^webpush onestep block")}else{d("^webpush onestep allow");var Q;if(r.DEV){Q="/webpush-register-"+_taq.id}else{Q="https://"+w.nm+".pushmessage.co/webpush-register-"+_taq.id}var O=D(window).width();var N=422;if(O>=320&&O<=380){N=280}else{if(O>=381&&O<=480){N=320}}var K;if(_taq.id=="093ba2ea-bc0f-4b85-a9e2-f294cf2338a0"||_taq.id=="96148074-8fb3-4e8c-94a0-13f2012c5623"||_taq.id=="107a3b41-1aa3-45c6-a324-f0399a2aa2af"||_taq.id=="2b06bddd-3a87-4378-b812-3a92862f8eab"){K="<div id=\"__gamooga_webpush_thanks\" onclick=\"_taq.$('#__gamooga_webpush_thanks').remove();_taq.setLSItem('webpush_status','premature_close');_taq.setLSItem('webpush_ask_again','"+(new Date().getTime()+f)+"');window.open('"+Q+"','_blank','top=10,left=10,height=100,width=100');\" style=\"background-color:#F0EFF0; box-shadow:0 0 4px #888; font-size:11px; font-weight:400; left:calc(50% - "+(N/2)+"px); margin:0; padding:0; position:fixed; top:50px; width:"+N+'px; z-index:2147483647" bgcolor="#F0EFF0" width="'+N+'">'+w.raw_html_onestep.replace("__FE_SERVER__",r.FE_SERVER)+"</div>"}else{K="<div id=\"__gamooga_webpush_thanks\" onclick=\"_taq.$('#__gamooga_webpush_thanks').remove();_taq.setLSItem('webpush_status','premature_close');_taq.setLSItem('webpush_ask_again','"+(new Date().getTime()+f)+"');window.open('"+Q+"','_blank');\" style=\"background-color:#F0EFF0; box-shadow:0 0 4px #888; font-size:11px; font-weight:400; left:calc(50% - "+(N/2)+"px); margin:0; padding:0; position:fixed; top:50px; width:"+N+'px; z-index:2147483647" bgcolor="#F0EFF0" width="'+N+'">'+w.raw_html_onestep.replace("__FE_SERVER__",r.FE_SERVER)+"</div>"}D("body").append(K);D("#__gamooga_webpush_thanks").click(function(){d("^webpush onestep ok")})}}}}if(window.addEventListener){window.addEventListener("message",I,false)}else{if(window.attachEvent){window.attachEvent("onmessage",I)}}var B='<iframe style="width:0px;height:0px;position:absolute;left:-999px;top:-999px" src="'+A+'">';D("body").append(B);d("^webpush onestep show")}else{if(w.st==0){if(D("#__gamooga_webpush_ask").length==0){var C=D(window).width();var H=422;if(C>=320&&C<=380){H=280}else{if(C>=381&&C<=480){H=320}}var F='<div id="__gamooga_webpush_ask" style="background-color:#F0EFF0; box-shadow:0 0 4px #888; font-size:11px; font-weight:400; left:calc(50% - '+(H/2)+"px); margin:0; padding:0; position:fixed; top:0; width:"+H+'px; z-index:2147483647" bgcolor="#F0EFF0" width="'+H+'"><div style="margin:0; padding:0 20px 10px 20px"><div style="display:inline-block; float:left; margin:15px 15px 0 0; padding:0; position:relative"><img src="'+(w.img)+'" style="max-height:65px; max-width:65px"></div><div style="color:#000; display:inline-block; line-height:1.4em; margin:0; padding:10px 0 0 0; position:relative; text-align:left; width:calc(100% - 80px)" align="left" width="calc(100% - 80px)"><span style="color:#000; font-family:\'Open Sans\', sans-serif; font-size:14px; font-weight:700; line-height:1.4em; margin-bottom:5px; text-align:left" align="left">'+(w.msg)+'</span><p style="font-family:\'Open Sans\', sans-serif; font-size:12px; line-height:1.4em; margin:10px 0; padding:0; text-align:left" align="left">You can turn off notifications anytime from browser settings.</p></div><div style="clear: both;"><div style="float:right; margin:0; padding:0"><button style="background:linear-gradient(to bottom, #64b4f4, #0084f6); border:1px solid #42a2f2; border-radius:4px; box-shadow:none; box-sizing:border-box; color:#fff; cursor:pointer; display:inline-block; font-family:Arial; font-size:14px; font-weight:normal; height:26px; line-height:1.1em; margin:0; margin-right:20px; padding:5px; text-shadow:none; text-transform:none; width:90px" height="26" width="90" id="__gamooga_webpush_allow">Allow</button><button style="background:#FFF; border:1px solid #42a2f2; border-color:#CCC; border-radius:4px; box-shadow:none; box-sizing:border-box; color:#000; cursor:pointer; display:inline-block; font-family:Arial; font-size:14px; font-weight:normal; height:26px; line-height:1.1em; margin:0; padding:5px; text-shadow:none; text-transform:none; width:100px" height="26" width="100" id="__gamooga_webpush_notnow">Block</button></div><div style="clear:both"></div></div></div></div>';D("body").append(F)}}else{if(w.st==1){if(D("#__gamooga_webpush_bell").length==0){var E="bottom:100px;right:100px;";if(w.bcfg["pos"]=="1"){E="top:"+w.bcfg["ofy"]+"px;left:"+w.bcfg["ofx"]+"px;"}else{if(w.bcfg["pos"]=="2"){E="top:"+w.bcfg["ofy"]+"px;right:"+w.bcfg["ofx"]+"px;"}else{if(w.bcfg["pos"]=="3"){E="bottom:"+w.bcfg["ofy"]+"px;left:"+w.bcfg["ofx"]+"px;"}else{if(w.bcfg["pos"]=="4"){E="bottom:"+w.bcfg["ofy"]+"px;right:"+w.bcfg["ofx"]+"px;"}}}}var G='<div id="__gamooga_webpush_bell" style="cursor:pointer;background:'+w.bcfg["bg"]+";border-radius: 50%;box-shadow: 0 0 4px #c4c4c4;color: #000;display: block;height: 59px;padding: 5px;position: fixed;"+E+'text-align: center;vertical-align: middle;width: 59px;z-index: 99999;"><style>@-moz-keyframes ring {0% {-moz-transform: rotate(0);}1% {-moz-transform: rotate(30deg);}3% {-moz-transform: rotate(-28deg);}5% {-moz-transform: rotate(34deg);}7% {-moz-transform: rotate(-32deg);}9% {-moz-transform: rotate(30deg);}11% {-moz-transform: rotate(-28deg);}13% {-moz-transform: rotate(26deg);}15% {-moz-transform: rotate(-24deg);}17% {-moz-transform: rotate(22deg);}19% {-moz-transform: rotate(-20deg);}21% {-moz-transform: rotate(18deg);}23% {-moz-transform: rotate(-16deg);}25% {-moz-transform: rotate(14deg);}27% {-moz-transform: rotate(-12deg);}29% {-moz-transform: rotate(10deg);}31% {-moz-transform: rotate(-8deg);}33% {-moz-transform: rotate(6deg);}35% {-moz-transform: rotate(-4deg);}37% {-moz-transform: rotate(2deg);}39% {-moz-transform: rotate(-1deg);}41% {-moz-transform: rotate(1deg);}43% {-moz-transform: rotate(0);}100% {-moz-transform: rotate(0);}}@keyframes ring {0% {transform: rotate(0);}1% {transform: rotate(30deg);}3% {transform: rotate(-28deg);}5% {transform: rotate(34deg);}7% {transform: rotate(-32deg);}9% {transform: rotate(30deg);}11% {transform: rotate(-28deg);}13% {transform: rotate(26deg);}15% {transform: rotate(-24deg);}17% {transform: rotate(22deg);}19% {transform: rotate(-20deg);}21% {transform: rotate(18deg);}23% {transform: rotate(-16deg);}25% {transform: rotate(14deg);}27% {transform: rotate(-12deg);}29% {transform: rotate(10deg);}31% {transform: rotate(-8deg);}33% {transform: rotate(6deg);}35% {transform: rotate(-4deg);}37% {transform: rotate(2deg);}39% {transform: rotate(-1deg);}41% {transform: rotate(1deg);}43% {transform: rotate(0);}100% {transform: rotate(0);}}</style><img src="//'+r.FE_SERVER+'/static/images/webpush_bell.png" style="z-index: 9999999;opacity: 1;-webkit-animation: ring 8s 1s ease-in-out infinite;-webkit-transform-origin: 50% 2px;-moz-animation: ring 8s 1s ease-in-out infinite;-moz-transform-origin: 50% 2px;animation: ring 8s 1s ease-in-out infinite;transform-origin: 50% 2px;margin-top: 10px;" alt="bell"></div>';D("body").append(G)}}}d("^webpush notif show");if(_taq.id=="f7ca3cdc-108f-498a-8b89-3097ef91fcd2"){D("#__gamooga_webpush_notnow").text("No");D("#__gamooga_webpush_allow").text("Yes")}D("#__gamooga_webpush_notnow").click(function(){D("#__gamooga_webpush_ask").remove();_taq.setLSItem("webpush_status","popup_denied");_taq.setLSItem("webpush_ask_again",(new Date().getTime()+f)+"");d("^webpush notif block")});D("#__gamooga_webpush_allow,#__gamooga_webpush_bell").click(function(){D("#__gamooga_webpush_ask").remove();D("#__gamooga_webpush_bell").remove();_taq.setLSItem("webpush_status","premature_close");_taq.setLSItem("webpush_ask_again",(new Date().getTime()+f)+"");d("^webpush notif allow");var N=600;var P=600;var M=window.screenLeft!=undefined?window.screenLeft:screen.left;var O=window.screenTop!=undefined?window.screenTop:screen.top;var L=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width;var K=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height;M=((L/2)-(N/2))+M;O=((K/2)-(P/2))+O;if(r.DEV){window.open("/webpush-register-"+_taq.id,"_blank");d("^webpush open")}else{window.open("https://"+w.nm+".pushmessage.co/webpush-register-"+_taq.id,"_blank");d("^webpush open")}})}}else{console.log("GAMOOGA: Incognito window, cannot start registration.")}})};_taq.handlers.push(["ready",function(){if(r.config.pst&&r.config.pst["bcfg"]&&r.config.pst["bcfg"]["sd"]){_taq.do_popup_webpush_registration()}}])});